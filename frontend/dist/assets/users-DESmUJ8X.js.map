{"version":3,"file":"users-DESmUJ8X.js","sources":["../../src/js/pages/users.js"],"sourcesContent":["\nimport { showToast, createElement } from '/js/ui.js';\n\nconst waitForAuth = (maxWait = 10000) => new Promise((resolve, reject) => {\n    const startTime = Date.now();\n    const check = () => {\n        if (window.Auth) return resolve(window.Auth);\n        if (Date.now() - startTime > maxWait) return reject(new Error('Auth not available'));\n        setTimeout(check, 50);\n    };\n    check();\n});\nconst Auth = await waitForAuth();\n\nlet allUsers = [];\nlet selectedRole = '';\nlet showInactive = false;\nlet showTestUsers = false;\nlet formDirty = false;\n\nasync function init() {\n    Auth.ensureCsrfToken().catch(err => console.warn('CSRF pre-fetch failed:', err));\n    const user = await Auth.requireAuth(['admin']);\n    if (!user) return;\n    await loadUsers();\n}\n\nasync function loadUsers() {\n    try {\n        const params = new URLSearchParams();\n        if (showInactive) params.set('isActive', 'all');\n        if (showTestUsers) params.set('includeTest', 'true');\n        const url = '/api/users' + (params.toString() ? '?' + params : '');\n        const res = await fetch(url, { credentials: 'include' });\n        if (!res.ok) {\n            const errBody = await res.json().catch(() => ({}));\n            throw new Error(errBody.message || `Server returned ${res.status}`);\n        }\n        const data = await res.json();\n        allUsers = data.data || [];\n        displayUsers(filterUsers());\n    } catch (e) {\n        console.error('Failed to load users:', e);\n        const container = document.getElementById('usersList');\n        const errorMsg = !navigator.onLine ? 'No internet connection' : (e.message || 'Users not available');\n        container.innerHTML = '';\n        container.appendChild(createElement('div', { className: 'empty-state' }, [\n            createElement('p', {}, errorMsg),\n            createElement('button', {\n                style: { marginTop: '1rem', padding: '0.5rem 1rem', background: 'var(--dusty-olive)', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' },\n                onclick: loadUsers\n            }, 'Try Again')\n        ]));\n    }\n}\n\nfunction filterUsers() {\n    const q = document.getElementById('searchInput').value.toLowerCase();\n    return allUsers.filter(u => {\n        const matchesSearch = u.name.toLowerCase().includes(q) ||\n            u.email.toLowerCase().includes(q) ||\n            (u.phone && u.phone.includes(q));\n        const matchesRole = !selectedRole || u.role === selectedRole;\n        return matchesSearch && matchesRole;\n    });\n}\n\nfunction getRoleBadge(role) {\n    const labels = { admin: 'Admin', staff: 'Staff', customer: 'Customer' };\n    return createElement('span', { className: `badge badge-${role}` }, labels[role] || role);\n}\n\nfunction displayUsers(users) {\n    const container = document.getElementById('usersList');\n    if (!users || !users.length) {\n        container.innerHTML = '';\n        container.appendChild(createElement('div', { className: 'empty-state' }, 'No users found'));\n        return;\n    }\n\n    container.innerHTML = '';\n    const fragment = document.createDocumentFragment();\n\n    users.forEach((u, idx) => {\n        const badges = [getRoleBadge(u.role)];\n        if (!u.isActive) {\n            badges.push(createElement('span', { className: 'badge badge-inactive' }, 'Inactive'));\n        }\n\n        const details = [];\n        details.push(createElement('span', { className: 'user-email' }, u.email));\n        if (u.phone) details.push(createElement('span', {}, u.phone));\n\n        const actions = [];\n        actions.push(createElement('button', {\n            onclick: () => window.editUserById(u._id),\n            className: 'btn-action primary'\n        }, 'Edit'));\n        actions.push(createElement('button', {\n            onclick: () => window.openResetPassword(u._id),\n            className: 'btn-action'\n        }, 'Password'));\n\n        if (u.isActive) {\n            actions.push(createElement('button', {\n                onclick: () => window.deactivateUser(u._id),\n                className: 'btn-action danger'\n            }, 'Deactivate'));\n        } else {\n            actions.push(createElement('button', {\n                onclick: () => window.activateUser(u._id),\n                className: 'btn-action link'\n            }, 'Activate'));\n        }\n\n        const card = createElement('div', {\n            className: `customer-card card-animated card-fade-in${!u.isActive ? ' inactive' : ''}`,\n            style: { animationDelay: `${idx * 0.05}s` }\n        }, [\n            createElement('div', { className: 'customer-header' }, [\n                createElement('div', { className: 'customer-name' }, u.name),\n                createElement('div', { className: 'customer-badges' }, badges)\n            ]),\n            createElement('div', { className: 'customer-details' }, details),\n            createElement('div', { className: 'customer-actions' }, actions)\n        ]);\n        fragment.appendChild(card);\n    });\n\n    container.appendChild(fragment);\n}\n\nfunction searchUsers() {\n    displayUsers(filterUsers());\n}\n\nfunction filterByRole(role) {\n    selectedRole = role;\n    document.querySelectorAll('.role-pill').forEach(pill => {\n        pill.classList.toggle('active', pill.dataset.role === role);\n    });\n    displayUsers(filterUsers());\n}\n\nfunction toggleInactive() {\n    showInactive = document.getElementById('showInactive').checked;\n    loadUsers();\n}\n\nfunction toggleTestUsers() {\n    showTestUsers = document.getElementById('showTestUsers').checked;\n    loadUsers();\n}\n\nfunction showAddUserForm() {\n    document.getElementById('modalTitle').textContent = 'Add User';\n    document.getElementById('userForm').reset();\n    document.getElementById('userId').value = '';\n    document.getElementById('userRole').value = 'staff';\n    document.getElementById('passwordGroup').classList.remove('hidden');\n    document.getElementById('userPassword').required = true;\n    document.getElementById('userModal').classList.add('show');\n    setTimeout(() => { formDirty = false; }, 0);\n}\n\nfunction editUser(user) {\n    document.getElementById('modalTitle').textContent = 'Edit User';\n    document.getElementById('userId').value = user._id;\n    document.getElementById('userName').value = user.name;\n    document.getElementById('userEmail').value = user.email;\n    document.getElementById('userPhone').value = user.phone || '';\n    document.getElementById('userRole').value = user.role;\n    // Hide password field when editing - use separate reset password flow\n    document.getElementById('passwordGroup').classList.add('hidden');\n    document.getElementById('userPassword').required = false;\n    document.getElementById('userPassword').value = '';\n    document.getElementById('userModal').classList.add('show');\n    setTimeout(() => { formDirty = false; }, 0);\n}\n\nfunction editUserById(id) {\n    const user = allUsers.find(u => u._id === id);\n    if (user) editUser(user);\n}\n\nfunction closeModal() {\n    if (formDirty && !confirm('You have unsaved changes. Discard them?')) return;\n    formDirty = false;\n    document.getElementById('userModal').classList.remove('show');\n}\n\nfunction togglePasswordVisibility(inputId, btn) {\n    const input = document.getElementById(inputId);\n    if (input.type === 'password') {\n        input.type = 'text';\n        btn.textContent = 'Hide';\n    } else {\n        input.type = 'password';\n        btn.textContent = 'Show';\n    }\n}\n\n// Reset Password\nfunction openResetPassword(userId) {\n    const user = allUsers.find(u => u._id === userId);\n    if (!user) return;\n    document.getElementById('passwordUserId').value = userId;\n    document.getElementById('passwordUserName').textContent = `${user.name} (${user.email})`;\n    document.getElementById('newPassword').value = '';\n    document.getElementById('passwordModal').classList.add('show');\n}\n\nfunction closePasswordModal() {\n    document.getElementById('passwordModal').classList.remove('show');\n}\n\nasync function fetchWithCsrf(url, options) {\n    const headers = { 'Content-Type': 'application/json', ...options.headers };\n    const csrfToken = await Auth.ensureCsrfToken();\n    if (csrfToken) headers['X-CSRF-Token'] = csrfToken;\n\n    let res = await fetch(url, { ...options, headers, credentials: 'include' });\n\n    // CSRF retry\n    if (res.status === 403) {\n        const err = await res.json();\n        if (err.message?.toLowerCase().includes('csrf')) {\n            const newToken = await Auth.refreshCsrfToken();\n            if (newToken) {\n                headers['X-CSRF-Token'] = newToken;\n                res = await fetch(url, { ...options, headers, credentials: 'include' });\n            }\n        } else {\n            return { res, data: err, csrfFailed: false };\n        }\n    }\n\n    const data = await res.json();\n    return { res, data };\n}\n\n// Deactivate / Activate\nasync function deactivateUser(id) {\n    if (!confirm('Deactivate this user? They will not be able to login.')) return;\n    try {\n        const { res, data } = await fetchWithCsrf(`/api/users/${id}`, { method: 'DELETE' });\n        if (res.ok) {\n            showToast('User deactivated', 'success');\n            loadUsers();\n        } else {\n            showToast(data.message || 'Could not deactivate', 'info');\n        }\n    } catch (e) {\n        console.error('Deactivate error:', e);\n        showToast(!navigator.onLine ? 'No internet connection' : 'Could not deactivate. Try again.', 'info');\n    }\n}\n\nasync function activateUser(id) {\n    try {\n        const { res, data } = await fetchWithCsrf(`/api/users/${id}`, {\n            method: 'PUT',\n            body: JSON.stringify({ isActive: true })\n        });\n        if (res.ok) {\n            showToast('User activated', 'success');\n            loadUsers();\n        } else {\n            showToast(data.message || 'Could not activate', 'info');\n        }\n    } catch (e) {\n        console.error('Activate error:', e);\n        showToast(!navigator.onLine ? 'No internet connection' : 'Could not activate. Try again.', 'info');\n    }\n}\n\n// Setup form listeners\nfunction setupFormListeners() {\n    const form = document.getElementById('userForm');\n    if (form) {\n        form.addEventListener('input', () => { formDirty = true; });\n        form.addEventListener('change', () => { formDirty = true; });\n        form.addEventListener('submit', async (e) => {\n            e.preventDefault();\n            const btn = document.getElementById('saveUserBtn');\n            const id = document.getElementById('userId').value;\n\n            const name = document.getElementById('userName').value.trim();\n            const email = document.getElementById('userEmail').value.trim();\n            const password = document.getElementById('userPassword').value;\n            const phone = document.getElementById('userPhone').value.trim();\n            const role = document.getElementById('userRole').value;\n\n            if (!name) { showToast('Please enter name', 'info'); return; }\n            if (!email || email.length < 3) { showToast('Username must be at least 3 characters', 'info'); return; }\n            if (phone && !/^[0-9]{10}$/.test(phone)) { showToast('Phone should be 10 digits', 'info'); return; }\n\n            // Password validation for new users\n            if (!id && !password) { showToast('Password is required', 'info'); return; }\n            if (password) {\n                if (password.length < 6) { showToast('Password must be at least 6 characters', 'info'); return; }\n                if (!/[A-Z]/.test(password)) { showToast('Password needs an uppercase letter', 'info'); return; }\n                if (!/[a-z]/.test(password)) { showToast('Password needs a lowercase letter', 'info'); return; }\n                if (!/[0-9]/.test(password)) { showToast('Password needs a number', 'info'); return; }\n            }\n\n            btn.classList.add('btn-loading');\n            btn.disabled = true;\n\n            const bodyData = { name, email, phone, role };\n            if (!id && password) bodyData.password = password;\n\n            try {\n                const url = id ? `/api/users/${id}` : '/api/users';\n                const method = id ? 'PUT' : 'POST';\n                const { res, data } = await fetchWithCsrf(url, { method, body: JSON.stringify(bodyData) });\n\n                if (res.ok) {\n                    btn.classList.remove('btn-loading');\n                    btn.classList.add('btn-success');\n                    showToast(id ? 'User updated' : 'User created', 'success');\n                    setTimeout(() => {\n                        btn.classList.remove('btn-success');\n                        formDirty = false;\n                        document.getElementById('userModal').classList.remove('show');\n                    }, 800);\n                    loadUsers();\n                } else {\n                    const msg = data.errors?.[0]?.msg || data.message || 'Could not save. Try again.';\n                    showToast(msg, 'info');\n                }\n            } catch (e) {\n                console.error('Save user error:', e);\n                showToast(!navigator.onLine ? 'No internet connection' : 'Could not save. Try again.', 'info');\n            } finally {\n                btn.classList.remove('btn-loading');\n                btn.disabled = false;\n            }\n        });\n    }\n\n    // Password reset form\n    const pwForm = document.getElementById('passwordForm');\n    if (pwForm) {\n        pwForm.addEventListener('submit', async (e) => {\n            e.preventDefault();\n            const btn = document.getElementById('savePasswordBtn');\n            const userId = document.getElementById('passwordUserId').value;\n            const password = document.getElementById('newPassword').value;\n\n            if (!password) { showToast('Please enter new password', 'info'); return; }\n            if (password.length < 6) { showToast('Password must be at least 6 characters', 'info'); return; }\n            if (!/[A-Z]/.test(password)) { showToast('Password needs an uppercase letter', 'info'); return; }\n            if (!/[a-z]/.test(password)) { showToast('Password needs a lowercase letter', 'info'); return; }\n            if (!/[0-9]/.test(password)) { showToast('Password needs a number', 'info'); return; }\n\n            btn.classList.add('btn-loading');\n            btn.disabled = true;\n\n            try {\n                const { res, data } = await fetchWithCsrf(`/api/users/${userId}/password`, {\n                    method: 'PUT',\n                    body: JSON.stringify({ password })\n                });\n\n                if (res.ok) {\n                    btn.classList.remove('btn-loading');\n                    btn.classList.add('btn-success');\n                    showToast('Password reset successfully', 'success');\n                    setTimeout(() => {\n                        btn.classList.remove('btn-success');\n                        closePasswordModal();\n                    }, 800);\n                } else {\n                    const msg = data.errors?.[0]?.msg || data.message || 'Could not reset password';\n                    showToast(msg, 'info');\n                }\n            } catch (e) {\n                console.error('Password reset error:', e);\n                showToast(!navigator.onLine ? 'No internet connection' : 'Could not reset. Try again.', 'info');\n            } finally {\n                btn.classList.remove('btn-loading');\n                btn.disabled = false;\n            }\n        });\n    }\n}\n\n// Expose to window\nwindow.showAddUserForm = showAddUserForm;\nwindow.searchUsers = searchUsers;\nwindow.filterByRole = filterByRole;\nwindow.toggleInactive = toggleInactive;\nwindow.toggleTestUsers = toggleTestUsers;\nwindow.closeModal = closeModal;\nwindow.editUserById = editUserById;\nwindow.openResetPassword = openResetPassword;\nwindow.closePasswordModal = closePasswordModal;\nwindow.deactivateUser = deactivateUser;\nwindow.activateUser = activateUser;\nwindow.togglePasswordVisibility = togglePasswordVisibility;\n\n// Modal overlay click handlers\nconst userModal = document.getElementById('userModal');\nif (userModal) {\n    userModal.onclick = (e) => { if (e.target.id === 'userModal') closeModal(); };\n}\nconst passwordModal = document.getElementById('passwordModal');\nif (passwordModal) {\n    passwordModal.onclick = (e) => { if (e.target.id === 'passwordModal') closePasswordModal(); };\n}\n\nsetupFormListeners();\ninit();\n"],"names":["waitForAuth","maxWait","resolve","reject","startTime","check","Auth","allUsers","selectedRole","showInactive","showTestUsers","formDirty","init","err","loadUsers","params","url","res","errBody","displayUsers","filterUsers","container","errorMsg","createElement","q","u","matchesSearch","matchesRole","getRoleBadge","role","labels","users","fragment","idx","badges","details","actions","card","searchUsers","filterByRole","pill","toggleInactive","toggleTestUsers","showAddUserForm","editUser","user","editUserById","id","closeModal","togglePasswordVisibility","inputId","btn","input","openResetPassword","userId","closePasswordModal","fetchWithCsrf","options","headers","csrfToken","newToken","data","deactivateUser","showToast","e","activateUser","setupFormListeners","form","name","email","password","phone","bodyData","method","msg","pwForm","userModal","passwordModal"],"mappings":"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"}