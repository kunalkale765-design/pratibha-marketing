import{c as i,s,_ as c}from"./api-BDW4zv3H.js";import{e as l,a as u,g as d}from"./ui-C7t5s6-T.js";window.onerror=function(e,o,t,n,a){return console.error("Uncaught error:",e,"at",o,t,n),a&&i(a,{source:o,lineno:t,colno:n}),!0};window.addEventListener("unhandledrejection",function(e){console.error("Unhandled promise rejection:",e.reason),i(e.reason||new Error("Unhandled rejection")),e.preventDefault()});function f(){"serviceWorker"in navigator&&(window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(e=>{console.log("ServiceWorker registered:",e.scope)}).catch(e=>{console.log("ServiceWorker registration failed:",e)})}),navigator.serviceWorker.addEventListener("message",e=>{e.data?.type==="SW_UPDATED"&&c(async()=>{const{showToast:o}=await import("./ui-C7t5s6-T.js").then(t=>t.u);return{showToast:o}},[]).then(({showToast:o})=>{o("Update available â€” refresh to apply","info")}).catch(()=>{console.log("App update available. Refresh to apply.")})}))}async function g(){if(window.Auth&&typeof window.Auth.logout=="function")return window.Auth.logout();localStorage.removeItem("user");const e={"Content-Type":"application/json"},o=d();o&&(e["X-CSRF-Token"]=o);try{await fetch("/api/auth/logout",{method:"POST",headers:e,credentials:"include"})}catch(t){console.error("Logout error:",t)}window.location.href="/pages/auth/login.html"}function p(){document.querySelectorAll("[data-logout], .logout-btn, #logoutBtn").forEach(o=>{o.addEventListener("click",t=>{t.preventDefault(),g()})})}function w(e={}){const{serviceWorker:o=!0,logout:t=!0,modalEscape:n=!0,csrfPreFetch:a=!0}=e;a&&l().catch(r=>console.warn("CSRF pre-fetch failed:",r)),o&&f(),t&&p(),n&&u();try{const r=localStorage.getItem("user");r&&s(JSON.parse(r))}catch{}}export{w as i,g as l,f as r};
