import"./responsive-D1ZTW0b0.js";import"./ui-CbzHyiqg.js";import"./api-CPXug1OA.js";import{r as k}from"./init-BoJp8Xjr.js";k();const B=(e=1e4)=>new Promise((u,s)=>{const o=Date.now(),n=()=>{if(window.Auth)return u(window.Auth);if(Date.now()-o>e)return s(new Error("Auth not available"));setTimeout(n,50)};n()}),m=await B();m.ensureCsrfToken().catch(e=>console.warn("CSRF pre-fetch failed:",e));const v=document.getElementById("signupForm"),l=document.getElementById("signupBtn"),a=document.getElementById("noticeMessage"),c=document.getElementById("successMessage"),T=document.getElementById("password");T&&T.addEventListener("input",function(){const e=this.value;w("req-length",e.length>=6),w("req-upper",/[A-Z]/.test(e)),w("req-lower",/[a-z]/.test(e)),w("req-number",/[0-9]/.test(e))});function w(e,u){const s=document.getElementById(e);if(!s)return;const o=s.textContent.substring(2);u?(s.classList.add("valid"),s.textContent="✓ "+o):(s.classList.remove("valid"),s.textContent="◯ "+o)}L();async function L(){try{(await fetch("/api/auth/me",{credentials:"include"})).ok&&(window.location.href="/")}catch{}}v&&v.addEventListener("submit",async e=>{e.preventDefault();const u=document.getElementById("name").value.trim(),s=document.getElementById("email").value.trim(),o=document.getElementById("phone").value.trim(),n=document.getElementById("password").value,p=document.getElementById("confirmPassword").value;if(!u||!s||!n||!p){t("Please complete all required fields");return}if(n.length<6){t("Password needs at least 6 characters");return}if(!/[A-Z]/.test(n)){t("Add an uppercase letter to password");return}if(!/[a-z]/.test(n)){t("Add a lowercase letter to password");return}if(!/[0-9]/.test(n)){t("Add a number to password");return}if(n!==p){t("Passwords don't match");return}if(o&&!/^[0-9]{10}$/.test(o)){t("Phone should be 10 digits");return}l.disabled=!0,l.textContent="Creating account...",S();try{const r={name:u,email:s,password:n,role:"customer"};o&&(r.phone=o);const f={"Content-Type":"application/json"},y=await m.ensureCsrfToken();y&&(f["X-CSRF-Token"]=y);const h=await fetch("/api/auth/register",{method:"POST",headers:f,credentials:"include",body:JSON.stringify(r)}),i=await h.json();if(h.status===403&&i?.message?.toLowerCase().includes("csrf")){console.log("CSRF error, refreshing token and retrying...");const g=await m.refreshCsrfToken();if(g){f["X-CSRF-Token"]=g;const C=await fetch("/api/auth/register",{method:"POST",headers:f,credentials:"include",body:JSON.stringify(r)}),d=await C.json();if(C.ok){m.setUser(d.user),A("Account created successfully! Redirecting..."),setTimeout(()=>{d.user.role==="customer"?window.location.href="/pages/order-form/":window.location.href="/"},1500);return}d.errors&&d.errors.length>0?t(d.errors.map(E=>E.msg).join(", ")):t(d.message||"Could not create account. Try again.");return}}h.ok?(m.setUser(i.user),A("Account created successfully! Redirecting..."),setTimeout(()=>{i.user.role==="customer"?window.location.href="/pages/order-form/":window.location.href="/"},1500)):i.errors&&i.errors.length>0?t(i.errors.map(g=>g.msg).join(", ")):t(i.message||"Could not create account. Try again.")}catch(r){console.error("Signup error:",r),navigator.onLine?r.name==="TypeError"||r.message.includes("fetch")?t("Connection issue. Please try again."):t("Something went wrong. Try again."):t("No internet connection")}finally{l&&(l.disabled=!1,l.textContent="Create Account")}});function t(e){a&&(a.textContent=e,a.classList.add("show"),c&&c.classList.remove("show"))}function A(e){c&&(c.textContent=e,c.classList.add("show"),a&&a.classList.remove("show"))}function S(){a&&a.classList.remove("show"),c&&c.classList.remove("show")}
