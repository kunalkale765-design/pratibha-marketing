import"./responsive-D1ZTW0b0.js";/* empty css             *//* empty css               *//* empty css                */import{s as c,c as n}from"./ui-D1Am529b.js";const L=()=>new Promise(e=>{window.Auth?e(window.Auth):setTimeout(()=>e(L()),10)}),m=await L();let l=[],u=[],g="";async function F(){await m.requireAuth(["admin","staff"])&&await p()}async function p(){try{l=(await(await fetch("/api/products",{credentials:"include"})).json()).data||[];const o=new Set;l.forEach(a=>{a.category&&o.add(a.category)}),u=Array.from(o).sort(),w(),h(),C()}catch(e){console.error("Failed to load products:",e);const t=document.getElementById("productsList"),o=navigator.onLine?"Products not available":"No internet connection";t.innerHTML="",t.appendChild(n("div",{className:"empty-state"},[n("p",{},o),n("button",{id:"retryProductsBtn",style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"var(--dusty-olive)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},onclick:p},"Try Again")]))}}function w(){const e=document.getElementById("categoryPills");e.innerHTML="";const t=document.createDocumentFragment();t.appendChild(n("button",{className:`cat-pill ${g===""?"active":""}`,onclick:()=>window.filterByCategory("")},"All")),u.forEach(o=>{t.appendChild(n("button",{className:`cat-pill ${g===o?"active":""}`,onclick:()=>window.filterByCategory(o)},o))}),e.appendChild(t)}function h(){const e=document.getElementById("productCategory");e.innerHTML="",e.appendChild(n("option",{value:""},"Select...")),u.forEach(t=>{e.appendChild(n("option",{value:t},t))})}function A(e){g=e,w(),C()}function D(e){const t=document.getElementById("productsList");if(t.innerHTML="",!e||!e.length){t.appendChild(n("div",{className:"empty-state"},"No products found"));return}const o={};e.forEach(i=>{const d=i.category||"Uncategorized";o[d]||(o[d]=[]),o[d].push(i)});const a=Object.keys(o).sort((i,d)=>i==="Uncategorized"?1:d==="Uncategorized"?-1:i.localeCompare(d)),r=document.createDocumentFragment();let s=0;a.forEach(i=>{r.appendChild(n("div",{className:"category-header"},i)),o[i].forEach(d=>{const y=n("div",{className:"product-card card-animated card-fade-in",style:{animationDelay:`${s*.05}s`}},[n("div",{className:"product-info"},[n("div",{className:"product-name"},d.name),n("div",{className:"product-meta"},[n("span",{},d.unit||"")])]),n("div",{className:"product-actions"},[n("button",{onclick:()=>window.editProductById(d._id),className:"btn-icon"},"✎"),n("button",{onclick:()=>window.deleteProduct(d._id),className:"btn-icon danger"},"✕")])]);r.appendChild(y),s++})}),t.appendChild(r)}function C(){const e=document.getElementById("searchInput").value.toLowerCase(),t=l.filter(o=>{const a=o.name.toLowerCase().includes(e),r=!g||o.category===g;return a&&r});D(t)}function S(){document.getElementById("modalTitle").textContent="Add Product",document.getElementById("productForm").reset(),document.getElementById("productId").value="",document.getElementById("productModal").classList.add("show")}function $(e){const t=l.find(o=>o._id===e);t&&(document.getElementById("modalTitle").textContent="Edit Product",document.getElementById("productId").value=t._id,document.getElementById("productName").value=t.name,document.getElementById("productCategory").value=t.category||"",document.getElementById("productUnit").value=t.unit,document.getElementById("productModal").classList.add("show"))}function v(){document.getElementById("productModal").classList.remove("show")}function j(){const e=document.getElementById("productForm");e&&e.addEventListener("submit",async o=>{o.preventDefault(),await T()});const t=document.getElementById("newCategoryInput");t&&t.addEventListener("keypress",o=>{o.key==="Enter"&&(o.preventDefault(),b())})}async function T(e=!1){const t=document.getElementById("productId").value,o=document.getElementById("productCategory").value,a=document.getElementById("productName").value.trim(),r=document.getElementById("productUnit").value;if(!a){c("Please enter product name","info"),document.getElementById("productName").focus();return}if(!r){c("Please select a unit","info"),document.getElementById("productUnit").focus();return}const s={name:a,unit:r};o&&(s.category=o);try{const i=t?`/api/products/${t}`:"/api/products",d=t?"PUT":"POST",y={"Content-Type":"application/json"},I=await m.ensureCsrfToken();I&&(y["X-CSRF-Token"]=I);const f=await fetch(i,{method:d,headers:y,credentials:"include",body:JSON.stringify(s)});if(f.status===403&&!e&&(await f.json()).message?.toLowerCase().includes("csrf"))return await m.refreshCsrfToken(),T(!0);if(f.ok)c(t?"Product updated":"Product added","success"),v(),p();else{const B=await f.json();c(B.message||"Could not save","info")}}catch(i){console.error("Save product error:",i),navigator.onLine?c("Could not save. Try again.","info"):c("No internet connection","info")}}async function M(e,t=!1){if(!(!t&&!confirm("Delete this product?")))try{const o={},a=await m.ensureCsrfToken();a&&(o["X-CSRF-Token"]=a);const r=await fetch(`/api/products/${e}`,{method:"DELETE",headers:o,credentials:"include"});if(r.status===403&&!t&&(await r.json()).message?.toLowerCase().includes("csrf"))return await m.refreshCsrfToken(),M(e,!0);if(r.ok)c("Product deleted","success"),p();else{const s=await r.json();c(s.message||"Could not delete","info")}}catch(o){console.error("Delete product error:",o),navigator.onLine?c("Could not delete. Try again.","info"):c("No internet connection","info")}}function x(){E(),document.getElementById("categoryModal").classList.add("show")}function k(){document.getElementById("categoryModal").classList.remove("show"),document.getElementById("newCategoryInput").value=""}function E(){const e=document.getElementById("categoryList");if(e.innerHTML="",!u.length){e.appendChild(n("div",{className:"empty-state"},"No categories yet"));return}const t=document.createDocumentFragment();u.forEach(o=>{const a=l.filter(s=>s.category===o).length,r=n("div",{className:"category-item"},[n("div",{},[n("div",{className:"category-item-name"},o),n("div",{className:"category-item-count"},`${a} product${a!==1?"s":""}`)])]);a===0&&r.appendChild(n("button",{onclick:()=>window.deleteCategory(o),className:"btn-icon danger",style:{width:"32px",height:"32px"}},"×")),t.appendChild(r)}),e.appendChild(t)}function b(){const e=document.getElementById("newCategoryInput"),t=e.value.trim();if(!t){e.focus();return}if(u.includes(t)){c("Category already exists","info"),e.select();return}u.push(t),u.sort(),e.value="",w(),h(),E(),c("Category added","success")}function U(e){const t=l.filter(o=>o.category===e).length;if(t>0){c(`Move or delete ${t} product(s) first`,"info");return}u=u.filter(o=>o!==e),w(),h(),E(),c("Category removed","success")}window.showAddProductForm=S;window.showCategoryModal=x;window.filterByCategory=A;window.searchProducts=C;window.editProductById=$;window.deleteProduct=M;window.closeModal=v;window.closeCategoryModal=k;window.addCategory=b;window.deleteCategory=U;const P=document.getElementById("productModal");P&&(P.onclick=e=>{e.target.id==="productModal"&&v()});const N=document.getElementById("categoryModal");N&&(N.onclick=e=>{e.target.id==="categoryModal"&&k()});j();F();
