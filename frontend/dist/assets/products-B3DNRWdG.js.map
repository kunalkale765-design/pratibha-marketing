{"version":3,"file":"products-B3DNRWdG.js","sources":["../../src/js/pages/products.js"],"sourcesContent":["\nimport { showToast, createElement } from '/js/ui.js';\n\n// Wait for Auth to be available\nconst waitForAuth = (maxWait = 10000) => new Promise((resolve, reject) => {\n    const startTime = Date.now();\n    const check = () => {\n        if (window.Auth) return resolve(window.Auth);\n        if (Date.now() - startTime > maxWait) return reject(new Error('Auth not available'));\n        setTimeout(check, 50);\n    };\n    check();\n});\nconst Auth = await waitForAuth();\n\nlet allProducts = [];\nlet allCategories = [];\nlet selectedCategory = '';\n\nasync function init() {\n    const user = await Auth.requireAuth(['admin', 'staff']);\n    if (!user) return;\n    await loadProducts();\n}\n\nasync function loadProducts() {\n    try {\n        const res = await fetch('/api/products', { credentials: 'include' });\n        if (!res.ok) {\n            throw new Error(`Server returned ${res.status}`);\n        }\n        const data = await res.json();\n        allProducts = data.data || [];\n\n        // Extract unique categories\n        const cats = new Set();\n        allProducts.forEach(p => {\n            if (p.category) cats.add(p.category);\n        });\n        allCategories = Array.from(cats).sort();\n\n        updateCategoryPills();\n        updateCategorySelect();\n        searchProducts();\n    } catch (e) {\n        console.error('Failed to load products:', e);\n        const container = document.getElementById('productsList');\n        const errorMsg = !navigator.onLine ? 'No internet connection' : 'Products not available';\n        container.innerHTML = '';\n        container.appendChild(createElement('div', { className: 'empty-state' }, [\n            createElement('p', {}, errorMsg),\n            createElement('button', {\n                id: 'retryProductsBtn',\n                style: { marginTop: '1rem', padding: '0.5rem 1rem', background: 'var(--dusty-olive)', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' },\n                onclick: loadProducts\n            }, 'Try Again')\n        ]));\n    }\n}\n\nfunction updateCategoryPills() {\n    const container = document.getElementById('categoryPills');\n    container.innerHTML = '';\n    const fragment = document.createDocumentFragment();\n\n    fragment.appendChild(createElement('button', {\n        className: `cat-pill ${selectedCategory === '' ? 'active' : ''}`,\n        onclick: () => window.filterByCategory('')\n    }, 'All'));\n\n    allCategories.forEach(cat => {\n        fragment.appendChild(createElement('button', {\n            className: `cat-pill ${selectedCategory === cat ? 'active' : ''}`,\n            onclick: () => window.filterByCategory(cat)\n        }, cat));\n    });\n\n    container.appendChild(fragment);\n}\n\nfunction updateCategorySelect() {\n    const select = document.getElementById('productCategory');\n    select.innerHTML = '';\n    select.appendChild(createElement('option', { value: '' }, 'Select...'));\n\n    allCategories.forEach(cat => {\n        select.appendChild(createElement('option', { value: cat }, cat));\n    });\n}\n\nfunction filterByCategory(cat) {\n    selectedCategory = cat;\n    updateCategoryPills();\n    searchProducts();\n}\n\nfunction displayProducts(products) {\n    const container = document.getElementById('productsList');\n    container.innerHTML = '';\n\n    if (!products || !products.length) {\n        container.appendChild(createElement('div', { className: 'empty-state' }, 'No products found'));\n        return;\n    }\n\n    // Group products by category\n    const grouped = {};\n    products.forEach(p => {\n        const cat = p.category || 'Uncategorized';\n        if (!grouped[cat]) grouped[cat] = [];\n        grouped[cat].push(p);\n    });\n\n    // Sort categories (Uncategorized at end)\n    const sortedCategories = Object.keys(grouped).sort((a, b) => {\n        if (a === 'Uncategorized') return 1;\n        if (b === 'Uncategorized') return -1;\n        return a.localeCompare(b);\n    });\n\n    const fragment = document.createDocumentFragment();\n    let idx = 0;\n\n    sortedCategories.forEach(cat => {\n        fragment.appendChild(createElement('div', { className: 'category-header' }, cat));\n\n        grouped[cat].forEach(p => {\n            const productCard = createElement('div', {\n                className: 'product-card card-animated card-fade-in',\n                style: { animationDelay: `${idx * 0.05}s` }\n            }, [\n                createElement('div', { className: 'product-info' }, [\n                    createElement('div', { className: 'product-name' }, p.name),\n                    createElement('div', { className: 'product-meta' }, [\n                        createElement('span', {}, p.unit || '')\n                    ])\n                ]),\n                createElement('div', { className: 'product-actions' }, [\n                    createElement('button', {\n                        onclick: () => window.editProductById(p._id),\n                        className: 'btn-icon'\n                    }, '✎'),\n                    createElement('button', {\n                        onclick: () => window.deleteProduct(p._id),\n                        className: 'btn-icon danger'\n                    }, '✕')\n                ])\n            ]);\n            fragment.appendChild(productCard);\n            idx++;\n        });\n    });\n\n    container.appendChild(fragment);\n}\n\nfunction searchProducts() {\n    const q = document.getElementById('searchInput').value.toLowerCase();\n\n    const filtered = allProducts.filter(p => {\n        const matchesSearch = p.name.toLowerCase().includes(q);\n        const matchesCategory = !selectedCategory || p.category === selectedCategory;\n        return matchesSearch && matchesCategory;\n    });\n\n    displayProducts(filtered);\n}\n\nfunction showAddProductForm() {\n    document.getElementById('modalTitle').textContent = 'Add Product';\n    document.getElementById('productForm').reset();\n    document.getElementById('productId').value = '';\n    document.getElementById('productModal').classList.add('show');\n}\n\nfunction editProductById(id) {\n    const product = allProducts.find(p => p._id === id);\n    if (!product) return;\n\n    document.getElementById('modalTitle').textContent = 'Edit Product';\n    document.getElementById('productId').value = product._id;\n    document.getElementById('productName').value = product.name;\n    document.getElementById('productCategory').value = product.category || '';\n    document.getElementById('productUnit').value = product.unit;\n    document.getElementById('productModal').classList.add('show');\n\n    // Add unit change warning for existing products\n    const unitSelect = document.getElementById('productUnit');\n    const originalUnit = product.unit;\n    unitSelect.onchange = function () {\n        if (this.value !== originalUnit) {\n            if (!confirm('Changing unit may affect existing orders. Continue?')) {\n                this.value = originalUnit;\n            }\n        }\n    };\n}\n\nfunction closeModal() {\n    document.getElementById('productModal').classList.remove('show');\n}\n\nfunction setupFormListeners() {\n    const form = document.getElementById('productForm');\n    if (form) {\n        form.addEventListener('submit', async (e) => {\n            e.preventDefault();\n            await saveProduct();\n        });\n    }\n\n    // Add category on Enter key\n    const newCatInput = document.getElementById('newCategoryInput');\n    if (newCatInput) {\n        newCatInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') {\n                e.preventDefault();\n                addCategory();\n            }\n        });\n    }\n}\n\nasync function saveProduct(_isRetry = false) {\n    const id = document.getElementById('productId').value;\n    const category = document.getElementById('productCategory').value;\n    const name = document.getElementById('productName').value.trim();\n    const unit = document.getElementById('productUnit').value;\n    const btn = document.querySelector('#productForm button[type=\"submit\"]') || document.getElementById('saveProductBtn');\n\n    // Client-side validation\n    if (!name) {\n        showToast('Please enter product name', 'info');\n        document.getElementById('productName').focus();\n        return;\n    }\n\n    if (!unit) {\n        showToast('Please select a unit', 'info');\n        document.getElementById('productUnit').focus();\n        return;\n    }\n\n    if (btn) { btn.disabled = true; btn.classList.add('btn-loading'); }\n\n    const data = {\n        name: name,\n        unit: unit\n    };\n    if (category) data.category = category;\n\n    try {\n        const url = id ? `/api/products/${id}` : '/api/products';\n        const method = id ? 'PUT' : 'POST';\n\n        const headers = { 'Content-Type': 'application/json' };\n        const csrfToken = await Auth.ensureCsrfToken();\n        if (csrfToken) {\n            headers['X-CSRF-Token'] = csrfToken;\n        }\n\n        const res = await fetch(url, {\n            method,\n            headers,\n            credentials: 'include',\n            body: JSON.stringify(data)\n        });\n\n        // Handle CSRF error with retry\n        if (res.status === 403 && !_isRetry) {\n            const err = await res.json();\n            if (err.message?.toLowerCase().includes('csrf')) {\n                await Auth.refreshCsrfToken();\n                return saveProduct(true);\n            }\n            // Non-CSRF 403: show error from already-parsed response\n            showToast(err.message || 'Could not save', 'info');\n            return;\n        }\n\n        if (res.ok) {\n            showToast(id ? 'Product updated' : 'Product added', 'success');\n            closeModal();\n            loadProducts();\n        } else {\n            const err = await res.json();\n            showToast(err.message || 'Could not save', 'info');\n        }\n    } catch (e) {\n        console.error('Save product error:', e);\n        if (!navigator.onLine) {\n            showToast('No internet connection', 'info');\n        } else {\n            showToast('Could not save. Try again.', 'info');\n        }\n    } finally {\n        if (btn) { btn.disabled = false; btn.classList.remove('btn-loading'); }\n    }\n}\n\nasync function deleteProduct(id, _isRetry = false) {\n    if (!_isRetry && !confirm('Delete this product?')) return;\n\n    // Disable all delete buttons to prevent double-clicks\n    const allDeleteBtns = document.querySelectorAll('.btn-icon.danger');\n    allDeleteBtns.forEach(btn => { btn.disabled = true; });\n\n    try {\n        const headers = {};\n        const csrfToken = await Auth.ensureCsrfToken();\n        if (csrfToken) {\n            headers['X-CSRF-Token'] = csrfToken;\n        }\n\n        const res = await fetch(`/api/products/${id}`, {\n            method: 'DELETE',\n            headers,\n            credentials: 'include'\n        });\n\n        // Handle CSRF error with retry\n        if (res.status === 403 && !_isRetry) {\n            const err = await res.json();\n            if (err.message?.toLowerCase().includes('csrf')) {\n                await Auth.refreshCsrfToken();\n                return deleteProduct(id, true);\n            }\n            showToast(err.message || 'Could not delete', 'info');\n            return;\n        }\n\n        if (res.ok) {\n            showToast('Product deleted', 'success');\n            loadProducts();\n        } else {\n            const err = await res.json();\n            showToast(err.message || 'Could not delete', 'info');\n        }\n    } catch (e) {\n        console.error('Delete product error:', e);\n        if (!navigator.onLine) {\n            showToast('No internet connection', 'info');\n        } else {\n            showToast('Could not delete. Try again.', 'info');\n        }\n    } finally {\n        const allDeleteBtns = document.querySelectorAll('.btn-icon.danger');\n        allDeleteBtns.forEach(btn => { btn.disabled = false; });\n    }\n}\n\n// Category Management\nfunction showCategoryModal() {\n    displayCategoryList();\n    document.getElementById('categoryModal').classList.add('show');\n}\n\nfunction closeCategoryModal() {\n    document.getElementById('categoryModal').classList.remove('show');\n    document.getElementById('newCategoryInput').value = '';\n}\n\nfunction displayCategoryList() {\n    const container = document.getElementById('categoryList');\n    container.innerHTML = '';\n\n    if (!allCategories.length) {\n        container.appendChild(createElement('div', { className: 'empty-state' }, 'No categories yet'));\n        return;\n    }\n\n    const fragment = document.createDocumentFragment();\n\n    allCategories.forEach(cat => {\n        const count = allProducts.filter(p => p.category === cat).length;\n        const item = createElement('div', { className: 'category-item' }, [\n            createElement('div', {}, [\n                createElement('div', { className: 'category-item-name' }, cat),\n                createElement('div', { className: 'category-item-count' }, `${count} product${count !== 1 ? 's' : ''}`)\n            ])\n        ]);\n\n        if (count === 0) {\n            item.appendChild(createElement('button', {\n                onclick: () => window.deleteCategory(cat),\n                className: 'btn-icon danger',\n                style: { width: '32px', height: '32px' }\n            }, '×'));\n        }\n\n        fragment.appendChild(item);\n    });\n\n    container.appendChild(fragment);\n}\n\nfunction addCategory() {\n    const input = document.getElementById('newCategoryInput');\n    const name = input.value.trim();\n\n    if (!name) {\n        // Focus the input to guide user\n        input.focus();\n        return;\n    }\n\n    if (allCategories.some(cat => cat.toLowerCase() === name.toLowerCase())) {\n        showToast('Category already exists', 'info');\n        input.select();\n        return;\n    }\n\n    allCategories.push(name);\n    allCategories.sort();\n\n    input.value = '';\n    updateCategoryPills();\n    updateCategorySelect();\n    displayCategoryList();\n    showToast('Category added', 'success');\n}\n\nfunction deleteCategory(name) {\n    const count = allProducts.filter(p => p.category === name).length;\n    if (count > 0) {\n        showToast(`Move or delete ${count} product(s) first`, 'info');\n        return;\n    }\n\n    allCategories = allCategories.filter(c => c !== name);\n    updateCategoryPills();\n    updateCategorySelect();\n    displayCategoryList();\n    showToast('Category removed', 'success');\n}\n\n// Expose functions to window for inline handlers\nwindow.showAddProductForm = showAddProductForm;\nwindow.showCategoryModal = showCategoryModal;\nwindow.filterByCategory = filterByCategory;\nwindow.searchProducts = searchProducts;\nwindow.editProductById = editProductById;\nwindow.deleteProduct = deleteProduct;\nwindow.closeModal = closeModal;\nwindow.closeCategoryModal = closeCategoryModal;\nwindow.addCategory = addCategory;\nwindow.deleteCategory = deleteCategory;\n\n// Close modals on overlay click\n// We should check existence as scripts load\nconst productModal = document.getElementById('productModal');\nif (productModal) {\n    productModal.onclick = (e) => {\n        if (e.target.id === 'productModal') closeModal();\n    };\n}\nconst categoryModal = document.getElementById('categoryModal');\nif (categoryModal) {\n    categoryModal.onclick = (e) => {\n        if (e.target.id === 'categoryModal') closeCategoryModal();\n    };\n}\n\nsetupFormListeners();\n\ninit();\n"],"names":["waitForAuth","maxWait","resolve","reject","startTime","check","Auth","allProducts","allCategories","selectedCategory","init","loadProducts","res","cats","p","updateCategoryPills","updateCategorySelect","searchProducts","container","errorMsg","createElement","fragment","cat","select","filterByCategory","displayProducts","products","grouped","sortedCategories","a","b","idx","productCard","q","filtered","matchesSearch","matchesCategory","showAddProductForm","editProductById","id","product","unitSelect","originalUnit","closeModal","setupFormListeners","form","e","saveProduct","newCatInput","addCategory","_isRetry","category","name","unit","btn","showToast","data","url","method","headers","csrfToken","err","deleteProduct","showCategoryModal","displayCategoryList","closeCategoryModal","count","item","input","deleteCategory","c","productModal","categoryModal"],"mappings":"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"}