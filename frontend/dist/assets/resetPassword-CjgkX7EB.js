import"./responsive-C3eqjYrO.js";/* empty css               *//* empty css                *//* empty css              */const w=document.getElementById("resetForm"),t=document.getElementById("noticeMessage"),p=document.getElementById("passwordToggle"),l=document.getElementById("password");p.addEventListener("click",()=>{const e=l.type==="password"?"text":"password";l.type=e,p.textContent=e==="password"?"◉":"◎"});const y=new URLSearchParams(window.location.search),u=y.get("token");u||(t.textContent="Invalid reset link. Please request a new one.",t.classList.add("error","show"),w.querySelector('button[type="submit"]').disabled=!0);u&&history.replaceState(null,"",window.location.pathname);const m=document.createElement("div");m.className="password-requirements";m.style.cssText="margin-top: 0.5rem; font-size: 0.8rem;";m.innerHTML=`
            <div id="req-length" style="color: var(--text-muted);">◯ At least 6 characters</div>
            <div id="req-upper" style="color: var(--text-muted);">◯ One uppercase letter</div>
            <div id="req-lower" style="color: var(--text-muted);">◯ One lowercase letter</div>
            <div id="req-number" style="color: var(--text-muted);">◯ One number</div>
        `;l.parentElement.after(m);l.addEventListener("input",function(){const e=this.value;c("req-length",e.length>=6),c("req-upper",/[A-Z]/.test(e)),c("req-lower",/[a-z]/.test(e)),c("req-number",/[0-9]/.test(e))});function c(e,s){const r=document.getElementById(e);if(!r)return;const o=r.textContent.substring(2);r.textContent=(s?"✓ ":"◯ ")+o,r.style.color=s?"var(--success)":"var(--text-muted)"}w.addEventListener("submit",async e=>{e.preventDefault();const s=document.getElementById("password").value,r=document.getElementById("confirmPassword").value,o=document.getElementById("resetBtn");if(t.classList.remove("show","error","success"),s.length<6||!/[A-Z]/.test(s)||!/[a-z]/.test(s)||!/[0-9]/.test(s)){t.textContent="Password does not meet requirements",t.classList.add("error","show");return}if(s!==r){t.textContent="Passwords do not match",t.classList.add("error","show");return}o.classList.add("btn-loading"),o.disabled=!0;try{await fetch("/api/csrf-token",{credentials:"include"});const d=document.cookie.split("; ").find(i=>i.startsWith("csrf_token=")),f=d?d.split("=")[1]:"";let n=await fetch(`/api/auth/reset-password/${u}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":f},credentials:"include",body:JSON.stringify({password:s})}),a=await n.json();if(n.status===403&&a?.message?.toLowerCase().includes("csrf")){await fetch("/api/csrf-token",{credentials:"include"});const i=document.cookie.split("; ").find(g=>g.startsWith("csrf_token=")),h=i?i.split("=")[1]:"";n=await fetch(`/api/auth/reset-password/${u}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":h},credentials:"include",body:JSON.stringify({password:s})}),a=await n.json()}if(n.status===429)throw new Error("Too many attempts. Please try again later.");if(n.ok&&a.success)t.textContent="Password reset successful! Redirecting...",t.classList.add("success","show"),o.classList.remove("btn-loading"),o.classList.add("btn-success"),setTimeout(()=>{a.user?.role==="customer"?window.location.href="/pages/order-form/":window.location.href="/"},1500);else throw new Error(a.message||a.errors?.[0]?.msg||"Reset failed")}catch(d){t.textContent=d.message,t.classList.add("error","show"),o.classList.remove("btn-loading"),o.disabled=!1}});
