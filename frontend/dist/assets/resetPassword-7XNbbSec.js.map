{"version":3,"file":"resetPassword-7XNbbSec.js","sources":["../../src/pages/auth/reset-password.html?html-proxy&index=0.js"],"sourcesContent":["\n        const form = document.getElementById('resetForm');\n        const notice = document.getElementById('noticeMessage');\n        const passwordToggle = document.getElementById('passwordToggle');\n        const passwordInput = document.getElementById('password');\n\n        // Toggle password visibility\n        passwordToggle.addEventListener('click', () => {\n            const type = passwordInput.type === 'password' ? 'text' : 'password';\n            passwordInput.type = type;\n            passwordToggle.textContent = type === 'password' ? '◉' : '◎';\n        });\n\n        // Get token from URL\n        const urlParams = new URLSearchParams(window.location.search);\n        const token = urlParams.get('token');\n\n        if (!token) {\n            notice.textContent = 'Invalid reset link. Please request a new one.';\n            notice.classList.add('error', 'show');\n            form.querySelector('button[type=\"submit\"]').disabled = true;\n        }\n\n        // Remove token from URL for cleanliness\n        if (token) {\n            history.replaceState(null, '', window.location.pathname);\n        }\n\n        // Password requirement validation\n        const reqContainer = document.createElement('div');\n        reqContainer.className = 'password-requirements';\n        reqContainer.style.cssText = 'margin-top: 0.5rem; font-size: 0.8rem;';\n        reqContainer.innerHTML = `\n            <div id=\"req-length\" style=\"color: var(--text-muted);\">◯ At least 6 characters</div>\n            <div id=\"req-upper\" style=\"color: var(--text-muted);\">◯ One uppercase letter</div>\n            <div id=\"req-lower\" style=\"color: var(--text-muted);\">◯ One lowercase letter</div>\n            <div id=\"req-number\" style=\"color: var(--text-muted);\">◯ One number</div>\n        `;\n        passwordInput.parentElement.after(reqContainer);\n\n        passwordInput.addEventListener('input', function() {\n            const val = this.value;\n            updateReq('req-length', val.length >= 6);\n            updateReq('req-upper', /[A-Z]/.test(val));\n            updateReq('req-lower', /[a-z]/.test(val));\n            updateReq('req-number', /[0-9]/.test(val));\n        });\n\n        function updateReq(id, valid) {\n            const el = document.getElementById(id);\n            if (!el) return;\n            const text = el.textContent.substring(2);\n            el.textContent = (valid ? '✓ ' : '◯ ') + text;\n            el.style.color = valid ? 'var(--success)' : 'var(--text-muted)';\n        }\n\n        form.addEventListener('submit', async (e) => {\n            e.preventDefault();\n            const password = document.getElementById('password').value;\n            const confirmPassword = document.getElementById('confirmPassword').value;\n            const btn = document.getElementById('resetBtn');\n\n            notice.classList.remove('show', 'error', 'success');\n\n            if (password.length < 6 || !/[A-Z]/.test(password) || !/[a-z]/.test(password) || !/[0-9]/.test(password)) {\n                notice.textContent = 'Password does not meet requirements';\n                notice.classList.add('error', 'show');\n                return;\n            }\n\n            if (password !== confirmPassword) {\n                notice.textContent = 'Passwords do not match';\n                notice.classList.add('error', 'show');\n                return;\n            }\n\n            btn.classList.add('btn-loading');\n            btn.disabled = true;\n\n            try {\n                // Pre-fetch CSRF token\n                await fetch('/api/csrf-token', { credentials: 'include' });\n                const csrfCookie = document.cookie.split('; ').find(row => row.startsWith('csrf_token='));\n                const csrfToken = csrfCookie ? csrfCookie.split('=')[1] : '';\n\n                let res = await fetch(`/api/auth/reset-password/${token}`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRF-Token': csrfToken\n                    },\n                    credentials: 'include',\n                    body: JSON.stringify({ password })\n                });\n\n                let data = await res.json();\n\n                // Retry on CSRF error\n                if (res.status === 403 && data?.message?.toLowerCase().includes('csrf')) {\n                    await fetch('/api/csrf-token', { credentials: 'include' });\n                    const retryCookie = document.cookie.split('; ').find(row => row.startsWith('csrf_token='));\n                    const retryToken = retryCookie ? retryCookie.split('=')[1] : '';\n                    res = await fetch(`/api/auth/reset-password/${token}`, {\n                        method: 'POST',\n                        headers: {\n                            'Content-Type': 'application/json',\n                            'X-CSRF-Token': retryToken\n                        },\n                        credentials: 'include',\n                        body: JSON.stringify({ password })\n                    });\n                    data = await res.json();\n                }\n\n                if (res.status === 429) {\n                    throw new Error('Too many attempts. Please try again later.');\n                }\n\n                if (res.ok && data.success) {\n                    notice.textContent = 'Password reset successful! Redirecting...';\n                    notice.classList.add('success', 'show');\n                    btn.classList.remove('btn-loading');\n                    btn.classList.add('btn-success');\n\n                    // Redirect based on role\n                    setTimeout(() => {\n                        const role = data.user?.role;\n                        if (role === 'customer') {\n                            window.location.href = '/pages/order-form/';\n                        } else {\n                            window.location.href = '/';\n                        }\n                    }, 1500);\n                } else {\n                    throw new Error(data.message || data.errors?.[0]?.msg || 'Reset failed');\n                }\n            } catch (err) {\n                notice.textContent = err.message;\n                notice.classList.add('error', 'show');\n                btn.classList.remove('btn-loading');\n                btn.disabled = false;\n            }\n        });\n    "],"names":["form","notice","passwordToggle","passwordInput","type","urlParams","token","reqContainer","val","updateReq","id","valid","el","text","password","confirmPassword","btn","csrfCookie","row","csrfToken","res","data","retryCookie","retryToken","err"],"mappings":"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"}