{"version":3,"file":"orderForm-BmUdC975.js","sources":["../../src/js/pages/order-form.js"],"sourcesContent":["\nimport { showToast, createElement } from '/js/ui.js';\nimport { logout } from '/js/init.js';\n\n// Wait for Auth to be available\nconst waitForAuth = (maxWait = 10000) => new Promise((resolve, reject) => {\n    const startTime = Date.now();\n    const check = () => {\n        if (window.Auth) return resolve(window.Auth);\n        if (Date.now() - startTime > maxWait) return reject(new Error('Auth not available'));\n        setTimeout(check, 50);\n    };\n    check();\n});\nconst Auth = await waitForAuth();\n\n// Logout button\nconst logoutBtn = document.getElementById('logoutBtn');\nif (logoutBtn) logoutBtn.addEventListener('click', logout);\n\n// Customer selector change\nconst customerSelect = document.getElementById('customerSelect');\nif (customerSelect) customerSelect.addEventListener('change', onCustomerChange);\n\nlet currentUser = null;\nlet selectedCustomer = null;\nlet products = [];\nconst marketRates = {};\nlet customers = [];\nlet isStaff = false;\nlet _orderFormDirty = false;\n\nasync function init() {\n    // Check for magic link token in URL\n    const urlParams = new URLSearchParams(window.location.search);\n    const magicToken = urlParams.get('token');\n\n    if (magicToken) {\n        // Authenticate via magic link\n        try {\n            const res = await fetch(`/api/auth/magic/${magicToken}`, {\n                credentials: 'include'\n            });\n            const data = await res.json();\n\n            if (res.ok && data.user) {\n                currentUser = data.user;\n                Auth.setUser(data.user);\n                // Remove token from URL for cleaner bookmarking\n                window.history.replaceState({}, '', window.location.pathname);\n            } else {\n                showToast(data.message || 'Link expired. Please request a new one.', 'info');\n                window.location.href = '/pages/auth/login.html';\n                return;\n            }\n        } catch (_e) {\n            showToast('Authentication issue. Please refresh.', 'info');\n            window.location.href = '/pages/auth/login.html';\n            return;\n        }\n    } else {\n        // Normal authentication\n        currentUser = await Auth.verify();\n        if (!currentUser) {\n            window.location.href = '/pages/auth/login.html';\n            return;\n        }\n    }\n\n    isStaff = currentUser.role === 'admin' || currentUser.role === 'staff';\n    await loadData();\n\n    if (isStaff) {\n        const customerBar = document.getElementById('customerBar');\n        if (customerBar) customerBar.classList.add('show');\n        populateCustomers();\n    } else {\n        if (currentUser.customer) {\n            selectedCustomer = typeof currentUser.customer === 'object'\n                ? currentUser.customer\n                : { _id: currentUser.customer, pricingType: 'market' };\n            renderProducts();\n        } else {\n            const list = document.getElementById('productList');\n            if (list) {\n                list.innerHTML = '';\n                list.appendChild(createElement('div', { className: 'empty-state' }, 'Account setup in progress. Please check back later.'));\n            }\n        }\n    }\n}\n\nasync function loadData() {\n    try {\n        const [productsRes, ratesRes, customersRes] = await Promise.all([\n            fetch('/api/products', { credentials: 'include' }),\n            fetch('/api/market-rates', { credentials: 'include' }),\n            fetch('/api/customers', { credentials: 'include' }).catch(() => ({ ok: false }))\n        ]);\n\n        if (productsRes.ok) {\n            const data = await productsRes.json();\n            products = (data?.data || []).filter(p => p.isActive !== false);\n        }\n\n        if (ratesRes.ok) {\n            const data = await ratesRes.json();\n            (data?.data || []).forEach(rate => {\n                const pid = typeof rate.product === 'object' ? rate.product._id : rate.product;\n                if (pid) marketRates[pid] = rate.rate;\n            });\n        }\n\n        if (customersRes.ok) {\n            const data = await customersRes.json();\n            customers = (data?.data || []).filter(c => c.isActive !== false);\n        }\n    } catch (e) {\n        console.error('Failed to load data:', e);\n        // Show retry UI instead of just a toast\n        const productList = document.getElementById('productList');\n        if (productList) {\n            productList.innerHTML = '';\n            productList.appendChild(createElement('div', { className: 'empty-state' }, [\n                createElement('p', {}, 'Products not available'),\n                createElement('button', {\n                    id: 'retryDataBtn',\n                    style: { marginTop: '1rem', padding: '0.5rem 1rem', background: 'var(--dusty-olive)', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' },\n                    onclick: () => loadData().then(() => { if (selectedCustomer) renderProducts(); })\n                }, 'Try Again')\n            ]));\n        }\n    }\n}\n\nfunction populateCustomers() {\n    const select = document.getElementById('customerSelect');\n\n    // Show loading placeholder while customers load\n    if (customers.length === 0) {\n        const loadingOption = createElement('option', { value: '', disabled: true, selected: true }, 'Loading customers...');\n        select.appendChild(loadingOption);\n        return;\n    }\n\n    // Clear loading placeholder and add actual customers\n    select.innerHTML = '';\n    select.appendChild(createElement('option', { value: '' }, 'Select customer'));\n\n    customers.forEach(c => {\n        select.appendChild(createElement('option', { value: c._id }, c.name));\n    });\n}\n\nfunction onCustomerChange() {\n    const id = document.getElementById('customerSelect').value;\n    selectedCustomer = customers.find(c => c._id === id) || null;\n    if (selectedCustomer) {\n        renderProducts();\n    } else {\n        const list = document.getElementById('productList');\n        list.innerHTML = '';\n        list.appendChild(createElement('div', { className: 'empty-state' }, 'Select a customer to start'));\n    }\n    updateSummary();\n}\n\n// Helper to safely get contract price (handles Map serialization edge cases)\nfunction getContractPrice(contractPrices, productId) {\n    if (!contractPrices) return null;\n    // Try direct property access (normal object)\n    if (contractPrices[productId] !== undefined) {\n        return contractPrices[productId];\n    }\n    // Try .get() in case it's still a Map-like structure\n    if (typeof contractPrices.get === 'function') {\n        return contractPrices.get(productId);\n    }\n    return null;\n}\n\nfunction getPrice(product) {\n    if (!selectedCustomer) return marketRates[product._id] || 0;\n    const type = selectedCustomer.pricingType || 'market';\n    if (type === 'contract') {\n        const contractPrice = getContractPrice(selectedCustomer.contractPrices, product._id);\n        return contractPrice !== null ? contractPrice : (marketRates[product._id] || 0);\n    } else if (type === 'markup') {\n        const rate = marketRates[product._id] || 0;\n        return Math.round(rate * (1 + (selectedCustomer.markupPercentage || 0) / 100));\n    }\n    return marketRates[product._id] || 0;\n}\n\n// Filter products for contract customers (only show products with contract prices)\nfunction getFilteredProducts() {\n    // Staff/admin always see all products\n    if (isStaff) {\n        return products;\n    }\n\n    // Non-contract customers see all products\n    if (!selectedCustomer || selectedCustomer.pricingType !== 'contract') {\n        return products;\n    }\n\n    // Contract customers: filter to only products they have access to\n    // For customers (non-staff), use allowedProducts array (doesn't expose prices)\n    // For staff selecting a customer, use contractPrices keys\n    const allowedProductIds = selectedCustomer.allowedProducts\n        || (selectedCustomer.contractPrices ? Object.keys(selectedCustomer.contractPrices) : []);\n\n    // If no contract products configured, return empty array\n    if (allowedProductIds.length === 0) {\n        return [];\n    }\n\n    return products.filter(p => allowedProductIds.includes(p._id));\n}\n\nfunction buildCategoryPills(displayProducts = products) {\n    const categories = [...new Set(displayProducts.map(p => p.category || 'Other'))];\n    const container = document.getElementById('categoryPills');\n    container.innerHTML = '';\n\n    // Hide pills if no products or only one category\n    if (displayProducts.length === 0 || categories.length <= 1) {\n        container.style.display = 'none';\n        return;\n    }\n\n    container.style.display = 'flex';\n\n    container.appendChild(createElement('button', {\n        className: 'cat-pill active',\n        dataset: { cat: 'all' },\n        onclick: () => filterByCategory('all')\n    }, 'All'));\n\n    categories.forEach(cat => {\n        container.appendChild(createElement('button', {\n            className: 'cat-pill',\n            dataset: { cat },\n            onclick: () => filterByCategory(cat)\n        }, cat));\n    });\n}\n\nfunction filterByCategory(cat) {\n    document.querySelectorAll('.cat-pill').forEach(t => t.classList.remove('active'));\n    const activeBtn = document.querySelector(`.cat-pill[data-cat=\"${cat}\"]`);\n    if (activeBtn) activeBtn.classList.add('active');\n\n    document.querySelectorAll('.product-item').forEach(item => {\n        item.style.display = (cat === 'all' || item.dataset.category === cat) ? '' : 'none';\n    });\n\n    document.querySelectorAll('.category-header').forEach(header => {\n        header.style.display = (cat === 'all' || header.dataset.category === cat) ? '' : 'none';\n    });\n}\n\nfunction renderProducts() {\n    const container = document.getElementById('productList');\n    container.innerHTML = '';\n\n    // Get filtered products based on customer type\n    const displayProducts = getFilteredProducts();\n\n    if (!displayProducts.length) {\n        // Different message for contract customers with no products configured\n        const isContractWithNoProducts = selectedCustomer &&\n            selectedCustomer.pricingType === 'contract' &&\n            products.length > 0;\n\n        const message = isContractWithNoProducts\n            ? 'No products configured for your account. Please contact us to set up pricing.'\n            : 'No products available';\n\n        container.appendChild(createElement('div', { className: 'empty-state' }, message));\n        return;\n    }\n\n    buildCategoryPills(displayProducts);\n\n    const grouped = {};\n    displayProducts.forEach(p => {\n        const cat = p.category || 'Other';\n        if (!grouped[cat]) grouped[cat] = [];\n        grouped[cat].push(p);\n    });\n\n    const fragment = document.createDocumentFragment();\n\n    for (const [cat, prods] of Object.entries(grouped)) {\n        fragment.appendChild(createElement('div', {\n            className: 'category-header',\n            dataset: { category: cat }\n        }, cat));\n\n        prods.forEach(p => {\n            // Only calculate price for staff - customers should never see prices\n            const price = isStaff ? getPrice(p) : 0;\n            // Use step=\"1\" for piece items to enforce whole numbers\n            const step = p.unit === 'piece' ? '1' : '0.01';\n\n            // Build dataset - only include price for staff (customers should never see prices)\n            const itemDataset = {\n                id: p._id,\n                category: cat,\n                unit: p.unit\n            };\n            // SECURITY: Only expose price to staff in DOM - customers get server-calculated prices\n            if (isStaff) {\n                itemDataset.price = price;\n            }\n\n            const productItem = createElement('div', {\n                className: 'product-item',\n                dataset: itemDataset\n            }, [\n                createElement('div', { className: 'product-info' }, [\n                    createElement('div', { className: 'product-name' }, p.name),\n                    createElement('div', { className: 'product-meta' }, p.unit)\n                ]),\n                createElement('div', { className: 'qty-controls' }, [\n                    createElement('button', {\n                        className: 'qty-btn',\n                        onclick: () => window.changeQty(p._id, -1)\n                    }, 'âˆ’'),\n                    createElement('input', {\n                        type: 'number',\n                        className: 'qty-input',\n                        id: `qty-${p._id}`,\n                        value: '0',\n                        min: '0',\n                        step: step,\n                        inputmode: 'numeric',\n                        onfocus: (e) => window.clearZero(e.target),\n                        onblur: (e) => window.restoreZero(e.target),\n                        onchange: () => window.updateFromInput(p._id)\n                    }),\n                    createElement('button', {\n                        className: 'qty-btn',\n                        onclick: () => window.changeQty(p._id, 1)\n                    }, '+')\n                ])\n            ]);\n            fragment.appendChild(productItem);\n        });\n    }\n\n    container.appendChild(fragment);\n}\n\n// Expose qty functions to window for inline handlers\nfunction clearZero(input) {\n    if (input.value === '0') input.value = '';\n    input.select();\n}\n\nfunction restoreZero(input) {\n    if (input.value === '') input.value = '0';\n    updateFromInput(input.id.replace('qty-', ''));\n}\n\nfunction changeQty(id, delta) {\n    const input = document.getElementById('qty-' + id);\n    let val = parseFloat(input.value) || 0;\n    val = Math.max(0, val + delta);\n    input.value = val;\n    updateItem(id, val);\n}\n\nfunction updateFromInput(id) {\n    const input = document.getElementById('qty-' + id);\n    const val = Math.max(0, parseFloat(input.value) || 0);\n    input.value = val;\n    updateItem(id, val);\n}\n\nfunction updateItem(id, qty) {\n    const item = document.querySelector(`.product-item[data-id=\"${id}\"]`);\n    const input = document.getElementById('qty-' + id);\n\n    if (item && input) {\n        if (qty > 0) {\n            item.classList.add('has-qty');\n            input.classList.add('has-value');\n        } else {\n            item.classList.remove('has-qty');\n            input.classList.remove('has-value');\n        }\n    }\n\n    updateSummary();\n}\n\nfunction updateSummary() {\n    let items = 0;\n\n    document.querySelectorAll('.product-item').forEach(item => {\n        const id = item.dataset.id;\n        const input = document.getElementById('qty-' + id);\n        const qty = parseFloat(input?.value) || 0;\n        if (qty > 0) items++;\n    });\n\n    const itemCountEl = document.getElementById('itemCount');\n    const orderBtn = document.getElementById('orderBtn');\n    if (itemCountEl) itemCountEl.textContent = items;\n    if (orderBtn) orderBtn.disabled = items === 0 || !selectedCustomer;\n}\n\n// Search\nconst searchInput = document.getElementById('searchInput');\nif (searchInput) {\n    searchInput.addEventListener('input', (e) => {\n        const q = e.target.value.toLowerCase();\n\n        document.querySelectorAll('.product-item').forEach(item => {\n            const name = item.querySelector('.product-name').textContent.toLowerCase();\n            item.style.display = name.includes(q) ? '' : 'none';\n        });\n\n        document.querySelectorAll('.category-header').forEach(header => {\n            const cat = header.dataset.category;\n            const hasVisible = [...document.querySelectorAll(`.product-item[data-category=\"${cat}\"]`)]\n                .some(i => i.style.display !== 'none');\n            header.style.display = hasVisible ? '' : 'none';\n        });\n    });\n}\n\n// Expose placeOrder to window for inline handler\nasync function placeOrder() {\n    if (!selectedCustomer) return;\n\n    const orderProducts = [];\n    const pieceErrors = [];\n\n    document.querySelectorAll('.product-item').forEach(item => {\n        const id = item.dataset.id;\n        const input = document.getElementById('qty-' + id);\n        const rawValue = parseFloat(input?.value) || 0;\n        const qty = rawValue;\n        // Only staff have price in dataset - customers get server-calculated prices\n        const price = isStaff ? (parseFloat(item.dataset.price) || 0) : 0;\n        const unit = item.dataset.unit;\n        const name = item.querySelector('.product-name')?.textContent || 'Unknown';\n\n        if (qty > 0) {\n            // Validate piece quantities are whole numbers\n            if (unit === 'piece' && !Number.isInteger(qty)) {\n                pieceErrors.push(name);\n            }\n            // Only include rate for staff if > 0; customers always get backend-calculated prices\n            const orderProduct = { product: id, quantity: qty };\n            if (isStaff && price > 0) {\n                orderProduct.rate = price;\n            }\n            orderProducts.push(orderProduct);\n        }\n    });\n\n    // Show info if piece items have decimal quantities\n    if (pieceErrors.length > 0) {\n        showToast(`${pieceErrors.join(', ')}: use whole numbers`, 'info');\n        return;\n    }\n\n    if (!orderProducts.length) return;\n\n    const btn = document.getElementById('orderBtn');\n    btn.disabled = true;\n    btn.textContent = 'Placing...';\n\n    try {\n        const headers = { 'Content-Type': 'application/json' };\n        const csrfToken = await Auth.ensureCsrfToken();\n        if (csrfToken) {\n            headers['X-CSRF-Token'] = csrfToken;\n        }\n\n        const notesInput = document.getElementById('orderNotes');\n        const notes = notesInput?.value?.trim() || '';\n\n        const orderPayload = {\n            customer: selectedCustomer._id,\n            products: orderProducts,\n            idempotencyKey: crypto.randomUUID()\n        };\n\n        if (notes) {\n            orderPayload.notes = notes;\n        }\n\n        let res = await fetch('/api/orders', {\n            method: 'POST',\n            headers,\n            credentials: 'include',\n            body: JSON.stringify(orderPayload)\n        });\n\n        let data = await res.json();\n\n        // Handle CSRF error with retry\n        if (res.status === 403 && data?.message?.toLowerCase().includes('csrf')) {\n            const newToken = await Auth.refreshCsrfToken();\n            if (newToken) {\n                headers['X-CSRF-Token'] = newToken;\n                res = await fetch('/api/orders', {\n                    method: 'POST',\n                    headers,\n                    credentials: 'include',\n                    body: JSON.stringify(orderPayload)\n                });\n                data = await res.json();\n            }\n        }\n\n        if (res.ok) {\n            const orderNum = data?.data?.orderNumber || 'New';\n            showToast(`Order placed! #${orderNum}`, 'success');\n\n            // Show warning if contract pricing fallback was used\n            if (data.warning) {\n                setTimeout(() => {\n                    showToast(data.warning, 'info');\n                }, 1500);\n            }\n\n            // Show confirmation if new contract prices were saved\n            if (data.message && data.newContractPrices && data.newContractPrices.length > 0) {\n                setTimeout(() => {\n                    showToast(data.message, 'info');\n                }, data.warning ? 3000 : 1500); // Delay if warning shown first\n            }\n\n            document.querySelectorAll('.qty-input').forEach(input => {\n                input.value = '0';\n                input.classList.remove('has-value');\n            });\n            document.querySelectorAll('.product-item').forEach(item => {\n                item.classList.remove('has-qty');\n            });\n            // Clear notes field\n            if (notesInput) notesInput.value = '';\n            updateSummary();\n        } else {\n            showToast(data.message || 'Could not place order', 'info');\n        }\n    } catch (e) {\n        console.error('Order placement error:', e);\n        if (!navigator.onLine) {\n            showToast('No internet connection', 'info');\n        } else {\n            showToast('Could not place order. Try again.', 'info');\n        }\n    } finally {\n        if (btn) {\n            btn.disabled = false;\n            btn.textContent = 'Place Order';\n        }\n        updateSummary();\n    }\n}\n\n// ====================\n// TAB MANAGEMENT\n// ====================\nlet _activeTab = 'new';\n\nfunction switchTab(tabName) {\n    _activeTab = tabName;\n\n    // Update tab buttons\n    document.querySelectorAll('.order-tab').forEach(tab => {\n        tab.classList.toggle('active', tab.dataset.tab === tabName);\n    });\n\n    // Update views\n    document.querySelectorAll('.order-view').forEach(view => {\n        view.classList.remove('active');\n    });\n\n    if (tabName === 'new') {\n        const newOrderView = document.getElementById('newOrderView');\n        if (newOrderView) newOrderView.classList.add('active');\n    } else if (tabName === 'list') {\n        const ordersListView = document.getElementById('ordersListView');\n        if (ordersListView) ordersListView.classList.add('active');\n        loadMyOrders();\n    }\n}\n\nconst newOrderTab = document.getElementById('newOrderTab');\nconst myOrdersTab = document.getElementById('myOrdersTab');\nif (newOrderTab) newOrderTab.addEventListener('click', () => switchTab('new'));\nif (myOrdersTab) myOrdersTab.addEventListener('click', () => switchTab('list'));\n\n// ====================\n// ORDERS LIST\n// ====================\nlet myOrders = [];\nlet currentStatusFilter = 'all';\n\nasync function loadMyOrders() {\n    const container = document.getElementById('ordersContainer');\n    container.innerHTML = '';\n    container.appendChild(createElement('div', { className: 'loading' }, 'Loading orders...'));\n\n    try {\n        const res = await fetch('/api/orders', { credentials: 'include' });\n        const data = await res.json();\n\n        if (res.ok) {\n            myOrders = data.data || [];\n            renderOrdersList();\n        } else {\n            container.innerHTML = '';\n            container.appendChild(createElement('div', { className: 'empty-state' }, data.message || 'Orders not available'));\n        }\n    } catch (e) {\n        console.error('Load orders error:', e);\n        container.innerHTML = '';\n        container.appendChild(createElement('div', { className: 'empty-state' }, [\n            createElement('p', {}, 'Orders not available'),\n            createElement('button', {\n                id: 'retryOrdersBtn',\n                style: { marginTop: '1rem', padding: '0.5rem 1rem', background: 'var(--dusty-olive)', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' },\n                onclick: loadMyOrders\n            }, 'Try Again')\n        ]));\n    }\n}\n\nfunction renderOrdersList() {\n    const container = document.getElementById('ordersContainer');\n\n    let filtered = myOrders;\n    if (currentStatusFilter !== 'all') {\n        filtered = myOrders.filter(o => o.status === currentStatusFilter);\n    }\n\n    container.innerHTML = '';\n\n    if (!filtered.length) {\n        container.appendChild(createElement('div', { className: 'empty-state' }, 'No orders found'));\n        return;\n    }\n\n    const fragment = document.createDocumentFragment();\n\n    filtered.forEach(order => {\n        const date = new Date(order.createdAt).toLocaleDateString('en-IN', {\n            month: 'short', day: 'numeric', year: 'numeric'\n        });\n\n        const badges = [];\n        if (order.batch?.batchType) {\n            const batchText = `${order.batch.batchType} Batch`;\n            // Note: Not modifying text logic here, just structure\n            badges.push(createElement('span', { className: 'badge badge-batch' }, batchText));\n        }\n        badges.push(createElement('span', { className: `badge badge-${order.status}` }, order.status));\n\n        const orderCard = createElement('div', {\n            className: 'order-card',\n            onclick: () => window.openOrderDetail(order._id)\n        }, [\n            createElement('div', { className: 'order-top' }, [\n                createElement('div', { className: 'order-number' }, order.orderNumber),\n                createElement('div', { className: 'order-products-summary' }, `${order.products.length} item${order.products.length !== 1 ? 's' : ''}`)\n            ]),\n            createElement('div', { className: 'order-bottom' }, [\n                createElement('div', { className: 'order-date' }, date),\n                createElement('div', { className: 'order-badges' }, badges)\n            ])\n        ]);\n        fragment.appendChild(orderCard);\n    });\n\n    container.appendChild(fragment);\n}\n\nfunction filterOrdersByStatus(status) {\n    currentStatusFilter = status;\n\n    document.querySelectorAll('.status-pill').forEach(pill => {\n        pill.classList.toggle('active', pill.dataset.status === status);\n    });\n\n    renderOrdersList();\n}\n\n// Setup filter event listeners\ndocument.querySelectorAll('.status-pill').forEach(pill => {\n    pill.addEventListener('click', () => filterOrdersByStatus(pill.dataset.status));\n});\n\n// ====================\n// ORDER DETAIL/EDIT MODAL\n// ====================\nlet currentOrder = null;\nlet editedProducts = [];\nlet orderInvoices = [];\n\nasync function openOrderDetail(orderId) {\n    try {\n        // Fetch order and invoices in parallel\n        const [orderRes, invoicesRes] = await Promise.all([\n            fetch(`/api/orders/${orderId}`, { credentials: 'include' }),\n            fetch(`/api/invoices/my-order/${orderId}`, { credentials: 'include' })\n        ]);\n\n        const orderData = await orderRes.json();\n\n        if (orderRes.ok && orderData.data) {\n            currentOrder = orderData.data;\n            editedProducts = JSON.parse(JSON.stringify(currentOrder.products || []));\n\n            // Load invoices (don't fail if invoice endpoint errors)\n            try {\n                const invoicesData = await invoicesRes.json();\n                orderInvoices = invoicesRes.ok ? (invoicesData.data || []) : [];\n            } catch (invoiceParseError) {\n                console.warn('Failed to load invoices:', invoiceParseError.message);\n                orderInvoices = [];\n            }\n\n            renderOrderModal();\n            document.getElementById('orderModal').classList.add('show');\n            document.body.style.overflow = 'hidden';\n        } else {\n            showToast(orderData.message || 'Could not load order', 'info');\n        }\n    } catch (e) {\n        console.error('Load order detail error:', e);\n        showToast('Could not load details', 'info');\n    }\n}\n\nfunction closeOrderModal() {\n    if (_orderFormDirty) {\n        if (!confirm('You have unsaved changes. Discard them?')) {\n            return;\n        }\n    }\n    document.getElementById('orderModal').classList.remove('show');\n    document.body.style.overflow = '';\n    currentOrder = null;\n    editedProducts = [];\n    orderInvoices = [];\n    _orderFormDirty = false;\n}\n\nfunction renderOrderModal() {\n    const isPending = currentOrder.status === 'pending';\n    const titleEl = document.getElementById('orderModalTitle');\n    const bodyEl = document.getElementById('orderModalBody');\n    const footerEl = document.getElementById('orderModalFooter');\n\n    titleEl.textContent = currentOrder.orderNumber;\n    bodyEl.innerHTML = '';\n\n    const contentFragment = document.createDocumentFragment();\n\n    // Info Grid\n    const infoGrid = createElement('div', { className: 'order-info-grid' }, [\n        createElement('div', {}, [\n            createElement('div', { className: 'info-label' }, 'Status'),\n            createElement('span', { className: `badge badge-${currentOrder.status}` }, currentOrder.status)\n        ]),\n        createElement('div', {}, [\n            createElement('div', { className: 'info-label' }, 'Date'),\n            createElement('div', { className: 'info-value' }, new Date(currentOrder.createdAt).toLocaleDateString('en-IN', {\n                month: 'short', day: 'numeric', year: 'numeric'\n            }))\n        ])\n    ]);\n\n    if (currentOrder.batch?.batchType) {\n        const batchLocked = currentOrder.batch?.status === 'confirmed';\n        infoGrid.appendChild(createElement('div', {}, [\n            createElement('div', { className: 'info-label' }, 'Batch'),\n            createElement('span', { className: 'badge badge-batch' }, [\n                `${currentOrder.batch.batchType} Batch`,\n                batchLocked ? ' ðŸ”’' : ''\n            ])\n        ]));\n    }\n\n    const orderInfoSection = createElement('div', { className: 'order-info-section' }, [\n        infoGrid,\n        currentOrder.deliveryAddress ? createElement('div', { style: { marginTop: '1rem' } }, [\n            createElement('div', { className: 'info-label' }, 'Delivery Address'),\n            createElement('div', { className: 'info-value' }, currentOrder.deliveryAddress)\n        ]) : null,\n        currentOrder.notes ? createElement('div', { style: { marginTop: '1rem' } }, [\n            createElement('div', { className: 'info-label' }, 'Notes'),\n            createElement('div', { className: 'info-value' }, currentOrder.notes)\n        ]) : null\n    ].filter(Boolean));\n\n    contentFragment.appendChild(orderInfoSection);\n    contentFragment.appendChild(createElement('div', { className: 'divider' }));\n    contentFragment.appendChild(createElement('div', { className: 'info-label', style: { marginBottom: '0.5rem' } }, 'Products'));\n\n    // Products List\n    const productsList = createElement('div', { id: 'orderProductsList' });\n    renderOrderProducts(isPending, productsList);\n    contentFragment.appendChild(productsList);\n\n    // Invoices\n    if (orderInvoices.length > 0) {\n        contentFragment.appendChild(createElement('div', { className: 'divider' }));\n        contentFragment.appendChild(createElement('div', { className: 'info-label', style: { marginBottom: '0.5rem' } }, 'Invoices'));\n\n        const invoicesList = createElement('div', { className: 'invoices-list' });\n        orderInvoices.forEach(inv => {\n            const date = new Date(inv.generatedAt).toLocaleDateString('en-IN', { month: 'short', day: 'numeric' });\n            const item = createElement('div', {\n                className: 'invoice-item',\n                onclick: () => window.downloadInvoice(inv.invoiceNumber)\n            }, [\n                createElement('div', { className: 'invoice-info' }, [\n                    createElement('div', { className: 'invoice-number' }, inv.invoiceNumber),\n                    createElement('div', { className: 'invoice-meta' }, `${inv.firm?.name || 'Unknown Firm'} â€¢ ${date}`)\n                ]),\n                createElement('div', { className: 'invoice-download' }, [\n                    // Simple SVG icon using innerHTML for simplicity as it is static SVG\n                    // Alternatively could create SVG elements programmatically but that's verbose\n                    // Given it's a static icon, we can use a helper or just innerHTML on a small wrapper if known safe.\n                    // But to be consistent let's use innerHTML for the icon content only or create element.\n                    // Let's rely on a small helper for SVG or just innerHTML for the icon part since it's hardcoded.\n                ])\n            ]);\n            // Manually set SVG innerHTML which is safe here as it's hardcoded\n            item.querySelector('.invoice-download').innerHTML = `\n                <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                    <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\n                    <polyline points=\"7 10 12 15 17 10\"/>\n                    <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"/>\n                </svg>`;\n\n            invoicesList.appendChild(item);\n        });\n        contentFragment.appendChild(invoicesList);\n    }\n\n    bodyEl.appendChild(contentFragment);\n\n    // Render footer\n    footerEl.innerHTML = '';\n    if (isPending) {\n        footerEl.appendChild(createElement('button', {\n            className: 'btn btn-secondary',\n            onclick: () => window.closeOrderModal()\n        }, 'Cancel'));\n\n        footerEl.appendChild(createElement('button', {\n            className: 'btn btn-primary',\n            style: { flex: '1' },\n            onclick: () => window.saveOrderEdit()\n        }, 'Save Changes'));\n    } else {\n        footerEl.appendChild(createElement('button', {\n            className: 'btn btn-primary btn-block',\n            onclick: () => window.closeOrderModal()\n        }, 'Close'));\n    }\n}\n\nfunction renderOrderProducts(editable, container) {\n    // If container is not provided, we might be calling from elsewhere, but here we expect it.\n    // To support returning HTML string as before (if used elsewhere), we'd need to check.\n    // The previous implementation returned a string. \n    // BUT we are changing it to append to container.\n    // Let's check usages. It's only used in renderOrderModal above.\n\n    if (!container) return; // Should be passed\n    container.innerHTML = '';\n\n    editedProducts.forEach((item, index) => {\n        if (editable) {\n            container.appendChild(createElement('div', {\n                className: 'product-item-edit',\n                dataset: { index: index }\n            }, [\n                createElement('div', { className: 'product-info' }, [\n                    createElement('div', { className: 'product-name' }, item.productName),\n                    createElement('div', { className: 'product-meta' }, item.unit)\n                ]),\n                createElement('div', { className: 'qty-controls' }, [\n                    createElement('button', {\n                        className: 'qty-btn',\n                        onclick: () => window.changeOrderQty(index, -1)\n                    }, 'âˆ’'),\n                    createElement('input', {\n                        type: 'number',\n                        className: 'qty-input',\n                        id: `order-qty-${index}`,\n                        value: item.quantity,\n                        min: '0',\n                        inputmode: 'numeric',\n                        onchange: () => window.updateOrderQtyFromInput(index)\n                    }),\n                    createElement('button', {\n                        className: 'qty-btn',\n                        onclick: () => window.changeOrderQty(index, 1)\n                    }, '+')\n                ])\n            ]));\n        } else {\n            container.appendChild(createElement('div', {\n                className: 'product-item-edit readonly'\n            }, [\n                createElement('div', { className: 'product-info' }, [\n                    createElement('div', { className: 'product-name' }, item.productName),\n                    createElement('div', { className: 'product-meta' }, `${item.quantity} ${item.unit}`)\n                ])\n            ]));\n        }\n    });\n}\n\nfunction changeOrderQty(index, delta) {\n    const input = document.getElementById(`order-qty-${index}`);\n    let val = parseFloat(input.value) || 0;\n    val = Math.max(0, val + delta);\n    input.value = val;\n    editedProducts[index].quantity = val;\n    _orderFormDirty = true;\n}\n\nfunction updateOrderQtyFromInput(index) {\n    const input = document.getElementById(`order-qty-${index}`);\n    const val = Math.max(0, parseFloat(input.value) || 0);\n    input.value = val;\n    editedProducts[index].quantity = val;\n    _orderFormDirty = true;\n}\n\nasync function downloadInvoice(invoiceNumber) {\n    try {\n        showToast('Downloading invoice...', 'info');\n\n        const res = await fetch(`/api/invoices/my/${invoiceNumber}/download`, {\n            credentials: 'include'\n        });\n\n        if (!res.ok) {\n            // Try to parse error message from JSON, fallback to status text\n            let errorMessage = 'Invoice not ready yet';\n            try {\n                const error = await res.json();\n                errorMessage = error.message || errorMessage;\n            } catch (parseError) {\n                console.warn('Failed to parse invoice download error:', parseError.message);\n                // Response might not be JSON - use status-based fallback\n                errorMessage = res.status === 404 ? 'Invoice not ready yet' :\n                    res.status === 403 ? 'Invoice access pending' :\n                        'Invoice temporarily unavailable';\n            }\n            throw new Error(errorMessage);\n        }\n\n        const blob = await res.blob();\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `${invoiceNumber}.pdf`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        window.URL.revokeObjectURL(url);\n\n        showToast('Invoice downloaded!', 'success');\n    } catch (e) {\n        console.error('Download invoice error:', e);\n        showToast(e.message || 'Could not download', 'info');\n    }\n}\n\nasync function saveOrderEdit() {\n    try {\n        // Filter out zero-quantity items\n        const products = editedProducts\n            .filter(p => p.quantity > 0)\n            .map(p => ({\n                product: typeof p.product === 'object' ? p.product._id : p.product,\n                quantity: p.quantity\n            }));\n\n        if (!products.length) {\n            showToast('Add at least one product', 'info');\n            return;\n        }\n\n        const saveBtn = document.querySelector('#orderModalFooter .btn-primary');\n        if (saveBtn) {\n            saveBtn.disabled = true;\n            saveBtn.textContent = 'Saving...';\n        }\n\n        const headers = { 'Content-Type': 'application/json' };\n        const csrfToken = await Auth.ensureCsrfToken();\n        if (csrfToken) {\n            headers['X-CSRF-Token'] = csrfToken;\n        }\n\n        const payload = { products };\n\n        let res = await fetch(`/api/orders/${currentOrder._id}/customer-edit`, {\n            method: 'PUT',\n            headers,\n            credentials: 'include',\n            body: JSON.stringify(payload)\n        });\n\n        let data = await res.json();\n\n        // Handle CSRF retry\n        if (res.status === 403 && data?.message?.toLowerCase().includes('csrf')) {\n            const newToken = await Auth.refreshCsrfToken();\n            if (newToken) {\n                headers['X-CSRF-Token'] = newToken;\n                res = await fetch(`/api/orders/${currentOrder._id}/customer-edit`, {\n                    method: 'PUT',\n                    headers,\n                    credentials: 'include',\n                    body: JSON.stringify(payload)\n                });\n                data = await res.json();\n            }\n        }\n\n        if (res.ok) {\n            showToast('Order updated successfully', 'success');\n            _orderFormDirty = false;\n            closeOrderModal();\n            loadMyOrders(); // Refresh list\n        } else {\n            showToast(data.message || 'Could not update', 'info');\n        }\n    } catch (e) {\n        console.error('Order edit error:', e);\n        if (!navigator.onLine) {\n            showToast('No internet connection', 'info');\n        } else {\n            showToast('Could not update. Try again.', 'info');\n        }\n    } finally {\n        const saveBtn = document.querySelector('#orderModalFooter .btn-primary');\n        if (saveBtn) {\n            saveBtn.disabled = false;\n            saveBtn.textContent = 'Save Changes';\n        }\n    }\n}\n\n// Close modal on overlay click\nconst orderModal = document.getElementById('orderModal');\nif (orderModal) {\n    orderModal.addEventListener('click', (e) => {\n        if (e.target.id === 'orderModal') {\n            closeOrderModal();\n        }\n    });\n}\n\n// Close modal on Escape key\ndocument.addEventListener('keydown', (e) => {\n    const modal = document.getElementById('orderModal');\n    if (e.key === 'Escape' && modal && modal.classList.contains('show')) {\n        closeOrderModal();\n    }\n});\n\n// Refresh orders list when page becomes visible again\ndocument.addEventListener('visibilitychange', () => {\n    if (document.visibilityState === 'visible' && _activeTab === 'list') {\n        loadMyOrders();\n    }\n});\n\n// Expose functions to window\nwindow.clearZero = clearZero;\nwindow.restoreZero = restoreZero;\nwindow.changeQty = changeQty;\nwindow.updateFromInput = updateFromInput;\nwindow.placeOrder = placeOrder;\nwindow.openOrderDetail = openOrderDetail;\nwindow.closeOrderModal = closeOrderModal;\nwindow.saveOrderEdit = saveOrderEdit;\nwindow.renderOrderProducts = renderOrderProducts;\nwindow.changeOrderQty = changeOrderQty;\nwindow.updateOrderQtyFromInput = updateOrderQtyFromInput;\nwindow.downloadInvoice = downloadInvoice;\n\ninit();\n"],"names":["waitForAuth","maxWait","resolve","reject","startTime","check","Auth","logoutBtn","logout","customerSelect","onCustomerChange","currentUser","selectedCustomer","products","marketRates","customers","isStaff","_orderFormDirty","init","magicToken","res","data","showToast","loadData","customerBar","populateCustomers","renderProducts","list","createElement","productsRes","ratesRes","customersRes","p","rate","pid","c","productList","select","loadingOption","id","updateSummary","getContractPrice","contractPrices","productId","getPrice","product","type","contractPrice","getFilteredProducts","allowedProductIds","buildCategoryPills","displayProducts","categories","container","filterByCategory","cat","t","activeBtn","item","header","message","grouped","fragment","prods","price","step","itemDataset","productItem","e","clearZero","input","restoreZero","updateFromInput","changeQty","delta","val","updateItem","qty","items","itemCountEl","orderBtn","searchInput","q","name","hasVisible","i","placeOrder","orderProducts","pieceErrors","unit","orderProduct","btn","headers","csrfToken","notesInput","notes","orderPayload","newToken","orderNum","_activeTab","switchTab","tabName","tab","view","newOrderView","ordersListView","loadMyOrders","newOrderTab","myOrdersTab","myOrders","currentStatusFilter","renderOrdersList","filtered","order","date","badges","batchText","orderCard","filterOrdersByStatus","status","pill","currentOrder","editedProducts","orderInvoices","openOrderDetail","orderId","orderRes","invoicesRes","orderData","invoicesData","invoiceParseError","renderOrderModal","closeOrderModal","isPending","titleEl","bodyEl","footerEl","contentFragment","infoGrid","batchLocked","orderInfoSection","productsList","renderOrderProducts","invoicesList","inv","editable","index","changeOrderQty","updateOrderQtyFromInput","downloadInvoice","invoiceNumber","errorMessage","parseError","blob","url","a","saveOrderEdit","saveBtn","payload","orderModal","modal"],"mappings":"8IAKA,MAAMA,EAAc,CAACC,EAAU,MAAU,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtE,MAAMC,EAAY,KAAK,IAAG,EACpBC,EAAQ,IAAM,CAChB,GAAI,OAAO,KAAM,OAAOH,EAAQ,OAAO,IAAI,EAC3C,GAAI,KAAK,IAAG,EAAKE,EAAYH,EAAS,OAAOE,EAAO,IAAI,MAAM,oBAAoB,CAAC,EACnF,WAAWE,EAAO,EAAE,CACxB,EACAA,EAAK,CACT,CAAC,EACKC,EAAO,MAAMN,EAAW,EAGxBO,EAAY,SAAS,eAAe,WAAW,EACjDA,GAAWA,EAAU,iBAAiB,QAASC,CAAM,EAGzD,MAAMC,EAAiB,SAAS,eAAe,gBAAgB,EAC3DA,GAAgBA,EAAe,iBAAiB,SAAUC,CAAgB,EAE9E,IAAIC,EAAc,KACdC,EAAmB,KACnBC,EAAW,CAAA,EACf,MAAMC,EAAc,CAAA,EACpB,IAAIC,EAAY,CAAA,EACZC,EAAU,GACVC,EAAkB,GAEtB,eAAeC,GAAO,CAGlB,MAAMC,EADY,IAAI,gBAAgB,OAAO,SAAS,MAAM,EAC/B,IAAI,OAAO,EAExC,GAAIA,EAEA,GAAI,CACA,MAAMC,EAAM,MAAM,MAAM,mBAAmBD,CAAU,GAAI,CACrD,YAAa,SAC7B,CAAa,EACKE,EAAO,MAAMD,EAAI,KAAI,EAE3B,GAAIA,EAAI,IAAMC,EAAK,KACfV,EAAcU,EAAK,KACnBf,EAAK,QAAQe,EAAK,IAAI,EAEtB,OAAO,QAAQ,aAAa,CAAA,EAAI,GAAI,OAAO,SAAS,QAAQ,MACzD,CACHC,EAAUD,EAAK,SAAW,0CAA2C,MAAM,EAC3E,OAAO,SAAS,KAAO,yBACvB,MACJ,CACJ,MAAa,CACTC,EAAU,wCAAyC,MAAM,EACzD,OAAO,SAAS,KAAO,yBACvB,MACJ,SAGAX,EAAc,MAAML,EAAK,OAAM,EAC3B,CAACK,EAAa,CACd,OAAO,SAAS,KAAO,yBACvB,MACJ,CAMJ,GAHAK,EAAUL,EAAY,OAAS,SAAWA,EAAY,OAAS,QAC/D,MAAMY,EAAQ,EAEVP,EAAS,CACT,MAAMQ,EAAc,SAAS,eAAe,aAAa,EACrDA,GAAaA,EAAY,UAAU,IAAI,MAAM,EACjDC,EAAiB,CACrB,SACQd,EAAY,SACZC,EAAmB,OAAOD,EAAY,UAAa,SAC7CA,EAAY,SACZ,CAAE,IAAKA,EAAY,SAAU,YAAa,QAAQ,EACxDe,EAAc,MACX,CACH,MAAMC,EAAO,SAAS,eAAe,aAAa,EAC9CA,IACAA,EAAK,UAAY,GACjBA,EAAK,YAAYC,EAAc,MAAO,CAAE,UAAW,aAAa,EAAI,qDAAqD,CAAC,EAElI,CAER,CAEA,eAAeL,GAAW,CACtB,GAAI,CACA,KAAM,CAACM,EAAaC,EAAUC,CAAY,EAAI,MAAM,QAAQ,IAAI,CAC5D,MAAM,gBAAiB,CAAE,YAAa,SAAS,CAAE,EACjD,MAAM,oBAAqB,CAAE,YAAa,SAAS,CAAE,EACrD,MAAM,iBAAkB,CAAE,YAAa,SAAS,CAAE,EAAE,MAAM,KAAO,CAAE,GAAI,IAAQ,CAC3F,CAAS,EAEGF,EAAY,KAEZhB,IADa,MAAMgB,EAAY,KAAI,IACjB,MAAQ,CAAA,GAAI,OAAOG,GAAKA,EAAE,WAAa,EAAK,GAG9DF,EAAS,MACI,MAAMA,EAAS,KAAI,IACzB,MAAQ,IAAI,QAAQG,GAAQ,CAC/B,MAAMC,EAAM,OAAOD,EAAK,SAAY,SAAWA,EAAK,QAAQ,IAAMA,EAAK,QACnEC,IAAKpB,EAAYoB,CAAG,EAAID,EAAK,KACrC,CAAC,EAGDF,EAAa,KAEbhB,IADa,MAAMgB,EAAa,KAAI,IACjB,MAAQ,CAAA,GAAI,OAAOI,GAAKA,EAAE,WAAa,EAAK,EAEvE,OAAS,EAAG,CACR,QAAQ,MAAM,uBAAwB,CAAC,EAEvC,MAAMC,EAAc,SAAS,eAAe,aAAa,EACrDA,IACAA,EAAY,UAAY,GACxBA,EAAY,YAAYR,EAAc,MAAO,CAAE,UAAW,eAAiB,CACvEA,EAAc,IAAK,CAAA,EAAI,wBAAwB,EAC/CA,EAAc,SAAU,CACpB,GAAI,eACJ,MAAO,CAAE,UAAW,OAAQ,QAAS,cAAe,WAAY,qBAAsB,MAAO,QAAS,OAAQ,OAAQ,aAAc,MAAO,OAAQ,SAAS,EAC5J,QAAS,IAAML,EAAQ,EAAG,KAAK,IAAM,CAAMX,GAAkBc,EAAc,CAAI,CAAC,CACpG,EAAmB,WAAW,CAC9B,CAAa,CAAC,EAEV,CACJ,CAEA,SAASD,GAAoB,CACzB,MAAMY,EAAS,SAAS,eAAe,gBAAgB,EAGvD,GAAItB,EAAU,SAAW,EAAG,CACxB,MAAMuB,EAAgBV,EAAc,SAAU,CAAE,MAAO,GAAI,SAAU,GAAM,SAAU,EAAI,EAAI,sBAAsB,EACnHS,EAAO,YAAYC,CAAa,EAChC,MACJ,CAGAD,EAAO,UAAY,GACnBA,EAAO,YAAYT,EAAc,SAAU,CAAE,MAAO,EAAE,EAAI,iBAAiB,CAAC,EAE5Eb,EAAU,QAAQoB,GAAK,CACnBE,EAAO,YAAYT,EAAc,SAAU,CAAE,MAAOO,EAAE,GAAG,EAAIA,EAAE,IAAI,CAAC,CACxE,CAAC,CACL,CAEA,SAASzB,GAAmB,CACxB,MAAM6B,EAAK,SAAS,eAAe,gBAAgB,EAAE,MAErD,GADA3B,EAAmBG,EAAU,KAAKoB,GAAKA,EAAE,MAAQI,CAAE,GAAK,KACpD3B,EACAc,EAAc,MACX,CACH,MAAMC,EAAO,SAAS,eAAe,aAAa,EAClDA,EAAK,UAAY,GACjBA,EAAK,YAAYC,EAAc,MAAO,CAAE,UAAW,aAAa,EAAI,4BAA4B,CAAC,CACrG,CACAY,EAAa,CACjB,CAGA,SAASC,EAAiBC,EAAgBC,EAAW,CACjD,OAAKD,EAEDA,EAAeC,CAAS,IAAM,OACvBD,EAAeC,CAAS,EAG/B,OAAOD,EAAe,KAAQ,WACvBA,EAAe,IAAIC,CAAS,EAEhC,KATqB,IAUhC,CAEA,SAASC,EAASC,EAAS,CACvB,GAAI,CAACjC,EAAkB,OAAOE,EAAY+B,EAAQ,GAAG,GAAK,EAC1D,MAAMC,EAAOlC,EAAiB,aAAe,SAC7C,GAAIkC,IAAS,WAAY,CACrB,MAAMC,EAAgBN,EAAiB7B,EAAiB,eAAgBiC,EAAQ,GAAG,EACnF,OAAOE,IAAkB,KAAOA,EAAiBjC,EAAY+B,EAAQ,GAAG,GAAK,CACjF,SAAWC,IAAS,SAAU,CAC1B,MAAMb,EAAOnB,EAAY+B,EAAQ,GAAG,GAAK,EACzC,OAAO,KAAK,MAAMZ,GAAQ,GAAKrB,EAAiB,kBAAoB,GAAK,IAAI,CACjF,CACA,OAAOE,EAAY+B,EAAQ,GAAG,GAAK,CACvC,CAGA,SAASG,GAAsB,CAO3B,GALIhC,GAKA,CAACJ,GAAoBA,EAAiB,cAAgB,WACtD,OAAOC,EAMX,MAAMoC,EAAoBrC,EAAiB,kBACnCA,EAAiB,eAAiB,OAAO,KAAKA,EAAiB,cAAc,EAAI,IAGzF,OAAIqC,EAAkB,SAAW,EACtB,CAAA,EAGJpC,EAAS,OAAOmB,GAAKiB,EAAkB,SAASjB,EAAE,GAAG,CAAC,CACjE,CAEA,SAASkB,EAAmBC,EAAkBtC,EAAU,CACpD,MAAMuC,EAAa,CAAC,GAAG,IAAI,IAAID,EAAgB,IAAInB,GAAKA,EAAE,UAAY,OAAO,CAAC,CAAC,EACzEqB,EAAY,SAAS,eAAe,eAAe,EAIzD,GAHAA,EAAU,UAAY,GAGlBF,EAAgB,SAAW,GAAKC,EAAW,QAAU,EAAG,CACxDC,EAAU,MAAM,QAAU,OAC1B,MACJ,CAEAA,EAAU,MAAM,QAAU,OAE1BA,EAAU,YAAYzB,EAAc,SAAU,CAC1C,UAAW,kBACX,QAAS,CAAE,IAAK,KAAK,EACrB,QAAS,IAAM0B,EAAiB,KAAK,CAC7C,EAAO,KAAK,CAAC,EAETF,EAAW,QAAQG,GAAO,CACtBF,EAAU,YAAYzB,EAAc,SAAU,CAC1C,UAAW,WACX,QAAS,CAAE,IAAA2B,CAAG,EACd,QAAS,IAAMD,EAAiBC,CAAG,CAC/C,EAAWA,CAAG,CAAC,CACX,CAAC,CACL,CAEA,SAASD,EAAiBC,EAAK,CAC3B,SAAS,iBAAiB,WAAW,EAAE,QAAQC,GAAKA,EAAE,UAAU,OAAO,QAAQ,CAAC,EAChF,MAAMC,EAAY,SAAS,cAAc,uBAAuBF,CAAG,IAAI,EACnEE,GAAWA,EAAU,UAAU,IAAI,QAAQ,EAE/C,SAAS,iBAAiB,eAAe,EAAE,QAAQC,GAAQ,CACvDA,EAAK,MAAM,QAAWH,IAAQ,OAASG,EAAK,QAAQ,WAAaH,EAAO,GAAK,MACjF,CAAC,EAED,SAAS,iBAAiB,kBAAkB,EAAE,QAAQI,GAAU,CAC5DA,EAAO,MAAM,QAAWJ,IAAQ,OAASI,EAAO,QAAQ,WAAaJ,EAAO,GAAK,MACrF,CAAC,CACL,CAEA,SAAS7B,GAAiB,CACtB,MAAM2B,EAAY,SAAS,eAAe,aAAa,EACvDA,EAAU,UAAY,GAGtB,MAAMF,EAAkBH,EAAmB,EAE3C,GAAI,CAACG,EAAgB,OAAQ,CAMzB,MAAMS,EAJ2BhD,GAC7BA,EAAiB,cAAgB,YACjCC,EAAS,OAAS,EAGhB,gFACA,wBAENwC,EAAU,YAAYzB,EAAc,MAAO,CAAE,UAAW,aAAa,EAAIgC,CAAO,CAAC,EACjF,MACJ,CAEAV,EAAmBC,CAAe,EAElC,MAAMU,EAAU,CAAA,EAChBV,EAAgB,QAAQnB,GAAK,CACzB,MAAMuB,EAAMvB,EAAE,UAAY,QACrB6B,EAAQN,CAAG,IAAGM,EAAQN,CAAG,EAAI,CAAA,GAClCM,EAAQN,CAAG,EAAE,KAAKvB,CAAC,CACvB,CAAC,EAED,MAAM8B,EAAW,SAAS,uBAAsB,EAEhD,SAAW,CAACP,EAAKQ,CAAK,IAAK,OAAO,QAAQF,CAAO,EAC7CC,EAAS,YAAYlC,EAAc,MAAO,CACtC,UAAW,kBACX,QAAS,CAAE,SAAU2B,CAAG,CACpC,EAAWA,CAAG,CAAC,EAEPQ,EAAM,QAAQ/B,GAAK,CAEf,MAAMgC,EAAQhD,EAAU4B,EAASZ,CAAC,EAAI,EAEhCiC,EAAOjC,EAAE,OAAS,QAAU,IAAM,OAGlCkC,EAAc,CAChB,GAAIlC,EAAE,IACN,SAAUuB,EACV,KAAMvB,EAAE,IACxB,EAEgBhB,IACAkD,EAAY,MAAQF,GAGxB,MAAMG,EAAcvC,EAAc,MAAO,CACrC,UAAW,eACX,QAASsC,CACzB,EAAe,CACCtC,EAAc,MAAO,CAAE,UAAW,cAAc,EAAI,CAChDA,EAAc,MAAO,CAAE,UAAW,cAAc,EAAII,EAAE,IAAI,EAC1DJ,EAAc,MAAO,CAAE,UAAW,cAAc,EAAII,EAAE,IAAI,CAC9E,CAAiB,EACDJ,EAAc,MAAO,CAAE,UAAW,cAAc,EAAI,CAChDA,EAAc,SAAU,CACpB,UAAW,UACX,QAAS,IAAM,OAAO,UAAUI,EAAE,IAAK,EAAE,CACjE,EAAuB,GAAG,EACNJ,EAAc,QAAS,CACnB,KAAM,SACN,UAAW,YACX,GAAI,OAAOI,EAAE,GAAG,GAChB,MAAO,IACP,IAAK,IACL,KAAMiC,EACN,UAAW,UACX,QAAUG,GAAM,OAAO,UAAUA,EAAE,MAAM,EACzC,OAASA,GAAM,OAAO,YAAYA,EAAE,MAAM,EAC1C,SAAU,IAAM,OAAO,gBAAgBpC,EAAE,GAAG,CACpE,CAAqB,EACDJ,EAAc,SAAU,CACpB,UAAW,UACX,QAAS,IAAM,OAAO,UAAUI,EAAE,IAAK,CAAC,CAChE,EAAuB,GAAG,CAC1B,CAAiB,CACjB,CAAa,EACD8B,EAAS,YAAYK,CAAW,CACpC,CAAC,EAGLd,EAAU,YAAYS,CAAQ,CAClC,CAGA,SAASO,GAAUC,EAAO,CAClBA,EAAM,QAAU,MAAKA,EAAM,MAAQ,IACvCA,EAAM,OAAM,CAChB,CAEA,SAASC,GAAYD,EAAO,CACpBA,EAAM,QAAU,KAAIA,EAAM,MAAQ,KACtCE,EAAgBF,EAAM,GAAG,QAAQ,OAAQ,EAAE,CAAC,CAChD,CAEA,SAASG,GAAUlC,EAAImC,EAAO,CAC1B,MAAMJ,EAAQ,SAAS,eAAe,OAAS/B,CAAE,EACjD,IAAIoC,EAAM,WAAWL,EAAM,KAAK,GAAK,EACrCK,EAAM,KAAK,IAAI,EAAGA,EAAMD,CAAK,EAC7BJ,EAAM,MAAQK,EACdC,EAAWrC,EAAIoC,CAAG,CACtB,CAEA,SAASH,EAAgBjC,EAAI,CACzB,MAAM+B,EAAQ,SAAS,eAAe,OAAS/B,CAAE,EAC3CoC,EAAM,KAAK,IAAI,EAAG,WAAWL,EAAM,KAAK,GAAK,CAAC,EACpDA,EAAM,MAAQK,EACdC,EAAWrC,EAAIoC,CAAG,CACtB,CAEA,SAASC,EAAWrC,EAAIsC,EAAK,CACzB,MAAMnB,EAAO,SAAS,cAAc,0BAA0BnB,CAAE,IAAI,EAC9D+B,EAAQ,SAAS,eAAe,OAAS/B,CAAE,EAE7CmB,GAAQY,IACJO,EAAM,GACNnB,EAAK,UAAU,IAAI,SAAS,EAC5BY,EAAM,UAAU,IAAI,WAAW,IAE/BZ,EAAK,UAAU,OAAO,SAAS,EAC/BY,EAAM,UAAU,OAAO,WAAW,IAI1C9B,EAAa,CACjB,CAEA,SAASA,GAAgB,CACrB,IAAIsC,EAAQ,EAEZ,SAAS,iBAAiB,eAAe,EAAE,QAAQpB,GAAQ,CACvD,MAAMnB,EAAKmB,EAAK,QAAQ,GAClBY,EAAQ,SAAS,eAAe,OAAS/B,CAAE,GACrC,WAAW+B,GAAO,KAAK,GAAK,GAC9B,GAAGQ,GACjB,CAAC,EAED,MAAMC,EAAc,SAAS,eAAe,WAAW,EACjDC,EAAW,SAAS,eAAe,UAAU,EAC/CD,IAAaA,EAAY,YAAcD,GACvCE,IAAUA,EAAS,SAAWF,IAAU,GAAK,CAAClE,EACtD,CAGA,MAAMqE,EAAc,SAAS,eAAe,aAAa,EACrDA,GACAA,EAAY,iBAAiB,QAAU,GAAM,CACzC,MAAMC,EAAI,EAAE,OAAO,MAAM,YAAW,EAEpC,SAAS,iBAAiB,eAAe,EAAE,QAAQxB,GAAQ,CACvD,MAAMyB,EAAOzB,EAAK,cAAc,eAAe,EAAE,YAAY,YAAW,EACxEA,EAAK,MAAM,QAAUyB,EAAK,SAASD,CAAC,EAAI,GAAK,MACjD,CAAC,EAED,SAAS,iBAAiB,kBAAkB,EAAE,QAAQvB,GAAU,CAC5D,MAAMJ,EAAMI,EAAO,QAAQ,SACrByB,EAAa,CAAC,GAAG,SAAS,iBAAiB,gCAAgC7B,CAAG,IAAI,CAAC,EACpF,KAAK8B,GAAKA,EAAE,MAAM,UAAY,MAAM,EACzC1B,EAAO,MAAM,QAAUyB,EAAa,GAAK,MAC7C,CAAC,CACL,CAAC,EAIL,eAAeE,IAAa,CACxB,GAAI,CAAC1E,EAAkB,OAEvB,MAAM2E,EAAgB,CAAA,EAChBC,EAAc,CAAA,EA2BpB,GAzBA,SAAS,iBAAiB,eAAe,EAAE,QAAQ9B,GAAQ,CACvD,MAAMnB,EAAKmB,EAAK,QAAQ,GAClBY,EAAQ,SAAS,eAAe,OAAS/B,CAAE,EAE3CsC,EADW,WAAWP,GAAO,KAAK,GAAK,EAGvCN,EAAQhD,GAAW,WAAW0C,EAAK,QAAQ,KAAK,GAAK,EACrD+B,EAAO/B,EAAK,QAAQ,KACpByB,EAAOzB,EAAK,cAAc,eAAe,GAAG,aAAe,UAEjE,GAAImB,EAAM,EAAG,CAELY,IAAS,SAAW,CAAC,OAAO,UAAUZ,CAAG,GACzCW,EAAY,KAAKL,CAAI,EAGzB,MAAMO,EAAe,CAAE,QAASnD,EAAI,SAAUsC,CAAG,EAC7C7D,GAAWgD,EAAQ,IACnB0B,EAAa,KAAO1B,GAExBuB,EAAc,KAAKG,CAAY,CACnC,CACJ,CAAC,EAGGF,EAAY,OAAS,EAAG,CACxBlE,EAAU,GAAGkE,EAAY,KAAK,IAAI,CAAC,sBAAuB,MAAM,EAChE,MACJ,CAEA,GAAI,CAACD,EAAc,OAAQ,OAE3B,MAAMI,EAAM,SAAS,eAAe,UAAU,EAC9CA,EAAI,SAAW,GACfA,EAAI,YAAc,aAElB,GAAI,CACA,MAAMC,EAAU,CAAE,eAAgB,kBAAkB,EAC9CC,EAAY,MAAMvF,EAAK,gBAAe,EACxCuF,IACAD,EAAQ,cAAc,EAAIC,GAG9B,MAAMC,EAAa,SAAS,eAAe,YAAY,EACjDC,EAAQD,GAAY,OAAO,KAAI,GAAM,GAErCE,EAAe,CACjB,SAAUpF,EAAiB,IAC3B,SAAU2E,EACV,eAAgB,OAAO,WAAU,CAC7C,EAEYQ,IACAC,EAAa,MAAQD,GAGzB,IAAI3E,EAAM,MAAM,MAAM,cAAe,CACjC,OAAQ,OACR,QAAAwE,EACA,YAAa,UACb,KAAM,KAAK,UAAUI,CAAY,CAC7C,CAAS,EAEG3E,EAAO,MAAMD,EAAI,KAAI,EAGzB,GAAIA,EAAI,SAAW,KAAOC,GAAM,SAAS,YAAW,EAAG,SAAS,MAAM,EAAG,CACrE,MAAM4E,EAAW,MAAM3F,EAAK,iBAAgB,EACxC2F,IACAL,EAAQ,cAAc,EAAIK,EAC1B7E,EAAM,MAAM,MAAM,cAAe,CAC7B,OAAQ,OACR,QAAAwE,EACA,YAAa,UACb,KAAM,KAAK,UAAUI,CAAY,CACrD,CAAiB,EACD3E,EAAO,MAAMD,EAAI,KAAI,EAE7B,CAEA,GAAIA,EAAI,GAAI,CACR,MAAM8E,EAAW7E,GAAM,MAAM,aAAe,MAC5CC,EAAU,kBAAkB4E,CAAQ,GAAI,SAAS,EAG7C7E,EAAK,SACL,WAAW,IAAM,CACbC,EAAUD,EAAK,QAAS,MAAM,CAClC,EAAG,IAAI,EAIPA,EAAK,SAAWA,EAAK,mBAAqBA,EAAK,kBAAkB,OAAS,GAC1E,WAAW,IAAM,CACbC,EAAUD,EAAK,QAAS,MAAM,CAClC,EAAGA,EAAK,QAAU,IAAO,IAAI,EAGjC,SAAS,iBAAiB,YAAY,EAAE,QAAQiD,GAAS,CACrDA,EAAM,MAAQ,IACdA,EAAM,UAAU,OAAO,WAAW,CACtC,CAAC,EACD,SAAS,iBAAiB,eAAe,EAAE,QAAQZ,GAAQ,CACvDA,EAAK,UAAU,OAAO,SAAS,CACnC,CAAC,EAEGoC,IAAYA,EAAW,MAAQ,IACnCtD,EAAa,CACjB,MACIlB,EAAUD,EAAK,SAAW,wBAAyB,MAAM,CAEjE,OAAS+C,EAAG,CACR,QAAQ,MAAM,yBAA0BA,CAAC,EACpC,UAAU,OAGX9C,EAAU,oCAAqC,MAAM,EAFrDA,EAAU,yBAA0B,MAAM,CAIlD,QAAC,CACOqE,IACAA,EAAI,SAAW,GACfA,EAAI,YAAc,eAEtBnD,EAAa,CACjB,CACJ,CAKA,IAAI2D,EAAa,MAEjB,SAASC,EAAUC,EAAS,CAaxB,GAZAF,EAAaE,EAGb,SAAS,iBAAiB,YAAY,EAAE,QAAQC,GAAO,CACnDA,EAAI,UAAU,OAAO,SAAUA,EAAI,QAAQ,MAAQD,CAAO,CAC9D,CAAC,EAGD,SAAS,iBAAiB,aAAa,EAAE,QAAQE,GAAQ,CACrDA,EAAK,UAAU,OAAO,QAAQ,CAClC,CAAC,EAEGF,IAAY,MAAO,CACnB,MAAMG,EAAe,SAAS,eAAe,cAAc,EACvDA,GAAcA,EAAa,UAAU,IAAI,QAAQ,CACzD,SAAWH,IAAY,OAAQ,CAC3B,MAAMI,EAAiB,SAAS,eAAe,gBAAgB,EAC3DA,GAAgBA,EAAe,UAAU,IAAI,QAAQ,EACzDC,EAAY,CAChB,CACJ,CAEA,MAAMC,EAAc,SAAS,eAAe,aAAa,EACnDC,EAAc,SAAS,eAAe,aAAa,EACrDD,GAAaA,EAAY,iBAAiB,QAAS,IAAMP,EAAU,KAAK,CAAC,EACzEQ,GAAaA,EAAY,iBAAiB,QAAS,IAAMR,EAAU,MAAM,CAAC,EAK9E,IAAIS,EAAW,CAAA,EACXC,EAAsB,MAE1B,eAAeJ,GAAe,CAC1B,MAAMrD,EAAY,SAAS,eAAe,iBAAiB,EAC3DA,EAAU,UAAY,GACtBA,EAAU,YAAYzB,EAAc,MAAO,CAAE,UAAW,SAAS,EAAI,mBAAmB,CAAC,EAEzF,GAAI,CACA,MAAMR,EAAM,MAAM,MAAM,cAAe,CAAE,YAAa,UAAW,EAC3DC,EAAO,MAAMD,EAAI,KAAI,EAEvBA,EAAI,IACJyF,EAAWxF,EAAK,MAAQ,CAAA,EACxB0F,EAAgB,IAEhB1D,EAAU,UAAY,GACtBA,EAAU,YAAYzB,EAAc,MAAO,CAAE,UAAW,aAAa,EAAIP,EAAK,SAAW,sBAAsB,CAAC,EAExH,OAAS+C,EAAG,CACR,QAAQ,MAAM,qBAAsBA,CAAC,EACrCf,EAAU,UAAY,GACtBA,EAAU,YAAYzB,EAAc,MAAO,CAAE,UAAW,eAAiB,CACrEA,EAAc,IAAK,CAAA,EAAI,sBAAsB,EAC7CA,EAAc,SAAU,CACpB,GAAI,iBACJ,MAAO,CAAE,UAAW,OAAQ,QAAS,cAAe,WAAY,qBAAsB,MAAO,QAAS,OAAQ,OAAQ,aAAc,MAAO,OAAQ,SAAS,EAC5J,QAAS8E,CACzB,EAAe,WAAW,CAC1B,CAAS,CAAC,CACN,CACJ,CAEA,SAASK,GAAmB,CACxB,MAAM1D,EAAY,SAAS,eAAe,iBAAiB,EAE3D,IAAI2D,EAAWH,EAOf,GANIC,IAAwB,QACxBE,EAAWH,EAAS,OAAO,GAAK,EAAE,SAAWC,CAAmB,GAGpEzD,EAAU,UAAY,GAElB,CAAC2D,EAAS,OAAQ,CAClB3D,EAAU,YAAYzB,EAAc,MAAO,CAAE,UAAW,aAAa,EAAI,iBAAiB,CAAC,EAC3F,MACJ,CAEA,MAAMkC,EAAW,SAAS,uBAAsB,EAEhDkD,EAAS,QAAQC,GAAS,CACtB,MAAMC,EAAO,IAAI,KAAKD,EAAM,SAAS,EAAE,mBAAmB,QAAS,CAC/D,MAAO,QAAS,IAAK,UAAW,KAAM,SAClD,CAAS,EAEKE,EAAS,CAAA,EACf,GAAIF,EAAM,OAAO,UAAW,CACxB,MAAMG,EAAY,GAAGH,EAAM,MAAM,SAAS,SAE1CE,EAAO,KAAKvF,EAAc,OAAQ,CAAE,UAAW,mBAAmB,EAAIwF,CAAS,CAAC,CACpF,CACAD,EAAO,KAAKvF,EAAc,OAAQ,CAAE,UAAW,eAAeqF,EAAM,MAAM,EAAE,EAAIA,EAAM,MAAM,CAAC,EAE7F,MAAMI,EAAYzF,EAAc,MAAO,CACnC,UAAW,aACX,QAAS,IAAM,OAAO,gBAAgBqF,EAAM,GAAG,CAC3D,EAAW,CACCrF,EAAc,MAAO,CAAE,UAAW,WAAW,EAAI,CAC7CA,EAAc,MAAO,CAAE,UAAW,cAAc,EAAIqF,EAAM,WAAW,EACrErF,EAAc,MAAO,CAAE,UAAW,wBAAwB,EAAI,GAAGqF,EAAM,SAAS,MAAM,QAAQA,EAAM,SAAS,SAAW,EAAI,IAAM,EAAE,EAAE,CACtJ,CAAa,EACDrF,EAAc,MAAO,CAAE,UAAW,cAAc,EAAI,CAChDA,EAAc,MAAO,CAAE,UAAW,YAAY,EAAIsF,CAAI,EACtDtF,EAAc,MAAO,CAAE,UAAW,cAAc,EAAIuF,CAAM,CAC1E,CAAa,CACb,CAAS,EACDrD,EAAS,YAAYuD,CAAS,CAClC,CAAC,EAEDhE,EAAU,YAAYS,CAAQ,CAClC,CAEA,SAASwD,GAAqBC,EAAQ,CAClCT,EAAsBS,EAEtB,SAAS,iBAAiB,cAAc,EAAE,QAAQC,GAAQ,CACtDA,EAAK,UAAU,OAAO,SAAUA,EAAK,QAAQ,SAAWD,CAAM,CAClE,CAAC,EAEDR,EAAgB,CACpB,CAGA,SAAS,iBAAiB,cAAc,EAAE,QAAQS,GAAQ,CACtDA,EAAK,iBAAiB,QAAS,IAAMF,GAAqBE,EAAK,QAAQ,MAAM,CAAC,CAClF,CAAC,EAKD,IAAIC,EAAe,KACfC,EAAiB,CAAA,EACjBC,EAAgB,CAAA,EAEpB,eAAeC,GAAgBC,EAAS,CACpC,GAAI,CAEA,KAAM,CAACC,EAAUC,CAAW,EAAI,MAAM,QAAQ,IAAI,CAC9C,MAAM,eAAeF,CAAO,GAAI,CAAE,YAAa,UAAW,EAC1D,MAAM,0BAA0BA,CAAO,GAAI,CAAE,YAAa,SAAS,CAAE,CACjF,CAAS,EAEKG,EAAY,MAAMF,EAAS,KAAI,EAErC,GAAIA,EAAS,IAAME,EAAU,KAAM,CAC/BP,EAAeO,EAAU,KACzBN,EAAiB,KAAK,MAAM,KAAK,UAAUD,EAAa,UAAY,CAAA,CAAE,CAAC,EAGvE,GAAI,CACA,MAAMQ,EAAe,MAAMF,EAAY,KAAI,EAC3CJ,EAAgBI,EAAY,GAAME,EAAa,MAAQ,CAAA,EAAM,CAAA,CACjE,OAASC,EAAmB,CACxB,QAAQ,KAAK,2BAA4BA,EAAkB,OAAO,EAClEP,EAAgB,CAAA,CACpB,CAEAQ,GAAgB,EAChB,SAAS,eAAe,YAAY,EAAE,UAAU,IAAI,MAAM,EAC1D,SAAS,KAAK,MAAM,SAAW,QACnC,MACI7G,EAAU0G,EAAU,SAAW,uBAAwB,MAAM,CAErE,OAAS5D,EAAG,CACR,QAAQ,MAAM,2BAA4BA,CAAC,EAC3C9C,EAAU,yBAA0B,MAAM,CAC9C,CACJ,CAEA,SAAS8G,GAAkB,CACnBnH,GACI,CAAC,QAAQ,yCAAyC,IAI1D,SAAS,eAAe,YAAY,EAAE,UAAU,OAAO,MAAM,EAC7D,SAAS,KAAK,MAAM,SAAW,GAC/BwG,EAAe,KACfC,EAAiB,CAAA,EACjBC,EAAgB,CAAA,EAChB1G,EAAkB,GACtB,CAEA,SAASkH,IAAmB,CACxB,MAAME,EAAYZ,EAAa,SAAW,UACpCa,EAAU,SAAS,eAAe,iBAAiB,EACnDC,EAAS,SAAS,eAAe,gBAAgB,EACjDC,EAAW,SAAS,eAAe,kBAAkB,EAE3DF,EAAQ,YAAcb,EAAa,YACnCc,EAAO,UAAY,GAEnB,MAAME,EAAkB,SAAS,uBAAsB,EAGjDC,EAAW9G,EAAc,MAAO,CAAE,UAAW,iBAAiB,EAAI,CACpEA,EAAc,MAAO,GAAI,CACrBA,EAAc,MAAO,CAAE,UAAW,YAAY,EAAI,QAAQ,EAC1DA,EAAc,OAAQ,CAAE,UAAW,eAAe6F,EAAa,MAAM,IAAMA,EAAa,MAAM,CAC1G,CAAS,EACD7F,EAAc,MAAO,GAAI,CACrBA,EAAc,MAAO,CAAE,UAAW,YAAY,EAAI,MAAM,EACxDA,EAAc,MAAO,CAAE,UAAW,YAAY,EAAI,IAAI,KAAK6F,EAAa,SAAS,EAAE,mBAAmB,QAAS,CAC3G,MAAO,QAAS,IAAK,UAAW,KAAM,SACtD,CAAa,CAAC,CACd,CAAS,CACT,CAAK,EAED,GAAIA,EAAa,OAAO,UAAW,CAC/B,MAAMkB,EAAclB,EAAa,OAAO,SAAW,YACnDiB,EAAS,YAAY9G,EAAc,MAAO,CAAA,EAAI,CAC1CA,EAAc,MAAO,CAAE,UAAW,YAAY,EAAI,OAAO,EACzDA,EAAc,OAAQ,CAAE,UAAW,mBAAmB,EAAI,CACtD,GAAG6F,EAAa,MAAM,SAAS,SAC/BkB,EAAc,MAAQ,EACtC,CAAa,CACb,CAAS,CAAC,CACN,CAEA,MAAMC,EAAmBhH,EAAc,MAAO,CAAE,UAAW,oBAAoB,EAAI,CAC/E8G,EACAjB,EAAa,gBAAkB7F,EAAc,MAAO,CAAE,MAAO,CAAE,UAAW,MAAM,GAAM,CAClFA,EAAc,MAAO,CAAE,UAAW,YAAY,EAAI,kBAAkB,EACpEA,EAAc,MAAO,CAAE,UAAW,YAAY,EAAI6F,EAAa,eAAe,CAC1F,CAAS,EAAI,KACLA,EAAa,MAAQ7F,EAAc,MAAO,CAAE,MAAO,CAAE,UAAW,MAAM,GAAM,CACxEA,EAAc,MAAO,CAAE,UAAW,YAAY,EAAI,OAAO,EACzDA,EAAc,MAAO,CAAE,UAAW,YAAY,EAAI6F,EAAa,KAAK,CAChF,CAAS,EAAI,IACb,EAAM,OAAO,OAAO,CAAC,EAEjBgB,EAAgB,YAAYG,CAAgB,EAC5CH,EAAgB,YAAY7G,EAAc,MAAO,CAAE,UAAW,SAAS,CAAE,CAAC,EAC1E6G,EAAgB,YAAY7G,EAAc,MAAO,CAAE,UAAW,aAAc,MAAO,CAAE,aAAc,SAAU,EAAI,UAAU,CAAC,EAG5H,MAAMiH,EAAejH,EAAc,MAAO,CAAE,GAAI,mBAAmB,CAAE,EAKrE,GAJAkH,EAAoBT,EAAWQ,CAAY,EAC3CJ,EAAgB,YAAYI,CAAY,EAGpClB,EAAc,OAAS,EAAG,CAC1Bc,EAAgB,YAAY7G,EAAc,MAAO,CAAE,UAAW,SAAS,CAAE,CAAC,EAC1E6G,EAAgB,YAAY7G,EAAc,MAAO,CAAE,UAAW,aAAc,MAAO,CAAE,aAAc,SAAU,EAAI,UAAU,CAAC,EAE5H,MAAMmH,EAAenH,EAAc,MAAO,CAAE,UAAW,eAAe,CAAE,EACxE+F,EAAc,QAAQqB,GAAO,CACzB,MAAM9B,EAAO,IAAI,KAAK8B,EAAI,WAAW,EAAE,mBAAmB,QAAS,CAAE,MAAO,QAAS,IAAK,SAAS,CAAE,EAC/FtF,EAAO9B,EAAc,MAAO,CAC9B,UAAW,eACX,QAAS,IAAM,OAAO,gBAAgBoH,EAAI,aAAa,CACvE,EAAe,CACCpH,EAAc,MAAO,CAAE,UAAW,cAAc,EAAI,CAChDA,EAAc,MAAO,CAAE,UAAW,gBAAgB,EAAIoH,EAAI,aAAa,EACvEpH,EAAc,MAAO,CAAE,UAAW,cAAc,EAAI,GAAGoH,EAAI,MAAM,MAAQ,cAAc,MAAM9B,CAAI,EAAE,CACvH,CAAiB,EACDtF,EAAc,MAAO,CAAE,UAAW,kBAAkB,EAAI,CAMxE,CAAiB,CACjB,CAAa,EAED8B,EAAK,cAAc,mBAAmB,EAAE,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,wBAOpDqF,EAAa,YAAYrF,CAAI,CACjC,CAAC,EACD+E,EAAgB,YAAYM,CAAY,CAC5C,CAEAR,EAAO,YAAYE,CAAe,EAGlCD,EAAS,UAAY,GACjBH,GACAG,EAAS,YAAY5G,EAAc,SAAU,CACzC,UAAW,oBACX,QAAS,IAAM,OAAO,gBAAe,CACjD,EAAW,QAAQ,CAAC,EAEZ4G,EAAS,YAAY5G,EAAc,SAAU,CACzC,UAAW,kBACX,MAAO,CAAE,KAAM,GAAG,EAClB,QAAS,IAAM,OAAO,cAAa,CAC/C,EAAW,cAAc,CAAC,GAElB4G,EAAS,YAAY5G,EAAc,SAAU,CACzC,UAAW,4BACX,QAAS,IAAM,OAAO,gBAAe,CACjD,EAAW,OAAO,CAAC,CAEnB,CAEA,SAASkH,EAAoBG,EAAU5F,EAAW,CAOzCA,IACLA,EAAU,UAAY,GAEtBqE,EAAe,QAAQ,CAAChE,EAAMwF,IAAU,CAChCD,EACA5F,EAAU,YAAYzB,EAAc,MAAO,CACvC,UAAW,oBACX,QAAS,CAAE,MAAOsH,CAAK,CACvC,EAAe,CACCtH,EAAc,MAAO,CAAE,UAAW,cAAc,EAAI,CAChDA,EAAc,MAAO,CAAE,UAAW,cAAc,EAAI8B,EAAK,WAAW,EACpE9B,EAAc,MAAO,CAAE,UAAW,cAAc,EAAI8B,EAAK,IAAI,CACjF,CAAiB,EACD9B,EAAc,MAAO,CAAE,UAAW,cAAc,EAAI,CAChDA,EAAc,SAAU,CACpB,UAAW,UACX,QAAS,IAAM,OAAO,eAAesH,EAAO,EAAE,CACtE,EAAuB,GAAG,EACNtH,EAAc,QAAS,CACnB,KAAM,SACN,UAAW,YACX,GAAI,aAAasH,CAAK,GACtB,MAAOxF,EAAK,SACZ,IAAK,IACL,UAAW,UACX,SAAU,IAAM,OAAO,wBAAwBwF,CAAK,CAC5E,CAAqB,EACDtH,EAAc,SAAU,CACpB,UAAW,UACX,QAAS,IAAM,OAAO,eAAesH,EAAO,CAAC,CACrE,EAAuB,GAAG,CAC1B,CAAiB,CACjB,CAAa,CAAC,EAEF7F,EAAU,YAAYzB,EAAc,MAAO,CACvC,UAAW,4BAC3B,EAAe,CACCA,EAAc,MAAO,CAAE,UAAW,cAAc,EAAI,CAChDA,EAAc,MAAO,CAAE,UAAW,cAAc,EAAI8B,EAAK,WAAW,EACpE9B,EAAc,MAAO,CAAE,UAAW,cAAc,EAAI,GAAG8B,EAAK,QAAQ,IAAIA,EAAK,IAAI,EAAE,CACvG,CAAiB,CACjB,CAAa,CAAC,CAEV,CAAC,EACL,CAEA,SAASyF,GAAeD,EAAOxE,EAAO,CAClC,MAAMJ,EAAQ,SAAS,eAAe,aAAa4E,CAAK,EAAE,EAC1D,IAAIvE,EAAM,WAAWL,EAAM,KAAK,GAAK,EACrCK,EAAM,KAAK,IAAI,EAAGA,EAAMD,CAAK,EAC7BJ,EAAM,MAAQK,EACd+C,EAAewB,CAAK,EAAE,SAAWvE,EACjC1D,EAAkB,EACtB,CAEA,SAASmI,GAAwBF,EAAO,CACpC,MAAM5E,EAAQ,SAAS,eAAe,aAAa4E,CAAK,EAAE,EACpDvE,EAAM,KAAK,IAAI,EAAG,WAAWL,EAAM,KAAK,GAAK,CAAC,EACpDA,EAAM,MAAQK,EACd+C,EAAewB,CAAK,EAAE,SAAWvE,EACjC1D,EAAkB,EACtB,CAEA,eAAeoI,GAAgBC,EAAe,CAC1C,GAAI,CACAhI,EAAU,yBAA0B,MAAM,EAE1C,MAAMF,EAAM,MAAM,MAAM,oBAAoBkI,CAAa,YAAa,CAClE,YAAa,SACzB,CAAS,EAED,GAAI,CAAClI,EAAI,GAAI,CAET,IAAImI,EAAe,wBACnB,GAAI,CAEAA,GADc,MAAMnI,EAAI,KAAI,GACP,SAAWmI,CACpC,OAASC,EAAY,CACjB,QAAQ,KAAK,0CAA2CA,EAAW,OAAO,EAE1ED,EAAenI,EAAI,SAAW,IAAM,wBAChCA,EAAI,SAAW,IAAM,yBACjB,iCACZ,CACA,MAAM,IAAI,MAAMmI,CAAY,CAChC,CAEA,MAAME,EAAO,MAAMrI,EAAI,KAAI,EACrBsI,EAAM,OAAO,IAAI,gBAAgBD,CAAI,EACrCE,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAOD,EACTC,EAAE,SAAW,GAAGL,CAAa,OAC7B,SAAS,KAAK,YAAYK,CAAC,EAC3BA,EAAE,MAAK,EACP,SAAS,KAAK,YAAYA,CAAC,EAC3B,OAAO,IAAI,gBAAgBD,CAAG,EAE9BpI,EAAU,sBAAuB,SAAS,CAC9C,OAAS8C,EAAG,CACR,QAAQ,MAAM,0BAA2BA,CAAC,EAC1C9C,EAAU8C,EAAE,SAAW,qBAAsB,MAAM,CACvD,CACJ,CAEA,eAAewF,IAAgB,CAC3B,GAAI,CAEA,MAAM/I,EAAW6G,EACZ,OAAO1F,GAAKA,EAAE,SAAW,CAAC,EAC1B,IAAIA,IAAM,CACP,QAAS,OAAOA,EAAE,SAAY,SAAWA,EAAE,QAAQ,IAAMA,EAAE,QAC3D,SAAUA,EAAE,QAC5B,EAAc,EAEN,GAAI,CAACnB,EAAS,OAAQ,CAClBS,EAAU,2BAA4B,MAAM,EAC5C,MACJ,CAEA,MAAMuI,EAAU,SAAS,cAAc,gCAAgC,EACnEA,IACAA,EAAQ,SAAW,GACnBA,EAAQ,YAAc,aAG1B,MAAMjE,EAAU,CAAE,eAAgB,kBAAkB,EAC9CC,EAAY,MAAMvF,EAAK,gBAAe,EACxCuF,IACAD,EAAQ,cAAc,EAAIC,GAG9B,MAAMiE,EAAU,CAAE,SAAAjJ,CAAQ,EAE1B,IAAIO,EAAM,MAAM,MAAM,eAAeqG,EAAa,GAAG,iBAAkB,CACnE,OAAQ,MACR,QAAA7B,EACA,YAAa,UACb,KAAM,KAAK,UAAUkE,CAAO,CACxC,CAAS,EAEGzI,EAAO,MAAMD,EAAI,KAAI,EAGzB,GAAIA,EAAI,SAAW,KAAOC,GAAM,SAAS,YAAW,EAAG,SAAS,MAAM,EAAG,CACrE,MAAM4E,EAAW,MAAM3F,EAAK,iBAAgB,EACxC2F,IACAL,EAAQ,cAAc,EAAIK,EAC1B7E,EAAM,MAAM,MAAM,eAAeqG,EAAa,GAAG,iBAAkB,CAC/D,OAAQ,MACR,QAAA7B,EACA,YAAa,UACb,KAAM,KAAK,UAAUkE,CAAO,CAChD,CAAiB,EACDzI,EAAO,MAAMD,EAAI,KAAI,EAE7B,CAEIA,EAAI,IACJE,EAAU,6BAA8B,SAAS,EACjDL,EAAkB,GAClBmH,EAAe,EACf1B,KAEApF,EAAUD,EAAK,SAAW,mBAAoB,MAAM,CAE5D,OAAS,EAAG,CACR,QAAQ,MAAM,oBAAqB,CAAC,EAC/B,UAAU,OAGXC,EAAU,+BAAgC,MAAM,EAFhDA,EAAU,yBAA0B,MAAM,CAIlD,QAAC,CACG,MAAMuI,EAAU,SAAS,cAAc,gCAAgC,EACnEA,IACAA,EAAQ,SAAW,GACnBA,EAAQ,YAAc,eAE9B,CACJ,CAGA,MAAME,EAAa,SAAS,eAAe,YAAY,EACnDA,GACAA,EAAW,iBAAiB,QAAU,GAAM,CACpC,EAAE,OAAO,KAAO,cAChB3B,EAAe,CAEvB,CAAC,EAIL,SAAS,iBAAiB,UAAY,GAAM,CACxC,MAAM4B,EAAQ,SAAS,eAAe,YAAY,EAC9C,EAAE,MAAQ,UAAYA,GAASA,EAAM,UAAU,SAAS,MAAM,GAC9D5B,EAAe,CAEvB,CAAC,EAGD,SAAS,iBAAiB,mBAAoB,IAAM,CAC5C,SAAS,kBAAoB,WAAajC,IAAe,QACzDO,EAAY,CAEpB,CAAC,EAGD,OAAO,UAAYrC,GACnB,OAAO,YAAcE,GACrB,OAAO,UAAYE,GACnB,OAAO,gBAAkBD,EACzB,OAAO,WAAac,GACpB,OAAO,gBAAkBsC,GACzB,OAAO,gBAAkBQ,EACzB,OAAO,cAAgBwB,GACvB,OAAO,oBAAsBd,EAC7B,OAAO,eAAiBK,GACxB,OAAO,wBAA0BC,GACjC,OAAO,gBAAkBC,GAEzBnI,EAAI"}