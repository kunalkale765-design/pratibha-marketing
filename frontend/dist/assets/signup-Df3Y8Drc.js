import"./responsive-D1ZTW0b0.js";import"./ui-Bns_kLia.js";import"./api-CCOw0EgE.js";import{r as E}from"./init-CHmvMvUV.js";E();const k=(e=1e4)=>new Promise((u,s)=>{const o=Date.now(),n=()=>{if(window.Auth)return u(window.Auth);if(Date.now()-o>e)return s(new Error("Auth not available"));setTimeout(n,50)};n()}),h=await k();h.ensureCsrfToken().catch(e=>console.warn("CSRF pre-fetch failed:",e));const v=document.getElementById("signupForm"),d=document.getElementById("signupBtn"),a=document.getElementById("noticeMessage"),c=document.getElementById("successMessage"),T=document.getElementById("password");T&&T.addEventListener("input",function(){const e=this.value;w("req-length",e.length>=6),w("req-upper",/[A-Z]/.test(e)),w("req-number",/[0-9]/.test(e))});function w(e,u){const s=document.getElementById(e);if(!s)return;const o=s.textContent.substring(2);u?(s.classList.add("valid"),s.textContent="✓ "+o):(s.classList.remove("valid"),s.textContent="◯ "+o)}B();async function B(){try{(await fetch("/api/auth/me",{credentials:"include"})).ok&&(window.location.href="/")}catch{}}v&&v.addEventListener("submit",async e=>{e.preventDefault();const u=document.getElementById("name").value.trim(),s=document.getElementById("email").value.trim(),o=document.getElementById("phone").value.trim(),n=document.getElementById("password").value,p=document.getElementById("confirmPassword").value;if(!u||!s||!n||!p){t("Please complete all required fields");return}if(n.length<6){t("Password needs at least 6 characters");return}if(!/[A-Z]/.test(n)){t("Add an uppercase letter to password");return}if(!/[a-z]/.test(n)){t("Add a lowercase letter to password");return}if(!/[0-9]/.test(n)){t("Add a number to password");return}if(n!==p){t("Passwords don't match");return}if(o&&!/^[0-9]{10}$/.test(o)){t("Phone should be 10 digits");return}d.disabled=!0,d.textContent="Creating account...",I();try{const r={name:u,email:s,password:n,role:"customer"};o&&(r.phone=o);const m={"Content-Type":"application/json"},y=await h.ensureCsrfToken();y&&(m["X-CSRF-Token"]=y);const g=await fetch("/api/auth/register",{method:"POST",headers:m,credentials:"include",body:JSON.stringify(r)}),i=await g.json();if(g.status===403&&i?.message?.toLowerCase().includes("csrf")){console.log("CSRF error, refreshing token and retrying...");const f=await h.refreshCsrfToken();if(f){m["X-CSRF-Token"]=f;const C=await fetch("/api/auth/register",{method:"POST",headers:m,credentials:"include",body:JSON.stringify(r)}),l=await C.json();if(C.ok){localStorage.setItem("user",JSON.stringify(l.user)),S("Account created successfully! Redirecting..."),setTimeout(()=>{l.user.role==="customer"?window.location.href="/pages/order-form/":window.location.href="/"},1500);return}l.errors&&l.errors.length>0?t(l.errors.map(A=>A.msg).join(", ")):t(l.message||"Could not create account. Try again.");return}}g.ok?(localStorage.setItem("user",JSON.stringify(i.user)),S("Account created successfully! Redirecting..."),setTimeout(()=>{i.user.role==="customer"?window.location.href="/pages/order-form/":window.location.href="/"},1500)):i.errors&&i.errors.length>0?t(i.errors.map(f=>f.msg).join(", ")):t(i.message||"Could not create account. Try again.")}catch(r){console.error("Signup error:",r),navigator.onLine?r.name==="TypeError"||r.message.includes("fetch")?t("Connection issue. Please try again."):t("Something went wrong. Try again."):t("No internet connection")}finally{d&&(d.disabled=!1,d.textContent="Create Account")}});function t(e){a&&(a.textContent=e,a.classList.add("show"),c&&c.classList.remove("show"))}function S(e){c&&(c.textContent=e,c.classList.add("show"),a&&a.classList.remove("show"))}function I(){a&&a.classList.remove("show"),c&&c.classList.remove("show")}
