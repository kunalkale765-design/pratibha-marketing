import"./responsive-D1ZTW0b0.js";/* empty css             *//* empty css                */import{c as r,s as E}from"./ui-Bns_kLia.js";import"./api-CCOw0EgE.js";import{i as oe,l as ne}from"./init-CHmvMvUV.js";function x(e,t=!0){if(e==null||isNaN(e))return t?"₹0":"0";const o=Number(e).toLocaleString("en-IN",{minimumFractionDigits:0,maximumFractionDigits:2});return t?`₹${o}`:o}const _=(e=0)=>new Promise((t,o)=>{window.Auth?t(window.Auth):e>500?o(new Error("Auth module failed to load")):setTimeout(()=>_(e+1).then(t).catch(o),10)});let k;try{k=await _()}catch(e){console.error("Auth initialization failed:",e),window.location.href="/pages/auth/login.html"}oe();let J=[],y={toProcure:[],procured:[],categories:[]},L="",C="";const P={};let T={},b=null,h=null,N=null,F=!1,O=!1;function re(){N=new Audio("/assets/sounds/notification.wav"),N.preload="auto",N.volume=.5}window.addEventListener("beforeunload",()=>{b&&(clearInterval(b),b=null),h&&(h.close().catch(()=>{}),h=null),N&&(N=null)});document.addEventListener("visibilitychange",()=>{document.hidden?b&&(clearInterval(b),b=null):b||ee()});function se(){if(F){if(N){N.currentTime=0,N.play().catch(()=>{H()});return}H()}}function H(){try{h||(h=new(window.AudioContext||window.webkitAudioContext)),h.state==="suspended"&&h.resume();const e=h.createOscillator(),t=h.createOscillator(),o=h.createGain();e.connect(o),t.connect(o),o.connect(h.destination),e.frequency.value=880,e.type="sine",t.frequency.value=1108.73,t.type="sine";const n=h.currentTime;o.gain.setValueAtTime(0,n),o.gain.linearRampToValueAtTime(.3,n+.05),o.gain.linearRampToValueAtTime(.2,n+.15),o.gain.linearRampToValueAtTime(.3,n+.2),o.gain.linearRampToValueAtTime(0,n+.35),e.start(n),t.start(n),e.stop(n+.35),t.stop(n+.35)}catch(e){console.log("Could not play notification sound:",e)}}const V=document.getElementById("logoutBtn"),z=document.getElementById("printBtn"),W=document.getElementById("exportBtn"),v=document.getElementById("saveRatesBtn"),X=document.getElementById("purchaseSearch"),R=document.getElementById("newOrderBadge"),$=document.getElementById("procuredHeader");V&&V.addEventListener("click",ne);z&&z.addEventListener("click",le);W&&W.addEventListener("click",ie);v&&v.addEventListener("click",de);X&&X.addEventListener("input",e=>{L=e.target.value.trim().toLowerCase(),B()});const Z=document.getElementById("categoryPills");Z&&Z.addEventListener("click",e=>{const t=e.target.closest(".category-pill");t&&(document.querySelectorAll(".category-pill").forEach(o=>o.classList.remove("active")),t.classList.add("active"),C=t.dataset.category,B())});function ce(e){const t=document.getElementById("categoryPills");if(!t)return;t.innerHTML='<button class="category-pill active" data-category="">All</button>';const o={"Indian Vegetables":"Vegetables","Exotic Vegetables":"Exotic",Fruits:"Fruits",Frozen:"Frozen",Dairy:"Dairy"};if(e.forEach(n=>{const s=r("button",{className:"category-pill"+(C===n?" active":""),dataset:{category:n}},o[n]||n);t.appendChild(s)}),C){const n=t.querySelector(`[data-category="${C}"]`);n?(t.querySelector(".active")?.classList.remove("active"),n.classList.add("active")):C=""}}$&&$.addEventListener("click",()=>{$.classList.toggle("collapsed")});function G(){if(!F)try{h=new(window.AudioContext||window.webkitAudioContext),re(),F=!0}catch(e){console.log("Could not initialize audio:",e)}}document.addEventListener("click",G,{once:!0});document.addEventListener("touchstart",G,{once:!0});async function S(){try{const[e,t,o,n]=await Promise.all([fetch("/api/orders",{credentials:"include"}),fetch("/api/products",{credentials:"include"}),fetch("/api/market-rates",{credentials:"include"}),fetch("/api/supplier/procurement-summary",{credentials:"include"})]);if(!e.ok||!t.ok||!o.ok||!n.ok){const p=e.ok?t.ok?o.ok?"procurement":"rates":"products":"orders";throw new Error(`Failed to load ${p} data (status: ${e.ok?t.ok?o.ok?n.status:o.status:t.status:e.status})`)}const s=await e.json(),l=await o.json(),u=await n.json();J=l.data||[],y={toProcure:u.toProcure||[],procured:u.procured||[],categories:u.categories||[]},ce(y.categories),Y(y),K(y);const i=s.data||[],c=i.filter(p=>p.status==="delivered"||p.paymentStatus==="paid").reduce((p,a)=>p+(a.totalAmount||0),0),d=c*.15;document.getElementById("totalSale").textContent=x(c),document.getElementById("totalProfit").textContent=x(d),B(),pe(i),ee()}catch(e){console.error("Error loading dashboard stats:",e);const t=document.getElementById("totalSale"),o=document.getElementById("totalProfit"),n=document.getElementById("toProcureList");t&&(t.textContent="—"),o&&(o.textContent="—"),n&&(n.innerHTML="",n.appendChild(r("div",{className:"empty-state"},[r("p",{},"Data not available"),r("button",{id:"retryBtn",className:"btn-retry",style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"var(--dusty-olive)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},onclick:S},"Try Again")])))}}function K(e){T={},[...e.toProcure,...e.procured].forEach(t=>{T[t.productId]=t.totalQty})}function Y(e){if(Object.keys(T).length===0)return;let t=0;[...e.toProcure,...e.procured].forEach(n=>{const s=T[n.productId]||0;n.totalQty>s&&t++}),t>0&&(se(),R&&(R.textContent=`${t} new`,R.classList.remove("hidden"),setTimeout(()=>{R.classList.add("hidden")},3e4)),E(`${t} product(s) have new orders!`,"info"))}function ee(){b&&clearInterval(b),b=setInterval(async()=>{if(!O){O=!0;try{const e=await fetch("/api/supplier/procurement-summary",{credentials:"include"});if(!e.ok){console.warn("Polling failed:",e.status);return}const t=await e.json();if(e.ok){const o={toProcure:t.toProcure||[],procured:t.procured||[],categories:t.categories||[]};Y(o),y=o,K(y),B(!0)}}catch(e){console.error("Polling error:",e)}finally{O=!1}}},3e4)}function B(e=!1){const t=document.getElementById("toProcureList"),o=document.getElementById("procuredList"),n=document.getElementById("procurementEmpty"),s=document.getElementById("procuredCount");if(!t||!o){console.error("Purchase List: Required DOM elements missing (toProcureList or procuredList). Check index.html structure.");const d=document.querySelector(".procurement-container");if(d&&!d.querySelector(".procurement-error")){const a=document.createElement("div");a.className="procurement-error",a.style.cssText="padding:1.5rem;text-align:center;color:var(--error);font-size:0.875rem;",a.textContent="Purchase list failed to load. Please refresh the page.",d.appendChild(a)}return}const l={};e&&document.querySelectorAll(".item-rate-input").forEach(d=>{d.value&&(l[d.dataset.productId]=d.value)}),t.innerHTML="",o.innerHTML="";const u=d=>d.filter(p=>{const a=!L||p.productName.toLowerCase().includes(L),g=!C||p.category===C;return a&&g}),i=u(y.toProcure),c=u(y.procured);s&&(s.textContent=c.length),i.length===0&&y.toProcure.length===0?(n&&n.classList.remove("hidden"),t.innerHTML='<div class="empty-list-msg">No items to procure</div>'):n&&n.classList.add("hidden");const m={};if(J.forEach(d=>{m[d.product]=d}),i.length>0){const d=document.createDocumentFragment();d.appendChild(r("div",{className:"procurement-column-header"},[r("span",{className:"col-expand"}),r("span",{className:"col-name"},"Product"),r("span",{className:"col-qty"},"Qty"),r("span",{className:"col-input"},"Rate")]));let p="";i.forEach(a=>{a.category!==p&&(p=a.category,d.appendChild(r("div",{className:"category-divider"},p)));const g=m[a.productId],f=a.currentRate||g?.rate||0,U=l[a.productId]||"",te=f===0?" unsaved":"";let D;a.wasProcured?D=r("span",{className:"qty-breakdown"},[r("span",{className:"procured-qty"},String(a.procuredQty||0)),r("span",{className:"separator"},"+"),r("span",{className:"new-qty highlight-new"},String(a.newQty||0))]):D=r("span",{className:"qty-simple"},String(a.totalQty||0));const A=[r("div",{className:"detail-row"},[r("span",{className:"detail-label"},"Total Orders"),r("span",{className:"detail-value"},a.totalOrders||0)])];a.wasProcured&&a.lastRate&&A.unshift(r("div",{className:"detail-row highlight-info"},[r("span",{className:"detail-label"},"Last Rate"),r("span",{className:"detail-value"},`₹${a.lastRate}/${a.unit}`)])),A.push(r("div",{className:"detail-row"},[r("span",{className:"detail-label"},"Est. Cost"),r("span",{className:"detail-value highlight"},a.totalQty>0&&f>0?x(a.totalQty*f):"—")]),r("div",{className:"detail-row"},[r("span",{className:"detail-label"},"Trend"),r("span",{className:"detail-value"},a.trend==="up"?"↑ Up":a.trend==="down"?"↓ Down":"— Stable")]));const ae=r("div",{className:`procurement-item${te}${a.wasProcured?" was-procured":""}`,dataset:{productId:a.productId}},[r("div",{className:"item-main",onclick:I=>window.toggleExpand(I.currentTarget)},[r("span",{className:"item-expand"},"▶"),r("span",{className:"item-name"},a.productName),D,r("span",{className:"item-unit"},a.unit),r("input",{type:"number",className:"item-rate-input"+(U?" changed":""),dataset:{productId:a.productId,productName:a.productName,currentRate:f,quantity:a.totalQty||0},placeholder:"₹0",value:U,step:"0.01",min:"0",onclick:I=>I.stopPropagation(),onchange:I=>window.handleRateChange(I.target),oninput:I=>window.handleRateInput(I.target)})]),r("div",{className:"item-details"},A)]);d.appendChild(ae)}),t.appendChild(d)}else(L||C)&&(t.innerHTML='<div class="empty-list-msg">No matching items</div>');if(c.length>0){const d=document.createDocumentFragment();let p="";c.forEach(a=>{a.category!==p&&(p=a.category,d.appendChild(r("div",{className:"category-divider"},p)));const g=r("div",{className:"procurement-item procured-item",dataset:{productId:a.productId}},[r("div",{className:"item-main",onclick:f=>window.toggleExpand(f.currentTarget)},[r("span",{className:"item-expand"},"▶"),r("span",{className:"item-name"},"✓ "+a.productName),r("span",{className:"qty-simple"},String(a.procuredQty||0)),r("span",{className:"item-unit"},a.unit),r("span",{className:"procured-rate"},`₹${a.rate}`)]),r("div",{className:"item-details"},[r("div",{className:"detail-row"},[r("span",{className:"detail-label"},"Procured At"),r("span",{className:"detail-value"},new Date(a.procuredAt).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kolkata"}))]),r("div",{className:"detail-row"},[r("span",{className:"detail-label"},"Total Orders"),r("span",{className:"detail-value"},a.totalOrders||0)]),r("div",{className:"detail-row"},[r("span",{className:"detail-label"},"Total Value"),r("span",{className:"detail-value highlight"},x(a.procuredQty*a.rate))]),r("div",{className:"detail-actions"},[r("button",{className:"btn-undo",onclick:f=>{f.stopPropagation(),window.undoProcurement(a.productId,a.productName)}},"Undo")])])]);d.appendChild(g)}),o.appendChild(d)}}window.toggleExpand=function(e){e.closest(".procurement-item").classList.toggle("expanded")};window.handleRateInput=function(e){const t=parseFloat(e.dataset.currentRate),o=parseFloat(e.value);e.classList.toggle("changed",e.value&&o!==t)};window.handleRateChange=function(e){const t=e.dataset.productId,o=e.dataset.productName,n=parseFloat(e.dataset.currentRate),s=parseFloat(e.dataset.quantity)||0,l=parseFloat(e.value);e.value&&l!==n&&l>0?(P[t]={product:t,productName:o,rate:l,previousRate:n,quantity:s},e.classList.add("changed")):(delete P[t],e.classList.remove("changed")),v&&v.classList.toggle("show",Object.keys(P).length>0)};window.undoProcurement=async function(e,t){if(confirm(`Remove ${t} from procured list?`))try{const o=await k.ensureCsrfToken(),n={"Content-Type":"application/json"};o&&(n["X-CSRF-Token"]=o);const s=await fetch(`/api/supplier/procure/${e}`,{method:"DELETE",credentials:"include",headers:n});if(!s.ok){const l=await s.json();E(l.message||"Could not undo","error");return}E(`${t} moved back to TO PROCURE`,"success"),S()}catch(o){console.error("Error undoing procurement:",o),E("Could not undo","error")}};function le(){const e=c=>typeof c!="string"?String(c):c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),t=c=>c.filter(m=>{const d=!L||m.productName.toLowerCase().includes(L),p=!C||m.category===C;return d&&p}),o=t(y.toProcure),n=t(y.procured);let s="",l="";o.forEach(c=>{c.category!==l&&(l=c.category,s+=`<div class="category-header">${e(l)}</div>`);const m=c.wasProcured?`${c.procuredQty||0} + ${c.newQty||0}`:`${c.totalQty||0}`;s+=`
            <div class="procurement-item">
                <span class="item-name">${e(c.productName)}</span>
                <span class="qty-breakdown">${m}</span>
                <span class="item-unit">${e(c.unit)}</span>
                <span class="current-rate">₹${(c.currentRate||0).toFixed(0)}</span>
            </div>`});let u="";l="",n.forEach(c=>{c.category!==l&&(l=c.category,u+=`<div class="category-header">${e(l)}</div>`),u+=`
            <div class="procurement-item procured-item">
                <span class="item-name">${e(c.productName)}</span>
                <span class="qty-breakdown">${c.procuredQty||0}</span>
                <span class="item-unit">${e(c.unit)}</span>
                <span class="procured-rate">₹${c.rate}</span>
            </div>`});const i=window.open("","_blank");if(!i){E("Popup blocked. Please allow popups for this site.","error");return}i.document.write(`
        <html>
        <head>
            <title>Purchase List - Pratibha Marketing</title>
            <style>
                body { font-family: Arial, sans-serif; padding: 20px; }
                h1 { font-size: 18px; margin-bottom: 10px; }
                h2 { font-size: 14px; margin-top: 20px; color: #666; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
                .date { color: #666; margin-bottom: 20px; }
                .category-header { font-weight: bold; color: #666; margin: 15px 0 5px; font-size: 12px; text-transform: uppercase; }
                .procurement-item { padding: 8px 0; border-bottom: 1px solid #eee; display: flex; gap: 10px; align-items: center; }
                .item-name { font-weight: bold; flex: 1; }
                .qty-breakdown { font-family: monospace; min-width: 100px; }
                .item-unit { color: #666; min-width: 50px; }
                .current-rate { color: #666; min-width: 60px; text-align: right; }
                .procured-rate { color: #5d7a5f; font-weight: bold; min-width: 60px; text-align: right; }
                .procured-item .item-name::before { content: '✓ '; color: #5d7a5f; }
                .empty-msg { color: #999; font-style: italic; padding: 10px 0; }
            </style>
        </head>
        <body>
            <h1>Purchase List - Pratibha Marketing</h1>
            <div class="date">${new Date().toLocaleDateString("en-IN",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}</div>
            <h2>TO PROCURE (${o.length} items)</h2>
            ${s||'<div class="empty-msg">No items to procure</div>'}
            <h2>PROCURED (${n.length} items)</h2>
            ${u||'<div class="empty-msg">No procured items</div>'}
        </body>
        </html>
    `),i.document.close(),i.print()}function ie(){const e=[...y.toProcure,...y.procured],t=["Category","Product","Unit","Procured Qty","New Qty","Total Qty","Rate","Status"],o=e.map(i=>{const c=y.procured.find(d=>d.productId===i.productId)?"Procured":"To Procure",m=i.rate||i.currentRate||0;return[`"${i.category}"`,`"${i.productName}"`,i.unit,i.procuredQty||0,i.newQty||0,i.totalQty||i.procuredQty||0,m,c].join(",")}),n=[t.join(","),...o].join(`
`),s=new Blob([n],{type:"text/csv"}),l=window.URL.createObjectURL(s),u=document.createElement("a");u.href=l,u.download=`purchase-list-${new Date().toISOString().split("T")[0]}.csv`,u.click(),window.URL.revokeObjectURL(l)}async function de(){if(!v)return;v.textContent="Saving...",v.disabled=!0;const e=[],t=[],o={"Content-Type":"application/json"};let n=await k.ensureCsrfToken();n&&(o["X-CSRF-Token"]=n);for(const[s,l]of Object.entries(P))try{let u=await fetch("/api/supplier/procure",{method:"POST",headers:o,credentials:"include",body:JSON.stringify({productId:l.product,rate:l.rate,quantity:l.quantity||0})});if(u.status===403){const i=await u.json().catch(()=>({}));if(i.message?.toLowerCase().includes("csrf"))n=await k.refreshCsrfToken(),n&&(o["X-CSRF-Token"]=n,u=await fetch("/api/supplier/procure",{method:"POST",headers:o,credentials:"include",body:JSON.stringify({productId:l.product,rate:l.rate,quantity:l.quantity||0})}));else{e.push({productName:l.productName||s,error:i.message||`HTTP ${u.status}`});continue}}if(u.ok)t.push(s);else{const i=await u.json().catch(()=>({}));e.push({productName:l.productName||s,error:i.message||`HTTP ${u.status}`})}}catch(u){console.error("Error saving rate:",u),e.push({productName:l.productName||s,error:u.message||"Network error"})}for(const s of t)delete P[s];v.textContent="Save",v.disabled=!1,e.length>0?(E(`${e.length} rate(s) not saved. Try again.`,"info"),Object.keys(P).length>0?v.classList.add("show"):v.classList.remove("show")):(v.classList.remove("show"),document.querySelectorAll(".item-rate-input").forEach(s=>{s.value="",s.classList.remove("changed")}),E("Items marked as procured!","success")),S()}async function ue(){try{(await(await fetch("/api/health")).json()).status==="ok"?(document.getElementById("apiDot").classList.remove("offline"),document.getElementById("apiStatus").textContent="API Online"):(document.getElementById("apiDot").classList.add("offline"),document.getElementById("apiStatus").textContent="API Offline")}catch{document.getElementById("apiDot").classList.add("offline"),document.getElementById("apiStatus").textContent="API Offline"}}let q=null,Q=null,j=null;const w={olive:"rgb(126, 145, 129)",oliveLight:"rgba(126, 145, 129, 0.2)",gunmetal:"rgb(46, 53, 50)",terracotta:"rgb(196, 167, 125)",success:"rgb(93, 122, 95)",warning:"rgb(184, 154, 90)",error:"rgb(154, 101, 101)",slate:"rgb(199, 206, 219)"};async function pe(e){try{const t={pending:0,confirmed:0,delivered:0,cancelled:0};e.forEach(a=>{Object.hasOwn(t,a.status)&&t[a.status]++}),document.getElementById("pendingCount").textContent=t.pending,document.getElementById("processingCount").textContent=t.confirmed,document.getElementById("deliveredCount").textContent=t.delivered;const o=document.getElementById("orderStatusChart");o?(q&&q.destroy(),q=new Chart(o,{type:"doughnut",data:{labels:["Pending","Confirmed","Delivered","Cancelled"],datasets:[{data:[t.pending,t.confirmed,t.delivered,t.cancelled],backgroundColor:[w.warning,w.olive,w.success,w.error],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"60%",plugins:{legend:{display:!1}}}})):console.warn("Order status chart canvas not found");const n=[],s={};for(let a=6;a>=0;a--){const g=new Date;g.setDate(g.getDate()-a);const f=g.toISOString().split("T")[0];n.push(f),s[f]=0}e.forEach(a=>{if(a.status!=="cancelled"){const g=new Date(a.createdAt).toISOString().split("T")[0];Object.hasOwn(s,g)&&(s[g]+=a.totalAmount||0)}});const l=n.map(a=>s[a]),u=l.reduce((a,g)=>a+g,0),i=u/7;document.getElementById("weekTotal").textContent=x(u),document.getElementById("avgDaily").textContent=x(Math.round(i));const c=document.getElementById("revenueChart");c?(Q&&Q.destroy(),Q=new Chart(c,{type:"line",data:{labels:n.map(a=>new Date(a).toLocaleDateString("en-IN",{weekday:"short"})),datasets:[{label:"Revenue",data:l,borderColor:w.olive,backgroundColor:w.oliveLight,fill:!0,tension:.4,pointRadius:4,pointBackgroundColor:w.olive}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:a=>"₹"+a.toLocaleString("en-IN")}}}}})):console.warn("Revenue chart canvas not found");const m={};e.forEach(a=>{a.status!=="cancelled"&&a.products&&a.products.forEach(g=>{const f=g.productName||"Unknown";m[f]=(m[f]||0)+(g.quantity||0)})});const d=Object.entries(m).sort((a,g)=>g[1]-a[1]).slice(0,5),p=document.getElementById("topProductsChart");p?(j&&j.destroy(),j=new Chart(p,{type:"bar",data:{labels:d.map(([a])=>a.length>12?a.slice(0,12)+"...":a),datasets:[{label:"Quantity",data:d.map(([,a])=>a),backgroundColor:[w.olive,w.terracotta,w.gunmetal,w.success,w.warning],borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0}}}})):console.warn("Top products chart canvas not found")}catch(t){console.error("Error loading analytics:",t)}}let M=[];async function me(){try{const e=await fetch("/api/customers",{credentials:"include"}),t=await e.json();if(e.ok){M=t.data||[];const o=document.getElementById("ledgerCustomer");o.innerHTML="",o.appendChild(r("option",{value:""},"All Customers")),M.forEach(n=>{o.appendChild(r("option",{value:n._id},n.name))})}}catch(e){console.error("Error loading customers:",e)}}window.openLedgerModal=function(){M.length===0&&me();const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);document.getElementById("ledgerFromDate").value=t.toISOString().split("T")[0],document.getElementById("ledgerToDate").value=e.toISOString().split("T")[0],document.getElementById("ledgerModal").classList.add("show"),document.body.style.overflow="hidden"};window.closeLedgerModal=function(){document.getElementById("ledgerModal").classList.remove("show"),document.body.style.overflow=""};window.downloadLedger=async function(){const e=document.getElementById("ledgerCustomer").value,t=document.getElementById("ledgerFromDate").value,o=document.getElementById("ledgerToDate").value,n=new URLSearchParams;e&&n.append("customerId",e),t&&n.append("fromDate",t),o&&n.append("toDate",o);try{E("Downloading ledger...","info");const s=await fetch(`/api/reports/ledger?${n}`,{credentials:"include"});if(!s.ok){const d=await s.json();throw new Error(d.message||"Ledger temporarily unavailable")}const l=await s.blob(),u=window.URL.createObjectURL(l),i=s.headers.get("Content-Disposition");let c="ledger.xlsx";i&&i.includes("filename=")&&(c=i.split("filename=")[1].replace(/"/g,""));const m=document.createElement("a");m.href=u,m.download=c,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(u),E("Ledger downloaded!","success"),window.closeLedgerModal()}catch(s){console.error("Download ledger error:",s),E(s.message||"Could not download","info")}};async function ge(){const e=await k.requireAuth(["admin","staff"]);e&&(document.getElementById("userBadge").textContent=e.name||e.email||"User",S(),ue())}ge();
