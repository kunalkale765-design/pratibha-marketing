{"version":3,"file":"customers-nED_cADS.js","sources":["../../src/js/pages/customers.js"],"sourcesContent":["\nimport { showToast, createElement } from '/js/ui.js';\n\n// Wait for Auth to be available\nconst waitForAuth = (maxWait = 10000) => new Promise((resolve, reject) => {\n    const startTime = Date.now();\n    const check = () => {\n        if (window.Auth) return resolve(window.Auth);\n        if (Date.now() - startTime > maxWait) return reject(new Error('Auth not available'));\n        setTimeout(check, 50);\n    };\n    check();\n});\nconst Auth = await waitForAuth();\n\nlet allCustomers = [];\nlet allProducts = [];\nlet currentContractPrices = {};\nlet selectedContractCategory = '';\nlet showTestCustomers = false;\nlet customerFormDirty = false;\n\nasync function init() {\n    // Pre-fetch CSRF token to ensure it's ensureCsrfTokenready before form submissions\n    Auth.ensureCsrfToken().catch(err => console.warn('CSRF pre-fetch failed:', err));\n\n    const user = await Auth.requireAuth(['admin', 'staff']);\n    if (!user) return;\n    await Promise.all([loadCustomers(), loadProducts()]);\n}\n\nasync function loadProducts() {\n    try {\n        const res = await fetch('/api/products', { credentials: 'include' });\n        if (res.status === 401) {\n            window.location.href = '/pages/auth/login.html';\n            return;\n        }\n        if (!res.ok) {\n            throw new Error(`Server returned ${res.status}`);\n        }\n        const data = await res.json();\n        allProducts = data.data || [];\n    } catch (e) {\n        console.error('Failed to load products:', e);\n        showToast('Products not available. Try again.', 'info');\n    }\n}\n\nasync function loadCustomers() {\n    try {\n        const url = showTestCustomers ? '/api/customers?includeTest=true' : '/api/customers';\n        const res = await fetch(url, { credentials: 'include' });\n        if (res.status === 401) {\n            window.location.href = '/pages/auth/login.html';\n            return;\n        }\n        if (!res.ok) {\n            throw new Error(`Server returned ${res.status}`);\n        }\n        const data = await res.json();\n        allCustomers = data.data || [];\n        displayCustomers(allCustomers);\n    } catch (e) {\n        console.error('Failed to load customers:', e);\n        const container = document.getElementById('customersList');\n        const errorMsg = !navigator.onLine ? 'No internet connection' : 'Customers not available';\n        container.innerHTML = '';\n        container.appendChild(createElement('div', { className: 'empty-state' }, [\n            createElement('p', {}, errorMsg),\n            createElement('button', {\n                id: 'retryCustomersBtn',\n                style: { marginTop: '1rem', padding: '0.5rem 1rem', background: 'var(--dusty-olive)', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' },\n                onclick: loadCustomers\n            }, 'Try Again')\n        ]));\n    }\n}\n\nfunction getPricingBadge(customer) {\n    const type = customer.pricingType || 'market';\n    if (type === 'contract') {\n        return createElement('span', { className: 'badge badge-contract' }, 'Contract');\n    } else if (type === 'markup') {\n        return createElement('span', { className: 'badge badge-markup' }, `+${customer.markupPercentage || 0}%`);\n    }\n    return createElement('span', { className: 'badge badge-market' }, 'Market');\n}\n\nfunction _formatCurrency(amount) {\n    if (amount === undefined || amount === null) return '-';\n    return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(amount);\n}\n\nfunction displayCustomers(customers) {\n    const container = document.getElementById('customersList');\n\n    if (!customers || !customers.length) {\n        container.innerHTML = '';\n        container.appendChild(createElement('div', { className: 'empty-state' }, 'No customers found'));\n        return;\n    }\n\n    container.innerHTML = '';\n    const fragment = document.createDocumentFragment();\n\n    customers.forEach((c, idx) => {\n        const details = [];\n        if (c.phone) details.push(createElement('span', {}, c.phone));\n        if (c.address) details.push(createElement('span', {}, c.address));\n\n        const actions = [\n            createElement('button', {\n                onclick: () => window.shareMagicLink(c._id),\n                className: 'btn-action link',\n                title: 'Share order link'\n            }, 'Link')\n        ];\n\n        if (c.pricingType === 'contract') {\n            actions.push(createElement('button', {\n                onclick: () => window.openContractPrices(c._id),\n                className: 'btn-action'\n            }, 'Prices'));\n        }\n\n        actions.push(createElement('button', {\n            onclick: () => window.editCustomerById(c._id),\n            className: 'btn-action primary'\n        }, 'Edit'));\n\n        actions.push(createElement('button', {\n            onclick: () => window.deleteCustomer(c._id),\n            className: 'btn-action danger'\n        }, 'Delete'));\n\n        const badges = [getPricingBadge(c)];\n        if (c.balance > 0) {\n            badges.push(createElement('span', {\n                className: 'balance-badge',\n                style: { color: 'var(--error)', fontSize: '0.75rem', fontWeight: '600' }\n            }, `₹${c.balance}`));\n        }\n        if (c.isTestCustomer) {\n            badges.unshift(createElement('span', { className: 'badge badge-test' }, 'Test'));\n        }\n\n        const card = createElement('div', {\n            className: `customer-card card-animated card-fade-in${c.isTestCustomer ? ' test-customer' : ''}`,\n            style: { animationDelay: `${idx * 0.05}s` }\n        }, [\n            createElement('div', { className: 'customer-header' }, [\n                createElement('div', { className: 'customer-name' }, c.name),\n                createElement('div', { className: 'customer-badges' }, badges)\n            ]),\n            createElement('div', { className: 'customer-details' }, details),\n            createElement('div', { className: 'customer-actions' }, actions)\n        ]);\n        fragment.appendChild(card);\n    });\n\n    container.appendChild(fragment);\n}\n\nfunction searchCustomers() {\n    const q = document.getElementById('searchInput').value.toLowerCase();\n    const filtered = allCustomers.filter(c =>\n        c.name.toLowerCase().includes(q) || (c.phone && c.phone.includes(q))\n    );\n    displayCustomers(filtered);\n}\n\nfunction toggleMarkupField() {\n    const type = document.getElementById('customerPricingType').value;\n    document.getElementById('markupField').classList.toggle('hidden', type !== 'markup');\n    document.getElementById('contractInfo').classList.toggle('hidden', type !== 'contract');\n}\n\nfunction showAddCustomerForm() {\n    document.getElementById('modalTitle').textContent = 'Add Customer';\n    document.getElementById('customerForm').reset();\n    document.getElementById('customerId').value = '';\n    document.getElementById('customerIsTest').checked = false;\n    document.getElementById('customerPricingType').value = 'market';\n    toggleMarkupField();\n    document.getElementById('customerModal').classList.add('show');\n    setTimeout(() => { customerFormDirty = false; }, 0);\n}\n\nfunction editCustomer(customer) {\n    document.getElementById('modalTitle').textContent = 'Edit Customer';\n    document.getElementById('customerId').value = customer._id;\n    document.getElementById('customerName').value = customer.name;\n    document.getElementById('customerPhone').value = customer.phone || '';\n    document.getElementById('customerWhatsapp').value = customer.whatsapp || '';\n    document.getElementById('customerAddress').value = customer.address || '';\n    document.getElementById('customerIsTest').checked = customer.isTestCustomer || false;\n    document.getElementById('customerPricingType').value = customer.pricingType || 'market';\n    document.getElementById('customerMarkup').value = customer.markupPercentage || 0;\n    toggleMarkupField();\n    document.getElementById('customerModal').classList.add('show');\n    setTimeout(() => { customerFormDirty = false; }, 0);\n}\n\nfunction closeModal() {\n    if (customerFormDirty) {\n        if (!confirm('You have unsaved changes. Discard them?')) return;\n    }\n    customerFormDirty = false;\n    document.getElementById('customerModal').classList.remove('show');\n}\n\n// Global listener setup\n// We can't attach this in strict module scope if the element doesn't exist yet, \n// so we'll do it possibly in init or check existence.\n// Ideally, we move this logic to inside init or a setup function.\nfunction setupFormListeners() {\n    const form = document.getElementById('customerForm');\n    if (form) {\n        form.addEventListener('input', () => { customerFormDirty = true; });\n        form.addEventListener('change', () => { customerFormDirty = true; });\n        form.addEventListener('submit', async (e) => {\n            e.preventDefault();\n\n            const btn = document.getElementById('saveCustomerBtn');\n            const id = document.getElementById('customerId').value;\n            const pricingType = document.getElementById('customerPricingType').value;\n\n            // Client-side validation\n            const name = document.getElementById('customerName').value.trim();\n            const phone = document.getElementById('customerPhone').value.trim();\n            const whatsapp = document.getElementById('customerWhatsapp').value.trim();\n\n            if (!name) {\n                showToast('Please enter customer name', 'info');\n                document.getElementById('customerName').focus();\n                return;\n            }\n\n            // Validate phone number format (if provided)\n            if (phone && !/^[0-9]{10}$/.test(phone)) {\n                showToast('Phone should be 10 digits', 'info');\n                document.getElementById('customerPhone').focus();\n                return;\n            }\n\n            // Validate WhatsApp number format (if provided)\n            if (whatsapp && !/^[0-9]{10}$/.test(whatsapp)) {\n                showToast('WhatsApp should be 10 digits', 'info');\n                document.getElementById('customerWhatsapp').focus();\n                return;\n            }\n\n            // Validate markup percentage\n            const markupValue = parseFloat(document.getElementById('customerMarkup').value) || 0;\n            if (pricingType === 'markup' && (markupValue < 0 || markupValue > 200)) {\n                showToast('Markup should be 0-200%', 'info');\n                document.getElementById('customerMarkup').focus();\n                return;\n            }\n\n            btn.classList.add('btn-loading');\n            btn.disabled = true;\n\n            const data = {\n                name: name,\n                phone: phone,\n                whatsapp: whatsapp,\n                address: document.getElementById('customerAddress').value.trim(),\n                isTestCustomer: document.getElementById('customerIsTest').checked,\n                pricingType: pricingType,\n                markupPercentage: pricingType === 'markup' ? markupValue : 0\n            };\n\n            try {\n                const url = id ? `/api/customers/${id}` : '/api/customers';\n                const method = id ? 'PUT' : 'POST';\n\n                const headers = { 'Content-Type': 'application/json' };\n                const csrfToken = await Auth.ensureCsrfToken();\n                if (csrfToken) {\n                    headers['X-CSRF-Token'] = csrfToken;\n                }\n\n                let res = await fetch(url, {\n                    method,\n                    headers,\n                    credentials: 'include',\n                    body: JSON.stringify(data)\n                });\n\n                // Handle CSRF error with retry\n                if (res.status === 403) {\n                    const err = await res.json();\n                    if (err.message?.toLowerCase().includes('csrf')) {\n                        const newToken = await Auth.refreshCsrfToken();\n                        if (newToken) {\n                            headers['X-CSRF-Token'] = newToken;\n                            res = await fetch(url, {\n                                method,\n                                headers,\n                                credentials: 'include',\n                                body: JSON.stringify(data)\n                            });\n                        }\n                    } else {\n                        const msg = err.errors?.[0]?.msg || err.message || 'Could not save. Try again.';\n                        showToast(msg, 'info');\n                        btn.classList.remove('btn-loading');\n                        btn.disabled = false;\n                        return;\n                    }\n                }\n\n                if (res.ok) {\n                    btn.classList.remove('btn-loading');\n                    btn.classList.add('btn-success');\n                    showToast(id ? 'Customer updated' : 'Customer added', 'success');\n                    setTimeout(() => {\n                        btn.classList.remove('btn-success');\n                        closeModal();\n                    }, 800);\n                    loadCustomers();\n                } else {\n                    const err = await res.json();\n                    const msg = err.errors?.[0]?.msg || err.message || 'Could not save. Try again.';\n                    showToast(msg, 'info');\n                }\n            } catch (e) {\n                console.error('Save customer error:', e);\n                if (!navigator.onLine) {\n                    showToast('No internet connection', 'info');\n                } else {\n                    showToast('Could not save. Please try again.', 'info');\n                }\n            } finally {\n                btn.classList.remove('btn-loading');\n                btn.disabled = false;\n            }\n        });\n    }\n}\n\nasync function deleteCustomer(id, _isRetry = false) {\n    if (!_isRetry && !confirm('Delete this customer?')) return;\n\n    // Disable all delete buttons to prevent double-clicks\n    const allDeleteBtns = document.querySelectorAll('.btn-action.danger');\n    allDeleteBtns.forEach(btn => { btn.disabled = true; });\n\n    try {\n        const headers = {};\n        const csrfToken = await Auth.ensureCsrfToken();\n        if (csrfToken) {\n            headers['X-CSRF-Token'] = csrfToken;\n        }\n\n        const res = await fetch(`/api/customers/${id}`, {\n            method: 'DELETE',\n            headers,\n            credentials: 'include'\n        });\n\n        // Handle CSRF error with retry\n        if (res.status === 403 && !_isRetry) {\n            const err = await res.json();\n            if (err.message?.toLowerCase().includes('csrf')) {\n                await Auth.refreshCsrfToken();\n                return deleteCustomer(id, true);\n            }\n            showToast(err.message || 'Could not delete', 'info');\n            return;\n        }\n\n        if (res.ok) {\n            showToast('Customer deleted', 'success');\n            loadCustomers();\n        } else {\n            const err = await res.json();\n            showToast(err.message || 'Could not delete', 'info');\n        }\n    } catch (e) {\n        console.error('Delete customer error:', e);\n        if (!navigator.onLine) {\n            showToast('No internet connection', 'info');\n        } else {\n            showToast('Could not delete. Please try again.', 'info');\n        }\n    } finally {\n        const allDeleteBtns = document.querySelectorAll('.btn-action.danger');\n        allDeleteBtns.forEach(btn => { btn.disabled = false; });\n    }\n}\n\nfunction editCustomerById(id) {\n    const customer = allCustomers.find(c => c._id === id);\n    if (customer) editCustomer(customer);\n}\n\n// Magic Link sharing\nasync function shareMagicLink(customerId, _isRetry = false) {\n    const customer = allCustomers.find(c => c._id === customerId);\n    if (!customer) {\n        showToast('Customer data updating. Please refresh.', 'info');\n        return;\n    }\n\n    // Disable all link buttons to prevent double-clicks during generation\n    const allLinkBtns = document.querySelectorAll('.btn-action.link');\n    allLinkBtns.forEach(btn => { btn.disabled = true; });\n\n    try {\n        const headers = {};\n        const csrfToken = await Auth.ensureCsrfToken();\n        if (csrfToken) {\n            headers['X-CSRF-Token'] = csrfToken;\n        }\n\n        const res = await fetch(`/api/customers/${customerId}/magic-link`, {\n            method: 'POST',\n            headers,\n            credentials: 'include'\n        });\n\n        const data = await res.json();\n\n        // Handle CSRF error with retry\n        if (res.status === 403 && data?.message?.toLowerCase().includes('csrf') && !_isRetry) {\n            await Auth.refreshCsrfToken();\n            return shareMagicLink(customerId, true);\n        }\n\n        if (res.ok && data.data) {\n            const link = data.data.link;\n\n            // Try to copy to clipboard\n            if (navigator.clipboard) {\n                await navigator.clipboard.writeText(link);\n                showToast(`Link copied for ${customer.name}`, 'success');\n            } else {\n                // Fallback - show the link in a prompt\n                prompt('Copy this order link:', link);\n            }\n\n            // Also try to share if available (mobile)\n            if (navigator.share) {\n                try {\n                    await navigator.share({\n                        title: 'Pratibha Marketing - Order',\n                        text: `Place your order here, ${customer.name}`,\n                        url: link\n                    });\n                } catch (shareErr) {\n                    // Only silence AbortError (user cancelled)\n                    if (shareErr.name !== 'AbortError') {\n                        console.warn('Share API failed:', shareErr.name, shareErr.message);\n                    }\n                    // Link already copied to clipboard, so no user action needed\n                }\n            }\n        } else {\n            showToast(data.message || 'Could not generate link', 'info');\n        }\n    } catch (e) {\n        console.error('Magic link error:', e);\n        if (!navigator.onLine) {\n            showToast('No internet connection', 'info');\n        } else {\n            showToast('Could not generate link. Try again.', 'info');\n        }\n    } finally {\n        const allLinkBtns = document.querySelectorAll('.btn-action.link');\n        allLinkBtns.forEach(btn => { btn.disabled = false; });\n    }\n}\n\n// Contract Prices\nasync function openContractPrices(customerId) {\n    const customer = allCustomers.find(c => c._id === customerId);\n    if (!customer) {\n        showToast('Customer data updating. Please refresh.', 'info');\n        return;\n    }\n\n    // Make sure products are loaded\n    if (!allProducts.length) {\n        await loadProducts();\n    }\n\n    document.getElementById('contractCustomerId').value = customerId;\n    document.getElementById('contractCustomerName').textContent = customer.name;\n\n    // Handle both Map and Object formats\n    if (customer.contractPrices instanceof Map) {\n        currentContractPrices = Object.fromEntries(customer.contractPrices);\n    } else {\n        currentContractPrices = customer.contractPrices || {};\n    }\n\n    // Build category pills\n    buildContractCategoryPills();\n    selectedContractCategory = '';\n    document.getElementById('productSearch').value = '';\n\n    displayContractProducts(allProducts);\n    document.getElementById('contractModal').classList.add('show');\n}\n\nfunction buildContractCategoryPills() {\n    const categories = [...new Set(allProducts.map(p => p.category || 'Other'))].sort();\n    const container = document.getElementById('contractCategoryPills');\n\n    container.innerHTML = '';\n    const fragment = document.createDocumentFragment();\n\n    fragment.appendChild(createElement('button', {\n        className: 'cat-pill active',\n        dataset: { category: '' },\n        onclick: () => window.filterByContractCategory('')\n    }, 'All'));\n\n    categories.forEach(cat => {\n        const displayName = cat.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n        fragment.appendChild(createElement('button', {\n            className: 'cat-pill',\n            dataset: { category: cat },\n            onclick: () => window.filterByContractCategory(cat)\n        }, displayName));\n    });\n\n    container.appendChild(fragment);\n}\n\nfunction displayContractProducts(products) {\n    const container = document.getElementById('contractPricesList');\n    container.innerHTML = '';\n    const fragment = document.createDocumentFragment();\n\n    products.forEach(p => {\n        const price = currentContractPrices[p._id] || '';\n        const item = createElement('div', { className: 'contract-item' }, [\n            createElement('div', { className: 'contract-item-info' }, [\n                createElement('div', { className: 'contract-item-name' }, p.name),\n                createElement('div', { className: 'contract-item-base' }, `per ${p.unit}`)\n            ]),\n            createElement('input', {\n                type: 'number',\n                step: '0.01',\n                min: '0',\n                className: 'contract-price-input input-animated',\n                dataset: { productId: p._id },\n                value: String(price),\n                placeholder: '₹'\n            }),\n            createElement('span', { className: 'contract-item-unit' }, `/${p.unit}`)\n        ]);\n        fragment.appendChild(item);\n    });\n\n    container.appendChild(fragment);\n}\n\n// Sync current DOM input values to state before filtering/saving\nfunction syncPricesToState() {\n    document.querySelectorAll('.contract-price-input').forEach(input => {\n        const productId = input.dataset.productId;\n        const price = parseFloat(input.value);\n        if (!isNaN(price) && price > 0) {\n            currentContractPrices[productId] = price;\n        } else {\n            delete currentContractPrices[productId];\n        }\n    });\n}\n\nfunction filterContractProducts() {\n    syncPricesToState(); // Preserve prices before re-rendering\n    const q = document.getElementById('productSearch').value.toLowerCase();\n    const filtered = allProducts.filter(p => {\n        const matchesSearch = p.name.toLowerCase().includes(q);\n        const matchesCategory = !selectedContractCategory || (p.category || 'Other') === selectedContractCategory;\n        return matchesSearch && matchesCategory;\n    });\n    displayContractProducts(filtered);\n}\n\nfunction filterByContractCategory(category) {\n    syncPricesToState(); // Preserve prices before switching category\n    selectedContractCategory = category;\n\n    // Update active pill\n    document.querySelectorAll('#contractCategoryPills .cat-pill').forEach(pill => {\n        pill.classList.toggle('active', pill.dataset.category === category);\n    });\n\n    filterContractProducts();\n}\n\nasync function saveContractPrices() {\n    const customerId = document.getElementById('contractCustomerId').value;\n    const customer = allCustomers.find(c => c._id === customerId);\n    if (!customer) {\n        showToast('Customer data updating. Please refresh.', 'info');\n        return;\n    }\n\n    const btn = document.getElementById('saveContractBtn');\n    btn.classList.add('btn-loading');\n    btn.disabled = true;\n\n    // Sync current visible inputs to state before saving\n    syncPricesToState();\n\n    // Use the complete state (includes prices from all categories)\n    const contractPrices = { ...currentContractPrices };\n\n    try {\n        const headers = { 'Content-Type': 'application/json' };\n        const csrfToken = await Auth.ensureCsrfToken();\n        if (csrfToken) {\n            headers['X-CSRF-Token'] = csrfToken;\n        }\n\n        const payload = {\n            name: customer.name,\n            phone: customer.phone,\n            contractPrices\n        };\n\n        let res = await fetch(`/api/customers/${customerId}`, {\n            method: 'PUT',\n            headers,\n            credentials: 'include',\n            body: JSON.stringify(payload)\n        });\n\n        // Handle CSRF error with retry\n        if (res.status === 403) {\n            const err = await res.json();\n            if (err.message?.toLowerCase().includes('csrf')) {\n                const newToken = await Auth.refreshCsrfToken();\n                if (newToken) {\n                    headers['X-CSRF-Token'] = newToken;\n                    res = await fetch(`/api/customers/${customerId}`, {\n                        method: 'PUT',\n                        headers,\n                        credentials: 'include',\n                        body: JSON.stringify(payload)\n                    });\n                }\n            } else {\n                showToast(err.message || 'Could not save', 'info');\n                return;\n            }\n        }\n\n        if (res.ok) {\n            btn.classList.remove('btn-loading');\n            btn.classList.add('btn-success');\n            showToast('Prices saved', 'success');\n            setTimeout(() => {\n                btn.classList.remove('btn-success');\n                closeContractModal();\n            }, 800);\n            loadCustomers();\n        } else {\n            const err = await res.json();\n            showToast(err.errors?.[0]?.msg || err.message || 'Could not save', 'info');\n        }\n    } catch (e) {\n        console.error('Save contract prices error:', e);\n        if (!navigator.onLine) {\n            showToast('No internet connection', 'info');\n        } else {\n            showToast('Could not save prices. Try again.', 'info');\n        }\n    } finally {\n        btn.classList.remove('btn-loading');\n        btn.disabled = false;\n    }\n}\n\nfunction closeContractModal() {\n    document.getElementById('contractModal').classList.remove('show');\n    document.getElementById('productSearch').value = '';\n}\n\nfunction toggleTestCustomers() {\n    showTestCustomers = document.getElementById('showTestCustomers').checked;\n    loadCustomers();\n}\n\n// Expose functions to window for inline handlers\nwindow.showAddCustomerForm = showAddCustomerForm;\nwindow.searchCustomers = searchCustomers;\nwindow.toggleMarkupField = toggleMarkupField;\nwindow.toggleTestCustomers = toggleTestCustomers;\nwindow.closeModal = closeModal;\nwindow.editCustomerById = editCustomerById;\nwindow.deleteCustomer = deleteCustomer;\nwindow.shareMagicLink = shareMagicLink;\nwindow.openContractPrices = openContractPrices;\nwindow.filterContractProducts = filterContractProducts;\nwindow.filterByContractCategory = filterByContractCategory;\nwindow.saveContractPrices = saveContractPrices;\nwindow.closeContractModal = closeContractModal;\n// ... add others if needed, but the HTML uses them directly from window.\n\n// Modals overlay click handlers - Initialize in a setup function calling after DOM load if needed,\n// but since we import this module at the bottom of the body, elements should exist.\nconst customerModal = document.getElementById('customerModal');\nif (customerModal) {\n    customerModal.onclick = (e) => {\n        if (e.target.id === 'customerModal') closeModal();\n    };\n}\nconst contractModal = document.getElementById('contractModal');\nif (contractModal) {\n    contractModal.onclick = (e) => {\n        if (e.target.id === 'contractModal') closeContractModal();\n    };\n}\n\n// Call setup listeners\nsetupFormListeners();\n\ninit();\n"],"names":["waitForAuth","maxWait","resolve","reject","startTime","check","Auth","allCustomers","allProducts","currentContractPrices","selectedContractCategory","showTestCustomers","customerFormDirty","init","err","loadCustomers","loadProducts","res","showToast","displayCustomers","container","errorMsg","createElement","getPricingBadge","customer","type","customers","fragment","c","idx","details","actions","badges","card","searchCustomers","q","filtered","toggleMarkupField","showAddCustomerForm","editCustomer","closeModal","setupFormListeners","form","e","btn","id","pricingType","name","phone","whatsapp","markupValue","data","url","method","headers","csrfToken","newToken","msg","deleteCustomer","_isRetry","editCustomerById","shareMagicLink","customerId","link","shareErr","openContractPrices","buildContractCategoryPills","displayContractProducts","categories","p","cat","displayName","l","products","price","item","syncPricesToState","input","productId","filterContractProducts","matchesSearch","matchesCategory","filterByContractCategory","category","pill","saveContractPrices","contractPrices","payload","closeContractModal","toggleTestCustomers","customerModal","contractModal"],"mappings":"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"}