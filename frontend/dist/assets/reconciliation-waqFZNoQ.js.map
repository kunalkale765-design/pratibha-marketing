{"version":3,"file":"reconciliation-waqFZNoQ.js","sources":["../../src/js/pages/reconciliation.js"],"sourcesContent":["import { showToast } from '/js/ui.js';\n\n// SECURITY: HTML escape function to prevent XSS\nfunction escapeHtml(str) {\n    if (str == null) return '';\n    return String(str)\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#039;');\n}\n\n// Wait for Auth to be available\nconst waitForAuth = (maxWait = 10000) => new Promise((resolve, reject) => {\n    const startTime = Date.now();\n    const check = () => {\n        if (window.Auth) return resolve(window.Auth);\n        if (Date.now() - startTime > maxWait) return reject(new Error('Auth not available'));\n        setTimeout(check, 50);\n    };\n    check();\n});\nconst Auth = await waitForAuth();\n\n// State\nlet pendingOrders = [];\nlet currentOrder = null;\nlet currentOrderData = null;\nlet todayCompletedCount = 0;\n\n// Initialize\nasync function init() {\n    const user = await Auth.requireAuth(['admin', 'staff']);\n    if (!user) return;\n\n    checkHelpBanner();\n    await loadPendingOrders();\n}\n\n// Load pending orders for reconciliation\nasync function loadPendingOrders() {\n    try {\n        const response = await fetch('/api/reconciliation/pending', {\n            credentials: 'include'\n        });\n\n        if (!response.ok) throw new Error('Failed to load pending orders');\n\n        if (response.status === 401) {\n            window.location.href = '/pages/auth/login.html';\n            return;\n        }\n\n        const data = await response.json();\n        pendingOrders = data.data || [];\n        todayCompletedCount = data.todayCompleted || 0;\n\n        updateStats();\n        renderOrders();\n    } catch (error) {\n        console.error('Error loading pending orders:', error);\n        const orderList = document.getElementById('orderList');\n        if (orderList) {\n            orderList.innerHTML = `\n                <div class=\"error-state\" style=\"text-align:center;padding:2rem;color:var(--error);\">\n                    <p>Failed to load orders</p>\n                    <button onclick=\"window.location.reload()\" style=\"margin-top:1rem;padding:0.5rem 1rem;background:var(--dusty-olive);color:white;border:none;border-radius:8px;cursor:pointer;\">Retry</button>\n                </div>\n            `;\n        }\n    }\n}\n\n// Update stats display\nfunction updateStats() {\n    document.getElementById('statTotal').textContent = pendingOrders.length + todayCompletedCount;\n    document.getElementById('statPending').textContent = pendingOrders.length;\n    document.getElementById('statCompleted').textContent = todayCompletedCount;\n}\n\n// Render orders list\nfunction renderOrders() {\n    const container = document.getElementById('orderList');\n    if (!container) return;\n\n    if (pendingOrders.length === 0) {\n        container.innerHTML = `\n            <div class=\"empty-state\">\n                <div class=\"empty-icon\">&#10003;</div>\n                <h3>All caught up!</h3>\n                <p>No orders pending reconciliation</p>\n            </div>\n        `;\n        return;\n    }\n\n    // SECURITY: Use data attributes and event delegation instead of inline onclick\n    // Escape all user-provided content to prevent XSS\n    container.innerHTML = pendingOrders.map(order => {\n        const initials = escapeHtml(getInitials(order.customer?.name || 'U'));\n        const customerName = escapeHtml(order.customer?.name || 'Unknown');\n        const orderNumber = escapeHtml(order.orderNumber);\n        const batchType = escapeHtml(order.batch?.batchType || '1st');\n        const orderId = escapeHtml(order._id);\n        return `\n            <div class=\"order-card card-animated\" data-order-id=\"${orderId}\">\n                <div class=\"order-avatar\">${initials}</div>\n                <div class=\"order-details\">\n                    <div class=\"order-customer\">${customerName}</div>\n                    <div class=\"order-meta\">\n                        <span class=\"order-number\">${orderNumber}</span>\n                        ${order.batch ? `<span class=\"order-batch\">${batchType}</span>` : ''}\n                    </div>\n                    <div class=\"order-items\">${order.itemCount} items</div>\n                </div>\n                <div class=\"order-amount\">&#8377;${order.totalAmount?.toLocaleString() || 0}</div>\n                <div class=\"order-arrow\">&rarr;</div>\n            </div>\n        `;\n    }).join('');\n\n    // Event delegation for order card clicks\n    container.querySelectorAll('.order-card').forEach(card => {\n        card.addEventListener('click', () => {\n            const orderId = card.dataset.orderId;\n            if (orderId) openReconciliation(orderId);\n        });\n    });\n}\n\n// Get initials from name\nfunction getInitials(name) {\n    return name\n        .split(' ')\n        .map(word => word[0])\n        .join('')\n        .toUpperCase()\n        .slice(0, 2);\n}\n\n// Open reconciliation modal for an order\nasync function openReconciliation(orderId) {\n    try {\n        currentOrder = orderId;\n\n        // Show loading state\n        const modal = document.getElementById('reconcileModal');\n        modal.classList.add('active');\n        document.getElementById('reconcileItems').innerHTML = '<div class=\"loading\">Loading order details...</div>';\n\n        // Fetch order details\n        const response = await fetch(`/api/reconciliation/${orderId}`, {\n            credentials: 'include'\n        });\n\n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.message || 'Failed to load order');\n        }\n\n        const data = await response.json();\n        currentOrderData = data.data;\n\n        // Update modal header\n        document.getElementById('modalTitle').textContent = 'Reconcile Order';\n        document.getElementById('modalSubtitle').textContent = currentOrderData.orderNumber;\n        document.getElementById('infoCustomer').textContent = currentOrderData.customer?.name || 'Unknown';\n        document.getElementById('infoTotal').textContent = `₹${currentOrderData.totalAmount?.toLocaleString() || 0}`;\n\n        // Render items\n        renderReconcileItems();\n        updateSummary();\n\n    } catch (error) {\n        console.error('Error loading order:', error);\n        showToast(error.message || 'Failed to load order', 'error');\n        closeModal();\n    }\n}\n\n// Render reconciliation items\nfunction renderReconcileItems() {\n    const container = document.getElementById('reconcileItems');\n    if (!currentOrderData) return;\n\n    // SECURITY: Escape user-provided content\n    container.innerHTML = currentOrderData.products.map((item, index) => {\n        const productName = escapeHtml(item.productName);\n        const unit = escapeHtml(item.unit);\n        return `\n        <div class=\"reconcile-item\" id=\"item-${index}\" data-index=\"${index}\">\n            <div class=\"item-info\">\n                <div class=\"item-name\">${productName}</div>\n                <div class=\"item-unit\">${unit} @ ₹${item.rate}</div>\n            </div>\n            <div class=\"item-ordered\">${item.orderedQty}</div>\n            <div class=\"item-delivered\">\n                <input type=\"number\"\n                    class=\"qty-input\"\n                    id=\"qty-${index}\"\n                    value=\"${item.deliveredQty}\"\n                    min=\"0\"\n                    step=\"0.1\"\n                    data-original=\"${item.orderedQty}\"\n                    data-index=\"${index}\">\n            </div>\n            <div class=\"item-reason\" id=\"reason-row-${index}\" style=\"display: none;\">\n                <input type=\"text\"\n                    class=\"reason-input\"\n                    id=\"reason-${index}\"\n                    placeholder=\"Reason for change (optional)\"\n                    maxlength=\"200\">\n            </div>\n        </div>\n    `;}).join('');\n\n    // Event delegation for quantity inputs\n    container.querySelectorAll('.qty-input').forEach(input => {\n        input.addEventListener('change', () => onQuantityChange(parseInt(input.dataset.index)));\n        input.addEventListener('input', () => onQuantityInput(parseInt(input.dataset.index)));\n    });\n}\n\n// Handle quantity input (real-time visual feedback)\nfunction onQuantityInput(index) {\n    const input = document.getElementById(`qty-${index}`);\n    const item = document.getElementById(`item-${index}`);\n    const reasonRow = document.getElementById(`reason-row-${index}`);\n    const originalQty = parseFloat(input.dataset.original);\n    const newQty = parseFloat(input.value) || 0;\n\n    // Update visual classes\n    item.classList.remove('modified', 'zeroed');\n    input.classList.remove('modified', 'zeroed');\n\n    if (newQty === 0) {\n        item.classList.add('zeroed');\n        input.classList.add('zeroed');\n        reasonRow.style.display = 'block';\n    } else if (newQty !== originalQty) {\n        item.classList.add('modified');\n        input.classList.add('modified');\n        reasonRow.style.display = 'block';\n    } else {\n        reasonRow.style.display = 'none';\n    }\n\n    updateSummary();\n}\n\n// Handle quantity change (on blur)\nfunction onQuantityChange(index) {\n    onQuantityInput(index);\n}\n\n// Update summary totals\nfunction updateSummary() {\n    if (!currentOrderData) return;\n\n    const originalTotal = currentOrderData.totalAmount;\n    let adjustedTotal = 0;\n\n    currentOrderData.products.forEach((item, index) => {\n        const input = document.getElementById(`qty-${index}`);\n        const deliveredQty = parseFloat(input?.value) || 0;\n        adjustedTotal += deliveredQty * item.rate;\n    });\n\n    adjustedTotal = Math.round(adjustedTotal * 100) / 100;\n    const difference = Math.round((originalTotal - adjustedTotal) * 100) / 100;\n\n    document.getElementById('summaryOriginal').textContent = `₹${originalTotal.toLocaleString()}`;\n    document.getElementById('summaryAdjusted').textContent = `₹${adjustedTotal.toLocaleString()}`;\n\n    const diffRow = document.getElementById('summaryDifferenceRow');\n    if (difference !== 0) {\n        diffRow.style.display = 'flex';\n        document.getElementById('summaryDifference').textContent = `-₹${difference.toLocaleString()}`;\n    } else {\n        diffRow.style.display = 'none';\n    }\n}\n\n// Complete reconciliation\nasync function completeReconciliation() {\n    if (!currentOrder || !currentOrderData) return;\n\n    // Gather reconciliation data first for validation\n    const items = currentOrderData.products.map((item, index) => {\n        const input = document.getElementById(`qty-${index}`);\n        const reasonInput = document.getElementById(`reason-${index}`);\n        return {\n            product: item.product,\n            deliveredQty: parseFloat(input?.value) || 0,\n            reason: reasonInput?.value || ''\n        };\n    });\n\n    // Check if all quantities are zero\n    const allZero = items.every(item => item.deliveredQty === 0);\n    if (allZero) {\n        if (!confirm('All quantities are zero. Are you sure?')) {\n            return;\n        }\n    }\n\n    // Confirmation before completing\n    if (!confirm('Mark this order as delivered?')) {\n        return;\n    }\n\n    const btn = document.getElementById('btnComplete');\n    btn.disabled = true;\n    btn.textContent = 'Processing...';\n\n    try {\n\n        const notes = document.getElementById('reconcileNotes')?.value || '';\n\n        // Get CSRF token\n        const csrfToken = await Auth.ensureCsrfToken();\n        const headers = { 'Content-Type': 'application/json' };\n        if (csrfToken) {\n            headers['X-CSRF-Token'] = csrfToken;\n        }\n\n        // Submit reconciliation\n        const response = await fetch(`/api/reconciliation/${currentOrder}/complete`, {\n            method: 'POST',\n            headers: headers,\n            credentials: 'include',\n            body: JSON.stringify({ items, notes })\n        });\n\n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.message || 'Failed to complete reconciliation');\n        }\n\n        const result = await response.json();\n\n        showToast(`Order ${result.data.orderNumber} reconciled successfully`, 'success');\n\n        // Update stats\n        todayCompletedCount++;\n\n        // Close modal and refresh list\n        closeModal();\n        await loadPendingOrders();\n\n    } catch (error) {\n        console.error('Error completing reconciliation:', error);\n        showToast(error.message || 'Failed to complete reconciliation', 'error');\n    } finally {\n        btn.disabled = false;\n        btn.textContent = 'Complete Reconciliation';\n    }\n}\n\n// Close modal\nfunction closeModal() {\n    const modal = document.getElementById('reconcileModal');\n    modal.classList.remove('active');\n    currentOrder = null;\n    currentOrderData = null;\n\n    // Reset notes\n    const notesInput = document.getElementById('reconcileNotes');\n    if (notesInput) notesInput.value = '';\n}\n\n// Close modal when clicking on overlay (outside modal content)\nconst reconcileModalOverlay = document.getElementById('reconcileModal');\nif (reconcileModalOverlay) {\n    reconcileModalOverlay.addEventListener('click', (e) => {\n        // Only close if clicking the overlay itself, not the modal content\n        if (e.target === reconcileModalOverlay || e.target.classList.contains('modal-overlay')) {\n            closeModal();\n        }\n    });\n}\n\n// Safe localStorage wrapper (private browsing may throw)\nfunction safeStorage(key, value) {\n    try {\n        if (value === undefined) return localStorage.getItem(key);\n        localStorage.setItem(key, value);\n    } catch { return null; }\n}\n\n// Dismiss help banner\nfunction dismissHelp() {\n    const banner = document.getElementById('helpBanner');\n    if (banner) {\n        banner.style.display = 'none';\n        safeStorage('reconciliationHelpDismissed', 'true');\n    }\n}\n\n// Check if help banner should be shown\nfunction checkHelpBanner() {\n    const dismissed = safeStorage('reconciliationHelpDismissed');\n    const banner = document.getElementById('helpBanner');\n    if (banner && dismissed === 'true') {\n        banner.style.display = 'none';\n    }\n}\n\n// Refresh pending orders when page becomes visible again\ndocument.addEventListener('visibilitychange', () => {\n    if (document.visibilityState === 'visible') {\n        loadPendingOrders();\n    }\n});\n\n// Make functions globally available\nwindow.openReconciliation = openReconciliation;\nwindow.closeModal = closeModal;\nwindow.completeReconciliation = completeReconciliation;\nwindow.onQuantityChange = onQuantityChange;\nwindow.onQuantityInput = onQuantityInput;\nwindow.dismissHelp = dismissHelp;\n\n// Initialize\ninit();\n"],"names":["escapeHtml","str","waitForAuth","maxWait","resolve","reject","startTime","check","Auth","pendingOrders","currentOrder","currentOrderData","todayCompletedCount","init","checkHelpBanner","loadPendingOrders","response","data","updateStats","renderOrders","error","orderList","container","order","initials","getInitials","customerName","orderNumber","batchType","card","orderId","openReconciliation","name","word","renderReconcileItems","updateSummary","showToast","closeModal","item","index","productName","unit","input","onQuantityChange","onQuantityInput","reasonRow","originalQty","newQty","originalTotal","adjustedTotal","deliveredQty","difference","diffRow","completeReconciliation","items","reasonInput","btn","notes","csrfToken","headers","result","notesInput","reconcileModalOverlay","e","safeStorage","key","value","dismissHelp","banner","dismissed"],"mappings":"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"}