import"./responsive-D1ZTW0b0.js";import"./ui-D1Am529b.js";import"./api-BqPqbFNt.js";import{r as k}from"./init-6NQZls6S.js";k();const A=()=>new Promise(e=>{window.Auth?e(window.Auth):setTimeout(()=>e(A()),10)}),w=await A();w.ensureCsrfToken().catch(e=>console.warn("CSRF pre-fetch failed:",e));const v=document.getElementById("signupForm"),u=document.getElementById("signupBtn"),a=document.getElementById("noticeMessage"),c=document.getElementById("successMessage"),T=document.getElementById("password");T&&T.addEventListener("input",function(){const e=this.value;h("req-length",e.length>=6),h("req-upper",/[A-Z]/.test(e)),h("req-number",/[0-9]/.test(e))});function h(e,d){const s=document.getElementById(e);if(!s)return;const n=s.textContent.substring(2);d?(s.classList.add("valid"),s.textContent="✓ "+n):(s.classList.remove("valid"),s.textContent="◯ "+n)}B();async function B(){try{(await fetch("/api/auth/me",{credentials:"include"})).ok&&(window.location.href="/")}catch{}}v&&v.addEventListener("submit",async e=>{e.preventDefault();const d=document.getElementById("name").value.trim(),s=document.getElementById("email").value.trim(),n=document.getElementById("phone").value.trim(),o=document.getElementById("password").value,p=document.getElementById("confirmPassword").value;if(!d||!s||!o||!p){t("Please complete all required fields");return}if(o.length<6){t("Password needs at least 6 characters");return}if(!/[A-Z]/.test(o)){t("Add an uppercase letter to password");return}if(!/[a-z]/.test(o)){t("Add a lowercase letter to password");return}if(!/[0-9]/.test(o)){t("Add a number to password");return}if(o!==p){t("Passwords don't match");return}if(n&&!/^[0-9]{10}$/.test(n)){t("Phone should be 10 digits");return}u.disabled=!0,u.textContent="Creating account...",I();try{const r={name:d,email:s,password:o,role:"customer"};n&&(r.phone=n);const m={"Content-Type":"application/json"},y=await w.ensureCsrfToken();y&&(m["X-CSRF-Token"]=y);const g=await fetch("/api/auth/register",{method:"POST",headers:m,credentials:"include",body:JSON.stringify(r)}),i=await g.json();if(g.status===403&&i?.message?.toLowerCase().includes("csrf")){console.log("CSRF error, refreshing token and retrying...");const f=await w.refreshCsrfToken();if(f){m["X-CSRF-Token"]=f;const C=await fetch("/api/auth/register",{method:"POST",headers:m,credentials:"include",body:JSON.stringify(r)}),l=await C.json();if(C.ok){localStorage.setItem("user",JSON.stringify(l.user)),S("Account created successfully! Redirecting..."),setTimeout(()=>{l.user.role==="customer"?window.location.href="/pages/order-form/":window.location.href="/"},1500);return}l.errors&&l.errors.length>0?t(l.errors.map(E=>E.msg).join(", ")):t(l.message||"Could not create account. Try again.");return}}g.ok?(localStorage.setItem("user",JSON.stringify(i.user)),S("Account created successfully! Redirecting..."),setTimeout(()=>{i.user.role==="customer"?window.location.href="/pages/order-form/":window.location.href="/"},1500)):i.errors&&i.errors.length>0?t(i.errors.map(f=>f.msg).join(", ")):t(i.message||"Could not create account. Try again.")}catch(r){console.error("Signup error:",r),navigator.onLine?r.name==="TypeError"||r.message.includes("fetch")?t("Connection issue. Please try again."):t("Something went wrong. Try again."):t("No internet connection")}finally{u&&(u.disabled=!1,u.textContent="Create Account")}});function t(e){a&&(a.textContent=e,a.classList.add("show"),c&&c.classList.remove("show"))}function S(e){c&&(c.textContent=e,c.classList.add("show"),a&&a.classList.remove("show"))}function I(){a&&a.classList.remove("show"),c&&c.classList.remove("show")}
