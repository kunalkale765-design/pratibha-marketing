import{c as h,s as v}from"./api-CPXug1OA.js";import{e as w,a as E,g as y}from"./ui-CbzHyiqg.js";const S="modulepreload",k=function(e){return"/"+e},f={},P=function(t,r,u){let i=Promise.resolve();if(r&&r.length>0){let p=function(o){return Promise.all(o.map(l=>Promise.resolve(l).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),n=c?.nonce||c?.getAttribute("nonce");i=p(r.map(o=>{if(o=k(o),o in f)return;f[o]=!0;const l=o.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${d}`))return;const a=document.createElement("link");if(a.rel=l?"stylesheet":S,l||(a.as="script"),a.crossOrigin="",a.href=o,n&&a.setAttribute("nonce",n),document.head.appendChild(a),l)return new Promise((g,m)=>{a.addEventListener("load",g),a.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${o}`)))})}))}function s(c){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=c,window.dispatchEvent(n),!n.defaultPrevented)throw c}return i.then(c=>{for(const n of c||[])n.status==="rejected"&&s(n.reason);return t().catch(s)})};window.onerror=function(e,t,r,u,i){return console.error("Uncaught error:",e,"at",t,r,u),i&&h(i,{source:t,lineno:r,colno:u}),!0};window.addEventListener("unhandledrejection",function(e){console.error("Unhandled promise rejection:",e.reason),h(e.reason||new Error("Unhandled rejection")),e.preventDefault()});function L(){"serviceWorker"in navigator&&(window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(e=>{console.log("ServiceWorker registered:",e.scope)}).catch(e=>{console.log("ServiceWorker registration failed:",e)})}),navigator.serviceWorker.addEventListener("message",e=>{e.data?.type==="SW_UPDATED"&&P(async()=>{const{showToast:t}=await import("./ui-CbzHyiqg.js").then(r=>r.u);return{showToast:t}},[]).then(({showToast:t})=>{t("Update available â€” refresh to apply","info")}).catch(()=>{console.log("App update available. Refresh to apply.")})}))}async function T(){if(window.Auth&&typeof window.Auth.logout=="function")return window.Auth.logout();localStorage.removeItem("user");const e={"Content-Type":"application/json"},t=y();t&&(e["X-CSRF-Token"]=t);try{await fetch("/api/auth/logout",{method:"POST",headers:e,credentials:"include"})}catch(r){console.error("Logout error:",r)}window.location.href="/pages/auth/login.html"}function A(){document.querySelectorAll("[data-logout], .logout-btn, #logoutBtn").forEach(t=>{t.addEventListener("click",r=>{r.preventDefault(),T()})})}function W(e={}){const{serviceWorker:t=!0,logout:r=!0,modalEscape:u=!0,csrfPreFetch:i=!0}=e;i&&w().catch(s=>console.warn("CSRF pre-fetch failed:",s)),t&&L(),r&&A(),u&&E();try{const s=localStorage.getItem("user");s&&v(JSON.parse(s))}catch{}}export{W as i,T as l,L as r};
