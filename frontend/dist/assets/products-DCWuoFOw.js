import"./responsive-D1ZTW0b0.js";/* empty css             *//* empty css               *//* empty css                */import{s as i,c as a}from"./ui-CbzHyiqg.js";const D=(e=1e4)=>new Promise((t,o)=>{const n=Date.now(),r=()=>{if(window.Auth)return t(window.Auth);if(Date.now()-n>e)return o(new Error("Auth not available"));setTimeout(r,50)};r()}),m=await D();let u=[],l=[],f="";async function A(){await m.requireAuth(["admin","staff"])&&await p()}async function p(){try{const e=await fetch("/api/products",{credentials:"include"});if(!e.ok)throw new Error(`Server returned ${e.status}`);u=(await e.json()).data||[];const o=new Set;u.forEach(n=>{n.category&&o.add(n.category)}),l=Array.from(o).sort(),w(),C(),v()}catch(e){console.error("Failed to load products:",e);const t=document.getElementById("productsList"),o=navigator.onLine?"Products not available":"No internet connection";t.innerHTML="",t.appendChild(a("div",{className:"empty-state"},[a("p",{},o),a("button",{id:"retryProductsBtn",style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"var(--dusty-olive)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},onclick:p},"Try Again")]))}}function w(){const e=document.getElementById("categoryPills");e.innerHTML="";const t=document.createDocumentFragment();t.appendChild(a("button",{className:`cat-pill ${f===""?"active":""}`,onclick:()=>window.filterByCategory("")},"All")),l.forEach(o=>{t.appendChild(a("button",{className:`cat-pill ${f===o?"active":""}`,onclick:()=>window.filterByCategory(o)},o))}),e.appendChild(t)}function C(){const e=document.getElementById("productCategory");e.innerHTML="",e.appendChild(a("option",{value:""},"Select...")),l.forEach(t=>{e.appendChild(a("option",{value:t},t))})}function S(e){f=e,w(),v()}function F(e){const t=document.getElementById("productsList");if(t.innerHTML="",!e||!e.length){t.appendChild(a("div",{className:"empty-state"},"No products found"));return}const o={};e.forEach(d=>{const s=d.category||"Uncategorized";o[s]||(o[s]=[]),o[s].push(d)});const n=Object.keys(o).sort((d,s)=>d==="Uncategorized"?1:s==="Uncategorized"?-1:d.localeCompare(s)),r=document.createDocumentFragment();let c=0;n.forEach(d=>{r.appendChild(a("div",{className:"category-header"},d)),o[d].forEach(s=>{const h=a("div",{className:"product-card card-animated card-fade-in",style:{animationDelay:`${c*.05}s`}},[a("div",{className:"product-info"},[a("div",{className:"product-name"},s.name),a("div",{className:"product-meta"},[a("span",{},s.unit||"")])]),a("div",{className:"product-actions"},[a("button",{onclick:()=>window.editProductById(s._id),className:"btn-icon"},"✎"),a("button",{onclick:()=>window.deleteProduct(s._id),className:"btn-icon danger"},"✕")])]);r.appendChild(h),c++})}),t.appendChild(r)}function v(){const e=document.getElementById("searchInput").value.toLowerCase(),t=u.filter(o=>{const n=o.name.toLowerCase().includes(e),r=!f||o.category===f;return n&&r});F(t)}function U(){document.getElementById("modalTitle").textContent="Add Product",document.getElementById("productForm").reset(),document.getElementById("productId").value="",document.getElementById("productModal").classList.add("show")}function $(e){const t=u.find(r=>r._id===e);if(!t)return;document.getElementById("modalTitle").textContent="Edit Product",document.getElementById("productId").value=t._id,document.getElementById("productName").value=t.name,document.getElementById("productCategory").value=t.category||"",document.getElementById("productUnit").value=t.unit,document.getElementById("productModal").classList.add("show");const o=document.getElementById("productUnit"),n=t.unit;o.onchange=function(){this.value!==n&&(confirm("Changing unit may affect existing orders. Continue?")||(this.value=n))}}function E(){document.getElementById("productModal").classList.remove("show")}function x(){const e=document.getElementById("productForm");e&&e.addEventListener("submit",async o=>{o.preventDefault(),await N()});const t=document.getElementById("newCategoryInput");t&&t.addEventListener("keypress",o=>{o.key==="Enter"&&(o.preventDefault(),M())})}async function N(e=!1){const t=document.getElementById("productId").value,o=document.getElementById("productCategory").value,n=document.getElementById("productName").value.trim(),r=document.getElementById("productUnit").value,c=document.querySelector('#productForm button[type="submit"]')||document.getElementById("saveProductBtn");if(!n){i("Please enter product name","info"),document.getElementById("productName").focus();return}if(!r){i("Please select a unit","info"),document.getElementById("productUnit").focus();return}c&&(c.disabled=!0,c.classList.add("btn-loading"));const d={name:n,unit:r};o&&(d.category=o);try{const s=t?`/api/products/${t}`:"/api/products",h=t?"PUT":"POST",I={"Content-Type":"application/json"},L=await m.ensureCsrfToken();L&&(I["X-CSRF-Token"]=L);const g=await fetch(s,{method:h,headers:I,credentials:"include",body:JSON.stringify(d)});if(g.status===403&&!e){const y=await g.json();if(y.message?.toLowerCase().includes("csrf"))return await m.refreshCsrfToken(),N(!0);i(y.message||"Could not save","info");return}if(g.ok)i(t?"Product updated":"Product added","success"),E(),p();else{const y=await g.json();i(y.message||"Could not save","info")}}catch(s){console.error("Save product error:",s),navigator.onLine?i("Could not save. Try again.","info"):i("No internet connection","info")}finally{c&&(c.disabled=!1,c.classList.remove("btn-loading"))}}async function T(e,t=!1){if(!t&&!confirm("Delete this product?"))return;document.querySelectorAll(".btn-icon.danger").forEach(n=>{n.disabled=!0});try{const n={},r=await m.ensureCsrfToken();r&&(n["X-CSRF-Token"]=r);const c=await fetch(`/api/products/${e}`,{method:"DELETE",headers:n,credentials:"include"});if(c.status===403&&!t){const d=await c.json();if(d.message?.toLowerCase().includes("csrf"))return await m.refreshCsrfToken(),T(e,!0);i(d.message||"Could not delete","info");return}if(c.ok)i("Product deleted","success"),p();else{const d=await c.json();i(d.message||"Could not delete","info")}}catch(n){console.error("Delete product error:",n),navigator.onLine?i("Could not delete. Try again.","info"):i("No internet connection","info")}finally{document.querySelectorAll(".btn-icon.danger").forEach(r=>{r.disabled=!1})}}function j(){B(),document.getElementById("categoryModal").classList.add("show")}function k(){document.getElementById("categoryModal").classList.remove("show"),document.getElementById("newCategoryInput").value=""}function B(){const e=document.getElementById("categoryList");if(e.innerHTML="",!l.length){e.appendChild(a("div",{className:"empty-state"},"No categories yet"));return}const t=document.createDocumentFragment();l.forEach(o=>{const n=u.filter(c=>c.category===o).length,r=a("div",{className:"category-item"},[a("div",{},[a("div",{className:"category-item-name"},o),a("div",{className:"category-item-count"},`${n} product${n!==1?"s":""}`)])]);n===0&&r.appendChild(a("button",{onclick:()=>window.deleteCategory(o),className:"btn-icon danger",style:{width:"32px",height:"32px"}},"×")),t.appendChild(r)}),e.appendChild(t)}function M(){const e=document.getElementById("newCategoryInput"),t=e.value.trim();if(!t){e.focus();return}if(l.some(o=>o.toLowerCase()===t.toLowerCase())){i("Category already exists","info"),e.select();return}l.push(t),l.sort(),e.value="",w(),C(),B(),i("Category added","success")}function q(e){const t=u.filter(o=>o.category===e).length;if(t>0){i(`Move or delete ${t} product(s) first`,"info");return}l=l.filter(o=>o!==e),w(),C(),B(),i("Category removed","success")}window.showAddProductForm=U;window.showCategoryModal=j;window.filterByCategory=S;window.searchProducts=v;window.editProductById=$;window.deleteProduct=T;window.closeModal=E;window.closeCategoryModal=k;window.addCategory=M;window.deleteCategory=q;const P=document.getElementById("productModal");P&&(P.onclick=e=>{e.target.id==="productModal"&&E()});const b=document.getElementById("categoryModal");b&&(b.onclick=e=>{e.target.id==="categoryModal"&&k()});x();A();
